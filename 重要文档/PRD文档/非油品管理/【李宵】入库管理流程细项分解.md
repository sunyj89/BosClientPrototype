# 非油进销存系统 - 入库管理流程细项分解

## 1. 入库申请与到货通知流程细项分解



### 1.1 到货通知单生成

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 通知单编号 | 系统自动生成 | - | - | 编码规则：ARN+年月日+3位流水号 |
| 关联采购订单号 | 直接引用 | - | - | 可关联多个采购订单 |
| 供应商信息 | 来源于采购订单 | - | - | 包含供应商编码、名称、联系方式等 |
| 预计到货日期 | 手工填写或采购订单带出 | 日期 | - | 供应商确认的到货日期 |
| 预计到货数量 | 手工填写或采购订单带出 | 基本计量单位 | 0位小数 | 供应商确认的发货数量 |
| 实际到货日期 | 系统记录确认时间 | 日期 | - | 商品实际到达仓库的日期 |
| 到货通知状态 | 系统自动更新 | - | - | 包括：草稿、已确认、已验收、已取消 |

### 1.2 到货通知与采购订单关联

#### 数据项映射关系
| 采购订单数据项 | 到货通知数据项 | 映射规则 | 说明 |
|------------|--------------|---------|------|
| 订单编号 | 关联订单编号 | 直接引用 | 用于追溯来源 |
| 商品ID | 商品ID | 直接映射 | 确保商品一致性 |
| 采购数量 | 预计到货数量 | 参考值，可调整 | 实际到货可能与订单不同 |
| 供应商ID | 供应商ID | 直接映射 | 确保供应商一致性 |
| 预计到货日期 | 预计到货日期 | 参考值，可调整 | 实际到货日期可能变更 |

#### 状态变更规则
| 事件 | 采购订单状态变更 | 到货通知状态变更 | 说明 |
|------|--------------|---------------|------|
| 创建到货通知 | 待收货 | 草稿 | 供应商发货后创建 |
| 确认到货通知 | 待收货 | 已确认 | 确认预计到货信息 |
| 商品到货验收 | 待收货 | 已验收 | 商品实际到达并验收 |
| 取消到货通知 | 已确认(恢复) | 已取消 | 供应商取消发货 |

## 2. 商品验收入库流程细项分解

### 2.1 验收单生成与处理

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 验收单编号 | 系统自动生成 | - | - | 编码规则：QC+年月日+3位流水号 |
| 关联到货通知单号 | 直接引用 | - | - | 一个到货通知对应一个验收单 |
| 应收数量 | 来源于到货通知 | 基本计量单位 | 0位小数 | 预期验收的商品数量 |
| 实收数量 | 验收人员填写 | 基本计量单位 | 0位小数 | 实际验收合格的数量 |
| 拒收数量 | 验收人员填写 | 基本计量单位 | 0位小数 | 验收不合格的数量 |
| 差异原因 | 验收人员填写 | - | - | 当实收与应收不符时填写 |
| 质量状况 | 验收人员评定 | - | - | 分为：合格、不合格、部分合格 |
| 验收人员 | 系统记录操作人 | - | - | 负责验收的仓库人员 |
| 验收时间 | 系统记录操作时间 | 日期时间 | - | 验收操作的时间 |
| 验收单状态 | 系统自动更新 | - | - | 包括：验收中、已完成、已取消 |

### 2.2 验收标准与质量控制

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 商品验收标准 | 预设或自定义 | - | - | 不同商品类别有不同标准 |
| 抽样比例 | 根据商品重要性设置 | % | 2位小数 | 验收时的抽样检查比例 |
| 质量检验项 | 预设或自定义 | - | - | 包括外观、包装、标识等 |
| 合格标准 | 预设或自定义 | - | - | 各检验项的合格条件 |
| 不合格处理方式 | 预设或自定义 | - | - | 包括退货、让步接收、降级使用等 |
| 质量问题分类 | 系统预设 | - | - | 用于统计分析质量问题 |
| 质量评分 | 加权计算 | 分 | 1位小数 | 满分100分，用于供应商评估 |

### 2.3 入库单生成与处理

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 入库单编号 | 系统自动生成 | - | - | 编码规则：GR+年月日+3位流水号 |
| 关联验收单号 | 直接引用 | - | - | 验收合格后生成入库单 |
| 入库类型 | 系统自动判断或手工选择 | - | - | 包括：采购入库、调拨入库、退货入库等 |
| 入库数量 | 来源于验收单实收数量 | 基本计量单位 | 0位小数 | 实际入库的商品数量 |
| 入库单价(含税) | 来源于采购订单 | 元/基本单位 | 2位小数 | 含增值税金额 |
| 入库单价(不含税) | 入库单价(含税) / (1 + 税率) | 元/基本单位 | 4位小数 | 不含增值税金额 |
| 入库金额(含税) | 入库数量 × 入库单价(含税) | 元 | 2位小数 | 含增值税总金额 |
| 入库金额(不含税) | 入库数量 × 入库单价(不含税) | 元 | 2位小数 | 不含增值税总金额 |
| 税额 | 入库金额(含税) - 入库金额(不含税) | 元 | 2位小数 | 增值税税额 |
| 入库仓库 | 手工选择或系统默认 | - | - | 商品存放的仓库 |
| 入库库位 | 手工选择或系统推荐 | - | - | 商品存放的具体库位 |
| 入库操作人 | 系统记录操作人 | - | - | 负责入库操作的仓库人员 |
| 入库时间 | 系统记录操作时间 | 日期时间 | - | 入库操作的时间 |
| 入库单状态 | 系统自动更新 | - | - | 包括：草稿、已入库、已冲销 |

## 3. 批次管理流程细项分解

### 3.1 批次生成机制

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 批次编号 | 系统自动生成 | - | - | 编码规则：LOT+年月日+入库单号+2位序号 |
| 关联入库单号 | 直接引用 | - | - | 用于追溯批次来源 |
| 商品ID | 来源于入库单 | - | - | 批次对应的商品 |
| 批次数量 | 入库时设定 | 基本计量单位 | 0位小数 | 批次的初始数量 |
| 批次单价 | 来源于入库单价 | 元/基本单位 | 4位小数 | 批次的成本单价 |
| 生产日期 | 入库时录入 | 日期 | - | 商品的生产日期 |
| 有效期至 | 生产日期 + 保质期 | 日期 | - | 商品的有效期限 |
| 供应商ID | 来源于入库单 | - | - | 批次商品的供应商 |
| 生产批号 | 入库时录入 | - | - | 供应商提供的生产批号 |
| 质量等级 | 根据验收结果确定 | - | - | 批次商品的质量等级 |
| 批次状态 | 系统自动更新 | - | - | 包括：正常、冻结、待检、临期、过期、报废、耗尽 |

### 3.2 批次拆分与合并

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 操作类型 | 手工选择 | - | - | 包括：批次拆分、批次合并 |
| 源批次号 | 手工选择 | - | - | 被拆分或合并的原批次 |
| 目标批次号 | 系统生成或手工选择 | - | - | 拆分生成或合并后的批次 |
| 操作数量 | 手工填写 | 基本计量单位 | 0位小数 | 拆分或合并的商品数量 |
| 操作原因 | 手工填写 | - | - | 进行拆分或合并的业务原因 |
| 操作人员 | 系统记录操作人 | - | - | 执行操作的仓库人员 |
| 操作时间 | 系统记录操作时间 | 日期时间 | - | 操作的具体时间 |

### 3.3 先进先出(FIFO)管理

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| FIFO推荐批次 | 按入库时间升序排序 | - | - | 系统推荐的出库批次顺序 |
| 批次优先级调整 | 根据特殊规则调整 | - | - | 如临期商品优先出库 |
| 批次选择偏差 | 实际选择批次与推荐批次的差异 | 天 | 0位小数 | 入库日期差异天数 |
| 偏差原因分类 | 手工选择 | - | - | 包括：特殊客户需求、库位便利性等 |
| 审批级别 | 根据偏差大小确定 | - | - | 偏差越大，审批级别越高 |
| 批次调整记录 | 系统自动记录 | - | - | 包含调整人、时间、原因等 |

### 3.4 临期商品管理

| 临期商品数量 | 汇总统计 | 基本计量单位 | 0位小数 | 系统自动统计临期商品总量 |
| 临期商品金额 | 临期商品数量 × 批次单价 | 元 | 2位小数 | 用于评估临期商品价值 |
| 临期商品占比 | 临期商品数量 / 总库存数量 × 100% | % | 2位小数 | 用于评估库存结构健康度 |
| 预警通知对象 | 根据商品类别和金额设置 | - | - | 不同级别预警发送给不同人员 |

## 4. 退货处理流程细项分解

### 4.1 退货申请与审核

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 退货申请单号 | 系统自动生成 | - | - | 编码规则：RR+年月日+3位流水号 |
| 关联验收单号 | 直接引用 | - | - | 验收不合格时生成退货申请 |
| 关联入库单号 | 直接引用 | - | - | 入库后发现质量问题时关联 |
| 退货原因 | 手工选择或填写 | - | - | 包括：质量不合格、规格不符等 |
| 退货数量 | 手工填写 | 基本计量单位 | 0位小数 | 申请退回的商品数量 |
| 退货金额(含税) | 退货数量 × 入库单价(含税) | 元 | 2位小数 | 含增值税退货金额 |
| 退货金额(不含税) | 退货数量 × 入库单价(不含税) | 元 | 2位小数 | 不含增值税退货金额 |
| 申请人员 | 系统记录操作人 | - | - | 发起退货申请的人员 |
| 申请时间 | 系统记录操作时间 | 日期时间 | - | 申请的具体时间 |
| 审核状态 | 系统自动更新 | - | - | 包括：待审核、已审核、已拒绝 |

### 4.2 退货单生成与处理

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 退货单编号 | 系统自动生成 | - | - | 编码规则：RT+年月日+3位流水号 |
| 关联退货申请单号 | 直接引用 | - | - | 审核通过后生成退货单 |
| 关联采购订单号 | 来源于入库单 | - | - | 用于追溯原采购信息 |
| 供应商信息 | 来源于入库单 | - | - | 退货的供应商信息 |
| 退货数量 | 来源于退货申请 | 基本计量单位 | 0位小数 | 实际退回的商品数量 |
| 退货单价(含税) | 来源于入库单 | 元/基本单位 | 2位小数 | 含增值税金额 |
| 退货金额(含税) | 退货数量 × 退货单价(含税) | 元 | 2位小数 | 含增值税总金额 |
| 退货金额(不含税) | 退货数量 × 退货单价(不含税) | 元 | 2位小数 | 不含增值税总金额 |
| 退货税额 | 退货金额(含税) - 退货金额(不含税) | 元 | 2位小数 | 增值税税额 |
| 退货方式 | 手工选择 | - | - | 包括：直接退回、换货、折价处理等 |
| 退货物流信息 | 手工填写 | - | - | 包括物流公司、单号等 |
| 退货操作人 | 系统记录操作人 | - | - | 执行退货操作的人员 |
| 退货时间 | 系统记录操作时间 | 日期时间 | - | 退货操作的时间 |
| 退货单状态 | 系统自动更新 | - | - | 包括：待退货、已退货、已取消 |

### 4.3 退货与库存调整

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 库存调整数量 | 负值，等于退货数量 | 基本计量单位 | 0位小数 | 减少相应批次的库存数量 |
| 库存调整金额 | 负值，等于退货金额(不含税) | 元 | 2位小数 | 减少库存总价值 |
| 批次选择规则 | 按入库时间倒序 | - | - | 优先从最新批次中扣减 |
| 批次库存不足处理 | 按LIFO原则跨批次扣减 | - | - | 当最新批次不足时向前追溯 |
| 库存调整单据 | 系统自动生成 | - | - | 记录库存变动明细 |
| 成本调整影响 | 计算退货对平均成本的影响 | 元/基本单位 | 4位小数 | 用于成本核算 |

## 5. 入库与采购订单关系细项分解

### 5.1 采购订单与入库单关系

#### 数据项映射关系
| 采购订单数据项 | 入库单数据项 | 映射规则 | 说明 |
|------------|------------|---------|------|
| 订单编号 | 关联订单编号 | 直接引用 | 用于追溯入库来源 |
| 商品ID | 商品ID | 直接映射 | 确保商品一致性 |
| 采购数量 | 应收数量 | 直接映射 | 作为验收基准 |
| 采购单价(含税) | 入库单价(含税) | 直接映射 | 用于成本核算 |
| 采购单价(不含税) | 入库单价(不含税) | 直接映射 | 用于成本核算 |
| 税率 | 税率 | 直接映射 | 确保税务处理一致 |
| 预计到货日期 | 预计到货日期 | 直接映射 | 用于到货跟踪 |

#### 状态变更规则
| 事件 | 采购订单状态变更 | 入库单状态变更 | 说明 |
|------|--------------|--------------|------|
| 创建到货通知 | 待收货 | - | 供应商发货后创建 |
| 商品到货验收 | 待收货 | 验收中 | 验收过程中状态 |
| 验收合格入库 | 部分入库/已入库 | 已入库 | 根据入库比例确定订单状态 |
| 验收不合格 | 待处理 | 已拒收 | 需协商处理方案 |
| 部分验收合格 | 部分入库 | 部分入库 | 部分商品入库，部分拒收 |

#### 数量核对规则
| 规则类型 | 规则描述 | 触发条件 | 处理方式 |
|---------|---------|---------|----------|
| 数量匹配 | 入库数量 ≤ 订单数量 | 入库验收时 | 超出需特殊审批 |
| 批次管理 | 入库时自动生成批次信息 | 入库确认时 | 记录批次、生产日期等 |
| 部分入库 | 累计入库数量 < 订单数量 | 部分入库时 | 订单状态为"部分入库" |
| 全部入库 | 累计入库数量 = 订单数量 | 全部入库时 | 订单状态更新为"已完成" |
| 超量入库 | 累计入库数量 > 订单数量 | 入库确认时 | 需主管审批并说明原因 |

### 5.2 采购计划-采购订单-入库单完整业务链

#### 数据汇总与报表支持
| 报表类型 | 数据来源 | 汇总维度 | 计算逻辑 | 用途 |
|---------|---------|---------|---------|------|
| 采购计划执行报表 | 计划、订单、入库单 | 商品、供应商、时间 | 计划量vs订单量vs入库量 | 监控计划执行情况 |
| 采购订单跟踪报表 | 订单、入库单 | 订单、供应商、时间 | 订单量vs入库量、延期情况 | 跟踪订单执行情况 |
| 采购入库明细报表 | 入库单、订单 | 商品、批次、供应商 | 入库数量、金额、单价 | 分析采购成本构成 |
| 采购成本分析报表 | 入库单、成本分摊 | 商品、供应商、时间 | 平均采购成本、成本构成 | 优化采购策略 |
| 供应商绩效报表 | 订单、入库单 | 供应商、商品 | 交期、质量、价格综合评估 | 供应商管理决策 |

### 5.3 异常情况处理机制

#### 入库异常
| 异常类型 | 影响范围 | 处理机制 | 数据调整规则 |
|---------|---------|---------|------------|
| 数量不符 | 入库单、订单完成度 | 确认差异原因、协商处理 | 记录实际入库数量，更新订单状态 |
| 质量问题 | 入库单、订单状态 | 退货/换货流程 | 生成退货单，调整订单完成情况 |
| 提前到货 | 入库计划、库存空间 | 评估是否提前入库 | 调整入库计划，记录提前天数 |
| 延期到货 | 库存预警、销售计划 | 紧急采购/调拨评估 | 更新订单状态，触发库存预警 |

### 5.4 数据一致性保障机制

#### 事务完整性
| 业务场景 | 事务边界 | 一致性检查点 | 处理策略 |
|---------|---------|------------|----------|
| 计划生成订单 | 计划更新+订单创建 | 计划数量≥订单总量 | 事务回滚，提示错误 |
| 订单入库 | 订单更新+入库单创建+库存更新 | 订单数量≥入库总量 | 事务回滚，提示错误 |
| 订单变更 | 订单更新+计划执行更新 | 变更后数据一致性 | 事务回滚，提示错误 |
| 入库成本核算 | 入库确认+成本计算+库存价值更新 | 金额计算准确性 | 事务回滚，提示错误 |

#### 数据校验规则
| 校验环节 | 校验内容 | 校验时机 | 不符处理 |
|---------|---------|---------|----------|
| 计划生成订单 | 商品一致性、数量合理性 | 订单创建前 | 提示错误，阻止创建 |
| 订单确认 | 价格合理性、交期可行性 | 订单确认前 | 超出阈值需审批 |
| 到货通知创建 | 与订单一致性 | 通知创建时 | 提示差异，确认后继续 |
| 验收入库 | 数量、质量、规格一致性 | 入库确认前 | 记录差异，按规则处理 |
| 成本核算 | 计算准确性、分摊合理性 | 入库完成后 | 自动校正或人工干预 |

## 6. 入库单与批次管理关系细项分解

### 6.1 批次生成机制
| 触发点 | 生成规则 | 批次编号规则 | 说明 |
|-------|---------|------------|------|
| 入库单确认 | 自动生成批次信息 | LOT+年月日+入库单号+2位序号 | 例如：LOT20230601GR2023060100-01 |
| 同一商品不同生产日期 | 自动拆分为不同批次 | 同一入库单不同批次序号递增 | 确保批次信息的准确性 |
| 同一商品不同供应商 | 自动拆分为不同批次 | 按供应商区分批次 | 便于追溯商品来源 |
| 同一商品不同质量等级 | 自动拆分为不同批次 | 批次备注中标注质量等级 | 便于区分商品质量 |
| 批次合并操作 | 手动合并同一商品相近批次 | 保留最早批次号，备注合并信息 | 适用于少量库存合并管理 |
| 批次拆分操作 | 手动拆分单一批次为多个批次 | 原批次号+分拆标识(A/B/C) | 适用于大批次精细化管理 |

### 6.2 批次与入库单数据映射关系
| 入库单数据项 | 批次数据项 | 映射规则 | 说明 |
|------------|----------|---------|------|
| 入库单号 | 关联入库单号 | 直接引用 | 用于追溯批次来源 |
| 商品ID | 商品ID | 直接映射 | 确保商品一致性 |
| 入库数量 | 批次初始数量 | 按批次拆分映射 | 一个入库单可生成多个批次 |
| 入库单价(不含税) | 批次成本单价 | 直接映射 | 用于成本核算 |
| 供应商ID | 批次供应商ID | 直接映射 | 用于供应商质量追溯 |
| 生产日期 | 批次生产日期 | 直接映射 | 用于保质期管理 |
| 有效期至 | 批次有效期至 | 直接映射 | 用于临期预警 |
| 入库时间 | 批次入库时间 | 直接映射 | 用于先进先出管理 |
| 质检结果 | 批次质量等级 | 根据质检结果映射 | 用于质量追溯 |

### 6.3 批次状态管理
| 批次状态 | 状态描述 | 触发条件 | 允许操作 |
|---------|---------|---------|----------|
| 正常 | 批次可正常使用 | 入库确认后默认状态 | 出库、调拨、盘点、冻结 |
| 冻结 | 批次暂停使用 | 质量问题待确认时 | 解冻、报废 |
| 待检 | 批次等待复检 | 质量存疑时 | 检验、冻结、恢复正常 |
| 临期 | 批次接近有效期 | 距离有效期小于预警天数 | 出库、调价促销、冻结 |
| 过期 | 批次已超过有效期 | 系统自动判定 | 报废处理 |
| 报废 | 批次已报废处理 | 手动报废操作 | 查看报废记录 |
| 耗尽 | 批次库存为零 | 出库后自动判定 | 查看批次历史 |

## 7. 入库管理流程图

```
+----------------+    生成    +----------------+    验收    +----------------+
|                |----------->|                |----------->|                |
|   采购订单     |            |   到货通知     |            |    验收单      |
|                |<-----------|                |<-----------|                |
+----------------+    反馈    +----------------+    更新    +----------------+
                                                                 |
                                                                 |
                                                                 v
+----------------+              +----------------+        +----------------+
|                |              |                |        |                |
|  退货处理     |<-------------|  入库单        |------->|  批次生成     |
|                |              |                |        |                |
+----------------+              +----------------+        +----------------+
                                       |                         |
                                       |                         |
                                       v                         v
                                +----------------+      +----------------+
                                |                |      |                |
                                |  库存更新      |      |  成本核算     |
                                |                |      |                |
                                +----------------+      +----------------+
```

## 8. 入库管理与其他业务流程的衔接

### 8.1 入库与库存管理衔接
| 衔接点 | 上游数据 | 下游数据 | 数据传递机制 | 业务规则 |
|-------|---------|---------|------------|----------|
| 入库更新库存 | 入库单明细 | 库存记录 | 系统自动更新 | 入库确认后立即更新库存 |
| 批次生成 | 入库单明细 | 批次记录 | 系统自动生成 | 按规则自动拆分批次 |
| 库存成本更新 | 入库单价格 | 库存成本 | 系统自动计算 | 按批次记录成本信息 |
| 库存预警解除 | 入库数量 | 库存预警状态 | 系统自动判断 | 当库存超过预警阈值时解除预警 |

### 8.2 入库与财务管理衔接
| 衔接点 | 上游数据 | 下游数据 | 数据传递机制 | 业务规则 |
|-------|---------|---------|------------|----------|
| 应付账款生成 | 入库单金额 | 应付账款 | 系统自动生成 | 入库确认后生成应付账款 |
| 成本核算 | 入库单价格 | 成本账目 | 系统自动计算 | 按会计准则核算成本 |
| 税额处理 | 入库单税额 | 进项税额 | 系统自动计算 | 按税法规定处理税额 |
| 库存价值更新 | 入库单金额 | 库存资产价值 | 系统自动计算 | 更新企业资产负债表 |

## 9. 入库单反审核流程细项分解

### 9.1 反审核触发条件与权限控制

#### 数据项定义
| 数据项 | 计算逻辑 | 单位 | 小数位 | 说明 |
|-------|---------|------|-------|------|
| 反审核申请单号 | 系统自动生成 | - | - | 编码规则：RA+年月日+3位流水号 |
| 关联入库单号 | 直接引用 | - | - | 需要反审核的入库单 |
| 原入库时间 | 来源于入库单 | 日期时间 | - | 原始入库操作的时间 |
| 反审核原因 | 手工填写 | - | - | 包括：数量错误、价格错误、商品错误等 |
| 反审核类型 | 手工选择 | - | - | 包括：全部反审核、部分反审核 |
| 申请人员 | 系统记录操作人 | - | - | 发起反审核申请的人员 |
| 申请时间 | 系统记录操作时间 | 日期时间 | - | 申请的具体时间 |
| 审批状态 | 系统自动更新 | - | - | 包括：待审批、已审批、已拒绝 |

#### 权限控制规则
| 角色 | 可操作范围 | 时间限制 | 审批流程 |
|------|----------|---------|----------|
| 仓库管理员 | 本仓库入库单 | 入库后24小时内 | 一级审批 |
| 采购主管 | 本部门相关入库单 | 入库后7天内 | 一级审批 |
| 财务人员 | 所有入库单 | 入库后15天内 | 二级审批 |
| 部门经理 | 本部门相关入库单 | 入库后30天内 | 二级审批 |
| 财务经理 | 所有入库单 | 当前会计期内 | 最终审批 |
| 总经理 | 所有入库单 | 不限 | 特殊审批 |

#### 时间限制规则
| 时间范围 | 反审核条件 | 审批级别 | 数据影响评估 |
|---------|----------|---------|------------|
| 入库后24小时内 | 基础信息错误 | 一级审批 | 影响较小，无需特殊处理 |
| 入库后7天内 | 数量或金额错误 | 二级审批 | 需评估库存影响 |
| 入库后15天内 | 任何错误 | 三级审批 | 需评估销售和库存影响 |
| 入库后30天内 | 重大错误 | 四级审批 | 全面评估业务影响 |
| 当前会计期内 | 财务重大错误 | 最高审批 | 需评估财务报表影响 |
| 跨会计期 | 特殊情况 | 特殊审批 | 需专项处理方案 |

### 9.2 反审核数据验证与风险评估

#### 数据验证规则
| 验证项 | 验证规则 | 验证时机 | 不符处理 |
|-------|---------|---------|----------|
| 库存可用性 | 当前库存 ≥ 原入库数量 | 反审核申请时 | 库存不足则拒绝反审核 |
| 销售占用 | 检查是否已有销售出库 | 反审核申请时 | 已售出则需特殊处理 |
| 调拨占用 | 检查是否已有调拨出库 | 反审核申请时 | 已调拨则需特殊处理 |
| 盘点状态 | 检查是否已完成盘点 | 反审核申请时 | 已盘点则需评估影响 |
| 财务状态 | 检查是否已结账 | 反审核申请时 | 已结账则需财务审批 |
| 成本核算 | 检查是否影响成本计算 | 反审核申请时 | 评估成本影响范围 |

#### 风险评估维度
| 风险维度 | 评估指标 | 风险等级判定 | 处理策略 |
|---------|---------|------------|----------|
| 库存风险 | 库存可用率 | 低/中/高 | 库存调整预案 |
| 销售风险 | 已售比例 | 低/中/高 | 客户沟通预案 |
| 财务风险 | 金额偏差率 | 低/中/高 | 财务调整预案 |
| 供应商风险 | 供应商关系影响 | 低/中/高 | 供应商沟通预案 |
| 时间风险 | 距原入库时间 | 低/中/高 | 时效性处理预案 |
| 合规风险 | 是否跨会计期 | 低/中/高 | 合规处理预案 |

### 9.3 反审核执行与数据回滚机制

#### 数据回滚规则
| 数据类型 | 回滚方式 | 回滚范围 | 数据处理策略 |
|---------|---------|---------|------------|
| 入库单数据 | 状态回退 | 入库单及明细 | 回退至草稿状态或作废 |
| 库存数据 | 库存调整 | 相关商品库存 | 扣减对应批次库存 |
| 成本数据 | 成本重算 | 相关商品成本 | 重新计算平均成本 |
| 财务数据 | 冲销处理 | 相关会计分录 | 生成冲销凭证 |
| 批次数据 | 批次调整 | 相关商品批次 | 调整或删除批次记录 |
| 订单完成度 | 状态回退 | 关联采购订单 | 更新订单完成状态 |

#### 执行流程控制
| 执行阶段 | 执行内容 | 执行条件 | 异常处理 |
|---------|---------|---------|----------|
| 预检查 | 数据完整性检查 | 反审核前 | 检查失败则终止 |
| 数据冻结 | 锁定相关数据 | 执行反审核时 | 冻结失败则终止 |
| 库存回滚 | 调整库存数量 | 审批通过后 | 记录调整日志 |
| 成本回滚 | 调整成本数据 | 库存回滚后 | 记录调整日志 |
| 财务回滚 | 生成冲销凭证 | 成本回滚后 | 记录调整日志 |
| 状态更新 | 更新相关单据状态 | 所有回滚完成后 | 记录状态变更 |
| 日志记录 | 记录完整操作日志 | 全流程 | 确保可追溯性 |

### 9.4 反审核对关联业务的影响处理

#### 销售数据影响处理
| 影响场景 | 影响范围 | 处理机制 | 数据调整规则 |
|---------|---------|---------|------------|
| 已售未发货 | 销售订单 | 订单商品冻结 | 通知销售人员，调整订单 |
| 已部分发货 | 销售出库单 | 出库单标记异常 | 通知客户，协商处理方案 |
| 已全部发货 | 销售出库单、发票 | 特殊处理流程 | 生成差异处理单，财务专项处理 |
| 已开具发票 | 销售发票 | 发票冲销流程 | 按税务规定处理发票冲销 |
| 已收款 | 收款记录 | 财务核对 | 资金差异处理，可能需退款 |

#### 调拨业务影响处理
| 影响场景 | 影响范围 | 处理机制 | 数据调整规则 |
|---------|---------|---------|------------|
| 已调拨未收货 | 调拨出库单 | 取消调拨 | 通知相关仓库，取消调拨 |
| 已部分收货 | 调拨入库单 | 调拨单标记异常 | 生成差异处理单，调整库存 |
| 已全部收货 | 调拨入库单、库存 | 特殊处理流程 | 双仓库协同处理，调整库存 |
| 跨公司调拨 | 内部交易单据 | 财务核对 | 生成内部往来调整单 |

#### 盘点业务影响处理
| 影响场景 | 影响范围 | 处理机制 | 数据调整规则 |
|---------|---------|---------|------------|
| 盘点进行中 | 盘点单 | 中止盘点 | 通知仓库，重新盘点 |
| 盘点已完成 | 盘点差异单 | 重新计算差异 | 调整盘点差异数据 |
| 盘盈盘亏已处理 | 盘盈盘亏单、财务 | 特殊处理流程 | 生成调整单，财务重新处理 |
| 跨期盘点 | 财务报表 | 财务核对 | 可能需调整历史报表 |

#### 成本核算影响处理
| 影响场景 | 影响范围 | 处理机制 | 数据调整规则 |
|---------|---------|---------|------------|
| 当期未结算 | 商品成本 | 重新计算 | 自动重算当期成本 |
| 当期已结算 | 成本结算单 | 重新结算 | 生成成本调整单 |
| 跨期未结算 | 历史成本 | 追溯调整 | 生成历史调整单 |
| 跨期已结算 | 财务报表 | 财务核对 | 可能需调整历史报表 |

### 9.5 反审核操作记录与追溯机制

#### 操作日志记录
| 日志类型 | 记录内容 | 记录时机 | 保存期限 |
|---------|---------|---------|----------|
| 申请日志 | 申请人、时间、原因 | 申请提交时 | 永久 |
| 审批日志 | 审批人、时间、意见 | 每级审批时 | 永久 |
| 执行日志 | 执行人、时间、内容 | 执行操作时 | 永久 |
| 数据变更日志 | 变更前后数据对比 | 数据变更时 | 永久 |
| 关联业务影响日志 | 影响范围、处理方式 | 关联处理时 | 永久 |
| 异常处理日志 | 异常类型、处理方式 | 异常发生时 | 永久 |

#### 数据追溯链路
| 追溯维度 | 追溯内容 | 追溯方式 | 展示形式 |
|---------|---------|---------|----------|
| 单据追溯 | 原单-反审核-新单 | 单据关联查询 | 单据关系图 |
| 库存追溯 | 库存变动完整记录 | 库存流水查询 | 库存变动表 |
| 财务追溯 | 会计分录完整记录 | 凭证关联查询 | 凭证关系图 |
| 操作追溯 | 操作人员完整记录 | 操作日志查询 | 操作时间线 |
| 审批追溯 | 审批流程完整记录 | 审批流程查询 | 审批流程图 |
| 全链路追溯 | 业务全过程记录 | 综合查询 | 业务流程图 |









