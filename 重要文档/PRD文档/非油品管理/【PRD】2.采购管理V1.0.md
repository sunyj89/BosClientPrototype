### **2. 模块：采购管理 (Procurement Management)**

------

#### **2.1 版本修订历史**

| 版本号 | 修订日期   | 修订人 | 修订内容                       |
| ------ | ---------- | ------ | ------------------------------ |
| V1.0   | 2025-06-26 | 孙杨竣 | 初稿，创建采购管理模块核心功能 |

#### **2.2 模块概述**

采购管理模块覆盖了从供应商询价、下达采购订单、收货入库到供应商退货、以及油站（仓）间库存调拨的全过程。本模块旨在规范采购与库存流转流程、控制采购成本、保障商品供应并实现库存的合理分配。同时，引入智能补货机制，旨在从被动补货转向主动、数据驱动的备货，以提升资金周转率并降低缺货风险。

#### **2.3 功能范围与目标**

- **目标一：成本管控** - 实现采购价格的记录与维护，为成本核算提供依据。
- **目标二：流程标准化** - 建立标准的采购订单（PO）、退货单（RTV）和调拨单（TO）的处理流程，包含必要的审批环节。
- **目标三：库存准确性** - 确保采购入库、退货出库、调拨出入库等操作能准确、及时地反映到库存变化上。
- **目标四：补货智能化** - 通过配置补货规则和引入需求预测模型，自动化生成补货建议，提高补货效率和科学性。

------

### **3. 核心功能设计**

#### **3.1 价格维护 ( Price Maintenance)**

- 功能描述:

  此功能用于记录和管理同一SKU从不同供应商处的采购价格，并确定主供应商及其采购价，作为生成采购订单时的默认价格。

- **核心功能:**

  - **供应商报价录入:** 允许为单个SKU添加多个供应商的报价信息，包括：`供应商名称`、`采购价格(含税/不含税)`、`最小起订量 (MOQ)`、`供货周期`、`报价有效期`。
  - **主供应商与价格设定:** 可将某一供应商设置为该SKU的“主供应商”。生成采购订单时，系统将默认带入主供应商的采购价格。
  - **价格变更历史:** 系统需记录所有采购价格的变更历史，便于追溯和成本分析。

#### **3.2 采购订单管理 (Purchase Order Management)**

- 功能描述:

  管理从创建采购订单到最终收货入库的全过程，确保采购流程的闭环。

- **采购订单 (PO) 状态生命周期:**

  ```mermaid
  stateDiagram-v2
      [*] --> 草稿
      草稿 --> 待审核 : 提交
      待审核 --> 待供应商确认 : 审核通过
      待审核 --> 已驳回 : 审核驳回
      已驳回 --> 草稿 : 修改后重新提交
      待供应商确认 --> 待入库 : 供应商确认
      待入库 --> 部分入库 : 收到部分货物
      待入库 --> 已完成 : 收到全部货物
      部分入库 --> 部分入库 : 再次收到部分货物
      部分入库 --> 已完成 : 收到剩余全部货物
      待入库 --> 已关闭 : 手动关单
      部分入库 --> 已关闭 : 手动关单
  ```
  
- **核心流程:**

  1. **创建PO:**
     - **创建方式:** 支持 `手动创建` 和 `从补货建议一键生成` 两种方式。
     - **核心字段:** `PO单号`、`供应商`、`收货油站/仓库`、`期望到货日期`、`商品明细列表 (SKU/名称/单位/采购数量/采购单价/金额)`、`总金额`、`备注`。
  2. **审核:** PO提交后进入“待审核”状态。具有审批权限的用户（如店长、采购主管）进行审核。审核通过后，PO状态变为“待供应商确认”。
  3. **供应商确认:**
     - **线下确认 (V1.0):** 采购员将PO导出（PDF/Excel）发送给供应商。在系统中手动点击“确认”，使PO进入“待入库”状态。
     - **线上确认 (V2.0 规划):** 提供供应商门户，供应商可在线查看PO并进行接单操作。
  4. **采购入库 (Goods Receiving):**
     - 仓库管理员在“收货”功能模块，通过PO单号调出待入库订单。
     - 通过PDA扫描或手动方式，清点实际到货数量，录入`实收数量`。
     - 系统自动比对`采购数量`与`实收数量`的差异。
     - 确认收货后，系统自动生成`入库单`，并**实时增加对应仓库的SKU库存**。
     - PO状态根据入库情况变为“部分入库”或“已完成”。
  5. **关单 (Close Order):** 对于无法完全履约或需要提前终止的PO，支持手动关单，关单后订单不可再进行收货操作。

#### **3.3 退货管理 (Return to Vendor - RTV)**

- 功能描述:

  管理因质量问题、临期、滞销等原因需要退回给供应商的商品。

- **核心流程:**

  1. **创建退供单 (RTV):**
     - 由油站/仓库人员创建，选择需要退货的`供应商`。
     - 添加需要退货的`SKU`及`退货数量`，填写`退货原因`（如：包装破损、质量问题）。
     - 退货价格默认取该商品最近一次的采购价，但允许修改。
  2. **审核:** RTV单提交后进入审批流程。审核通过后，状态变为“待出库”。
  3. **退货出库:** 仓库管理员根据审核通过的RTV单进行拣货，确认后执行“退货出库”操作。系统自动生成`出库单`，并**实时扣减对应仓库的SKU库存**。RTV单状态变为“已完成”。

#### **3.4 仓间调拨 (Stock Transfer)**

- 功能描述:

  实现在公司内部不同油站、仓库之间的商品调动，以平衡库存，满足各站点的销售需求。

- **核心流程:**

  1. **创建调拨单 (TO):**
     - 由申请方（要货方）或调出方创建。
     - **核心字段:** `调拨单号`、`调出仓`（如：中心仓）、`调入仓`（如：A加油站）、`期望到货日期`、`商品明细 (SKU/调拨数量)`、`备注`。
  2. **审核:** 调拨单提交后，需由指定负责人（如区域经理）审核。审核通过后，状态变为“待出库”。
  3. **调拨出库:**
     - `调出仓`的仓库管理员根据审核通过的TO单进行拣货和发货操作。
     - 确认出库后，系统自动扣减`调出仓`的**物理库存**，同时增加`调入仓`的**在途库存**。
     - TO单状态变为“在途/待入库”。
  4. **调拨入库:**
     - `调入仓`收到货物后，清点确认。
     - 在系统中执行“调拨入库”操作，录入实际收到的数量。
     - 确认入库后，系统扣减`调入仓`的**在途库存**，同时增加其**物理库存**。
     - TO单状态变为“已完成”。

#### **3.5 智能补货 (Intelligent Replenishment)**

- 功能描述:

  变“人找货”为“货找人”，系统基于预设规则和数据分析，自动为各油站生成补货建议，是提升运营效率的关键。

- **核心功能:**

  - **补货规则配置:**
    - **安全库存策略:** 为每个`SKU`在每个`油站`设置`最高库存`和`最低库存`（安全库存）。当`当前库存` <= `最低库存`时，触发补货。
    - **补货点 (Reorder Point):** 公式为 `补货点 = (平均每日销量 × 采购提前期) + 安全库存`。当库存低于此点时触发补货。
  - **需求预测 (Demand Forecasting) - (高级功能):**
    - **模型输入:**
      - `历史销售数据`: 过去N周/月的销售趋势。
      - `季节性因素`: 夏季冷饮、冬季热饮等。
      - `促销活动`: 预知的促销计划会带来的销量提升。
      - `特殊事件`: 节假日、天气变化等。
    - **模型输出:** 预测未来一段时间内（如下一个补货周期）各SKU的预估销量。
  - **补货建议生成:**
    - 系统每日定时运行补货逻辑。
    - 扫描所有站点的所有SKU，结合`补货规则`和`需求预测`结果，计算出建议补货量。
    - **计算逻辑 (示例):** `建议补货量 = (最高库存 或 预测需求量) - 当前库存 - 在途库存`。
    - 将所有需要补货的商品生成一张“补货建议清单”。
  - **补货建议处理:**
    - 采购员或店长在“智能补货”页面查看建议清单。
    - 清单上需清晰展示`SKU`、`当前库存`、`建议补货量`、`主供应商`等信息，并可追溯计算依据（如“低于安全库存”）。
    - 操作员可以对建议数量进行修改，然后**一键将补货建议转化为一张或多张采购订单(PO)**。

------

### **4. 非功能性需求**

- **集成性:** 本模块需与`商品中心`、`库存中心`、`供应商管理`模块无缝集成，保证数据流转的实时性和一致性。
- **可用性:** 各类单据的创建、查询界面友好，支持模糊搜索和批量操作。智能补货的建议结果需直观易懂。
- **可配置性:** 补货算法的关键参数（如预测周期、安全库存系数）应支持后台配置，以适应不同业务阶段的需求。