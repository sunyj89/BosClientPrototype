# 非油品进销存系统数据库设计字典

## 2. 基础信息表设计

### 2.1 商品基础信息表(product)

```sql
CREATE TABLE product (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_code VARCHAR(30) NOT NULL COMMENT '商品编码',
    product_name VARCHAR(100) NOT NULL COMMENT '商品名称',
    short_name VARCHAR(50) COMMENT '商品简称',
    mnemonic_code VARCHAR(30) COMMENT '助记码',
    barcode VARCHAR(30) COMMENT '条形码',
    category_id BIGINT UNSIGNED NOT NULL COMMENT '商品分类ID',
    brand_id BIGINT UNSIGNED COMMENT '品牌ID',
    base_unit_id BIGINT UNSIGNED NOT NULL COMMENT '基本单位ID',
    aux_unit_id BIGINT UNSIGNED COMMENT '辅助单位ID',
    conversion_rate DECIMAL(10,3) COMMENT '单位换算比率',
    specification VARCHAR(200) COMMENT '规格型号',
    # weight DECIMAL(10,3) COMMENT '重量',
    # volume DECIMAL(10,3) COMMENT '体积',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否有效(0-否 1-是)',
    input_tax_rate DECIMAL(5,2) COMMENT '进项税率',
    output_tax_rate DECIMAL(5,2) COMMENT '销项税率',
    min_stock DECIMAL(10,3) DEFAULT 0 COMMENT '最低库存',
    max_stock DECIMAL(10,3) DEFAULT 0 COMMENT '最高库存',
    shelf_life INT COMMENT '保质期(天)',
    warning_days INT COMMENT '临期预警天数',
    status VARCHAR(20) NOT NULL DEFAULT 'DRAFT' COMMENT '状态(DRAFT草稿,PENDING待审核,ACTIVE生效,INACTIVE停用)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    approved_by VARCHAR(50) COMMENT '审核人',
    approved_at DATETIME COMMENT '审核时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_product_code (product_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品基础信息表';
```

### 2.2 商品分类表(product_category)

```sql
CREATE TABLE product_category (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    category_code VARCHAR(30) NOT NULL COMMENT '分类编码',
    category_name VARCHAR(50) NOT NULL COMMENT '分类名称',
    parent_id BIGINT UNSIGNED COMMENT '父级分类ID',
    level INT NOT NULL COMMENT '层级',
    path VARCHAR(255) COMMENT '分类路径',
    sort_order INT DEFAULT 0 COMMENT '排序号',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用(0-否 1-是)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_category_code (category_code),
    KEY idx_parent_id (parent_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品分类表';
```

### 2.3 品牌表(brand)——不需要维护品牌

```sql
CREATE TABLE brand (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    brand_code VARCHAR(30) NOT NULL COMMENT '品牌编码',
    brand_name VARCHAR(50) NOT NULL COMMENT '品牌名称',
    english_name VARCHAR(100) COMMENT '英文名称',
    brand_type VARCHAR(20) COMMENT '品牌类型(自有品牌/合作品牌/代理品牌)',
    logo_url VARCHAR(255) COMMENT '品牌LOGO',
    company VARCHAR(100) COMMENT '所属公司',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用(0-否 1-是)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    sort_order INT DEFAULT 0 COMMENT '排序号',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_brand_code (brand_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='品牌表';
```

### 2.4 单位表(unit)

```sql
CREATE TABLE unit (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    unit_code VARCHAR(20) NOT NULL COMMENT '单位编码',
    unit_name VARCHAR(30) NOT NULL COMMENT '单位名称',
    unit_type VARCHAR(20) COMMENT '单位类型',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用(0-否 1-是)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_unit_code (unit_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='单位表';
```

## 3. 价格和供应商相关表设计

### 3.1 商品价格表(product_price)

```sql
CREATE TABLE product_price (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_id BIGINT UNSIGNED NOT NULL COMMENT '商品ID',
    price_type VARCHAR(20) NOT NULL COMMENT '价格类型(零售价/批发价/会员价)',
    price DECIMAL(10,2) NOT NULL COMMENT '价格',
    effective_date DATE NOT NULL COMMENT '生效日期',
    expiry_date DATE COMMENT '失效日期',
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT '状态(ACTIVE生效/INACTIVE失效)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    KEY idx_product_id (product_id),
    UNIQUE KEY uk_product_price_type (product_id, price_type, effective_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品价格表';
```

### 3.2 供应商表(supplier)

```sql
CREATE TABLE supplier (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    supplier_code VARCHAR(30) NOT NULL COMMENT '供应商编码',
    supplier_name VARCHAR(100) NOT NULL COMMENT '供应商名称',
    contact_person VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(20) COMMENT '联系电话',
    address VARCHAR(200) COMMENT '地址',
    email VARCHAR(100) COMMENT '邮箱',
    tax_code VARCHAR(30) COMMENT '税号',
    bank_name VARCHAR(100) COMMENT '开户行',
    bank_account VARCHAR(30) COMMENT '银行账号',
    credit_limit DECIMAL(12,2) COMMENT '信用额度',
    payment_term INT COMMENT '付款周期(天)',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用(0-否 1-是)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_supplier_code (supplier_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='供应商表';
```

### 3.3 商品供应商关联表(product_supplier)

```sql
CREATE TABLE product_supplier (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_id BIGINT UNSIGNED NOT NULL COMMENT '商品ID',
    supplier_id BIGINT UNSIGNED NOT NULL COMMENT '供应商ID',
    purchase_price DECIMAL(10,2) COMMENT '采购价',
    is_default TINYINT(1) DEFAULT 0 COMMENT '是否默认供应商(0-否 1-是)',
    min_order_qty DECIMAL(10,3) COMMENT '最小订购量',
    lead_time INT COMMENT '供货周期(天)',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用(0-否 1-是)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_product_supplier (product_id, supplier_id),
    KEY idx_product_id (product_id),
    KEY idx_supplier_id (supplier_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品供应商关联表';
```

## 4. 规格属性和图片相关表设计

### 4.1 商品属性表(product_attribute)

```sql
CREATE TABLE product_attribute (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    attribute_code VARCHAR(30) NOT NULL COMMENT '属性编码',
    attribute_name VARCHAR(50) NOT NULL COMMENT '属性名称',
    attribute_type VARCHAR(20) NOT NULL COMMENT '属性类型(文本/数字/日期/单选/多选)',
    category_id BIGINT UNSIGNED COMMENT '分类ID',
    is_required TINYINT(1) DEFAULT 0 COMMENT '是否必填(0-否 1-是)',
    is_searchable TINYINT(1) DEFAULT 0 COMMENT '是否支持搜索(0-否 1-是)',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用(0-否 1-是)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    sort_order INT DEFAULT 0 COMMENT '排序号',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_attribute_code (attribute_code),
    KEY idx_category_id (category_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品属性表';
```

### 4.2 商品属性值表(product_attribute_value)

```sql
CREATE TABLE product_attribute_value (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_id BIGINT UNSIGNED NOT NULL COMMENT '商品ID',
    attribute_id BIGINT UNSIGNED NOT NULL COMMENT '属性ID',
    attribute_value TEXT NOT NULL COMMENT '属性值',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_product_attribute (product_id, attribute_id),
    KEY idx_product_id (product_id),
    KEY idx_attribute_id (attribute_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品属性值表';
```

### 4.3 商品图片表(product_image)

```sql
CREATE TABLE product_image (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_id BIGINT UNSIGNED NOT NULL COMMENT '商品ID',
    image_url VARCHAR(255) NOT NULL COMMENT '图片URL',
    image_type VARCHAR(20) NOT NULL COMMENT '图片类型(主图/详情图/缩略图)',
    sort_order INT DEFAULT 0 COMMENT '排序号',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    KEY idx_product_id (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品图片表';
```

## 5. 审核流程和变更历史表设计

### 5.1 商品审核记录表(product_approval)

```sql
CREATE TABLE product_approval (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_id BIGINT UNSIGNED NOT NULL COMMENT '商品ID',
    approval_type VARCHAR(20) NOT NULL COMMENT '审核类型(新增/修改/停用)',
    approval_status VARCHAR(20) NOT NULL COMMENT '审核状态(待审核/通过/拒绝)',
    approver VARCHAR(50) COMMENT '审核人',
    approval_time DATETIME COMMENT '审核时间',
    approval_comment TEXT COMMENT '审核意见',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    KEY idx_product_id (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品审核记录表';
```

### 5.2 商品变更历史表(product_history)

```sql
CREATE TABLE product_history (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_id BIGINT UNSIGNED NOT NULL COMMENT '商品ID',
    change_type VARCHAR(20) NOT NULL COMMENT '变更类型(新增/修改/停用)',
    change_field VARCHAR(50) COMMENT '变更字段',
    old_value TEXT COMMENT '原值',
    new_value TEXT COMMENT '新值',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    KEY idx_product_id (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品变更历史表';
```

## 6. 外键约束和索引设计

为确保数据完整性和提高查询性能，所有表都应添加适当的外键约束和索引。以下是主要的外键约束关系：

```sql
-- 商品表外键
ALTER TABLE product
    ADD CONSTRAINT fk_product_category FOREIGN KEY (category_id) REFERENCES product_category (id),
    ADD CONSTRAINT fk_product_brand FOREIGN KEY (brand_id) REFERENCES brand (id),
    ADD CONSTRAINT fk_product_base_unit FOREIGN KEY (base_unit_id) REFERENCES unit (id),
    ADD CONSTRAINT fk_product_aux_unit FOREIGN KEY (aux_unit_id) REFERENCES unit (id);

-- 商品分类表外键
ALTER TABLE product_category
    ADD CONSTRAINT fk_category_parent FOREIGN KEY (parent_id) REFERENCES product_category (id);

-- 商品价格表外键
ALTER TABLE product_price
    ADD CONSTRAINT fk_price_product FOREIGN KEY (product_id) REFERENCES product (id);

-- 商品供应商关联表外键
ALTER TABLE product_supplier
    ADD CONSTRAINT fk_product_supplier_product FOREIGN KEY (product_id) REFERENCES product (id),
    ADD CONSTRAINT fk_product_supplier_supplier FOREIGN KEY (supplier_id) REFERENCES supplier (id);

-- 商品属性表外键
ALTER TABLE product_attribute
    ADD CONSTRAINT fk_attribute_category FOREIGN KEY (category_id) REFERENCES product_category (id);

-- 商品属性值表外键
ALTER TABLE product_attribute_value
    ADD CONSTRAINT fk_attribute_value_product FOREIGN KEY (product_id) REFERENCES product (id),
    ADD CONSTRAINT fk_attribute_value_attribute FOREIGN KEY (attribute_id) REFERENCES product_attribute (id);

-- 商品图片表外键
ALTER TABLE product_image
    ADD CONSTRAINT fk_image_product FOREIGN KEY (product_id) REFERENCES product (id);

-- 商品审核记录表外键
ALTER TABLE product_approval
    ADD CONSTRAINT fk_approval_product FOREIGN KEY (product_id) REFERENCES product (id);

-- 商品变更历史表外键
ALTER TABLE product_history
    ADD CONSTRAINT fk_history_product FOREIGN KEY (product_id) REFERENCES product (id);
```





## 针对产品表结构分析和建议

### 1. 一品多单位：固定与自定义转换

您提到了两种转换场景，这正是区分普通商品和“生鲜”、“散称”等非标品（Catch-Weight items）的关键。

- **固定比例转换 (Fixed Conversion)**:
  - **场景**: 一箱可乐固定装12瓶。这里的“箱”与“瓶”的换算比率 `12` 是恒定不变的。
  - **方案**: 之前的 `conversion_rate` 字段设计可以很好地处理这种情况。这个比率定义在商品主数据中，在所有业务环节（采购、销售、库存）中都保持一致。
- **自定义转换 (Variable/Catch-Weight Conversion)**:
  - **场景**: 一箱苹果，理论上重10公斤，但每次采购入库时，A箱可能是10.2公斤，B箱可能是9.9公斤。这里的“箱”和“公斤”的换算关系是浮动的。
  - **方案**: 固定比率无法满足此需求。最佳实践不是在商品主数据里定义一个“不准确”的比率，而是在**业务单据层面**解决。
    - **商品主数据**: 对于这类商品，可以设置一个“主单位”（如“箱”）和一个“计价/库存单位”（如“公斤”）。在商品表中可以增加一个标识字段，例如 `is_catch_weight TINYINT(1) DEFAULT 0`，来标记这是不是一个需要现场称重的商品。
    - **业务单据（采购单/入库单/销售单）**: 在单据的明细行上，需要同时记录两个数量字段。例如，在入库单明细上：
      - `quantity_in_main_unit`: 数量（主单位），例如 `1` (箱)
      - `quantity_in_stock_unit`: 数量（库存单位），例如 `10.2` (公斤)
    - **库存管理**: 库存的记账单位**必须**是那个更精确的单位（公斤）。也就是说，库存里记录的是 `10.2` 公斤，而不是 `1` 箱。成本核算也应基于公斤。
    - **总结**: 固定比例在商品主数据（Product或SKU表）中定义；浮动比例在**交易单据**中体现，库存以精确单位进行管理。

------



### 2. 税率与成本变化的管理

当进项税、销项税、成本这些财务关键数据发生变化时，直接修改商品主表里的当前值会导致历史报表（如过去的利润分析）不准确。

- **问题**: 如果今天把一个商品的成本从￥80改成￥85，那么上周的销售订单在重新计算利润时，会错误地使用￥85的新成本，导致数据失真。

- **解决方案：历史追溯（Versioning/Logging）**

  - **原则**: 不“更新”数据，而是“追加”新数据并标记生效日期。

  - **成本管理**: 成本与供应商和时间强相关。因此，在您规划的 `product_supplier` 表（或者叫 `sku_supplier` 更准确）中，不应该只有一个 `cost` 字段。而应该设计成一个价格履历表。

    SQL

    ```
    -- SKU供应商成本历史表
    CREATE TABLE sku_supplier_cost_history (
        id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
        sku_id BIGINT UNSIGNED NOT NULL,
        supplier_id BIGINT UNSIGNED NOT NULL,
        cost DECIMAL(12, 4) NOT NULL COMMENT '采购成本',
        effective_from_date DATE NOT NULL COMMENT '生效开始日期',
        -- effective_to_date DATE COMMENT '生效结束日期, NULL表示至今有效', -- 可选
        created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (sku_id) REFERENCES sku(id),
        FOREIGN KEY (supplier_id) REFERENCES supplier(id)
    );
    ```

    当查询某笔历史交易的成本时，根据交易日期去这个历史表中查找当时有效的成本记录。

  - **税率管理**: 税率的变化频率通常较低，但同样需要追溯。

    SQL

    ```
    -- SKU税率历史表
    CREATE TABLE sku_tax_rate_history (
        id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
        sku_id BIGINT UNSIGNED NOT NULL,
        input_tax_rate DECIMAL(5,2) COMMENT '进项税率',
        output_tax_rate DECIMAL(5,2) COMMENT '销项税率',
        effective_from_date DATE NOT NULL COMMENT '生效开始日期',
        created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (sku_id) REFERENCES sku(id)
    );
    ```

    在SKU主表中，可以保留 `current_input_tax_rate` 和 `current_output_tax_rate` 字段用于当前交易，但所有历史报表的计算都应关联此历史表。

------



### 3. Weight 和 Volume 的归属与单位

- **归属 (SKU vs SPU)**:
  - `weight` (重量) 和 `volume` (体积) 是**物流和库存**的强相关属性。一个SPU（例如 "iPhone 15 Pro"）本身没有重量，但一个具体的SKU（例如 "iPhone 15 Pro - 256GB - 原色钛金属" 及其包装盒）才有精确的、可用于计算运费的重量和体积。
  - **结论**: `weight` 和 `volume` **毫无疑问属于 SKU 表**。
- **单位联动**:
  - 是的，必须有单位！没有单位的数字是无意义的。
  - **建议**: 在 `sku` 表中增加单位字段。
    - `weight_unit_id`: BIGINT，关联到一个计量单位表（例如，关联到ID为1的单位“kg”，ID为2的单位“g”）。
    - `volume_unit_id`: BIGINT，关联到同一个计量单位表（例如，关联到ID为10的单位“m³”，ID为11的单位“cm³”）。
  - 这样做可以确保数据的严谨性，并在需要时进行单位换算（例如，所有重量都换算成kg来汇总计算）。

------



### 4. 综合建议方案与表结构设计



基于以上所有讨论，我们来重新设计一套更科学的、支持SPU/SKU模式的表结构。

#### 表1: `product` (SPU - 标准产品单元)——不做spu的设计

- **职责**: 定义一类产品的共性信息，用于归类和展示。

```sql
CREATE TABLE product (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID (SPU ID)',
    product_name VARCHAR(100) NOT NULL COMMENT '商品通用名称 (如 "iPhone 15 Pro")',
    category_id BIGINT UNSIGNED NOT NULL COMMENT '商品分类ID',
    brand_id BIGINT UNSIGNED COMMENT '品牌ID',
    list_price DECIMAL(10,2) COMMENT '建议零售价/标价 (非强制)',
    -- 描述性信息可以放在这里
    description TEXT COMMENT '商品描述',
    -- SPU的生命周期管理
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' COMMENT 'SPU状态(ACTIVE,INACTIVE)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品SPU表';
```



#### 表2: `sku` (SKU - 库存量单位)

- **职责**: 定义一个具体、可销售、可库存的单品。这是进销存管理的核心。

```sql
CREATE TABLE sku (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID (SKU ID)',
    product_id BIGINT UNSIGNED NOT NULL COMMENT '关联的SPU ID',
    sku_code VARCHAR(30) NOT NULL COMMENT 'SKU编码, 系统唯一',
    sku_name VARCHAR(150) NOT NULL COMMENT 'SKU完整名称 (如 "iPhone 15 Pro 256GB 原色钛金属")',
    barcode VARCHAR(30) COMMENT '条形码',
    -- 规格属性, 建议使用JSON或专用属性表来存储, 这里用VARCHAR简化
    specifications VARCHAR(200) COMMENT '规格描述 (如 "颜色:原色钛金属; 容量:256GB")',

    -- 单位体系
    base_unit_id BIGINT UNSIGNED NOT NULL COMMENT '基本/库存单位ID',
    aux_unit_id BIGINT UNSIGNED COMMENT '辅助单位ID',
    conversion_rate DECIMAL(10,3) COMMENT '固定单位换算比率 (仅用于固定转换)',
    is_catch_weight TINYINT(1) DEFAULT 0 COMMENT '是否为散称/变重商品(0-否 1-是)',

    -- 物流属性
    weight DECIMAL(10,3) COMMENT '重量',
    weight_unit_id BIGINT UNSIGNED COMMENT '重量单位ID',
    volume DECIMAL(10,3) COMMENT '体积',
    volume_unit_id BIGINT UNSIGNED COMMENT '体积单位ID',

    -- 财务信息 (当前值)
    current_input_tax_rate DECIMAL(5,2) COMMENT '当前进项税率',
    current_output_tax_rate DECIMAL(5,2) COMMENT '当前销项税率',

    -- 库存与效期管理
    min_stock DECIMAL(10,3) DEFAULT 0 COMMENT '最低库存',
    max_stock DECIMAL(10,3) DEFAULT 0 COMMENT '最高库存',
    shelf_life INT COMMENT '保质期(天)',
    warning_days INT COMMENT '临期预警天数',

    -- SKU的生命周期与审核
    status VARCHAR(20) NOT NULL DEFAULT 'DRAFT' COMMENT '状态(DRAFT草稿,PENDING待审核,ACTIVE生效,INACTIVE停用)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    
    -- 审计日志
    created_by VARCHAR(50) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by VARCHAR(50),
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP,
    approved_by VARCHAR(50),
    approved_at DATETIME,
    
    UNIQUE KEY uk_sku_code (sku_code),
    KEY idx_product_id (product_id),
    FOREIGN KEY (product_id) REFERENCES product(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品SKU表';
```



#### 表3: `sku_supplier`



- **职责**: 维护SKU与供应商的供应关系，但成本用历史表管理。



```sql
CREATE TABLE sku_supplier (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    sku_id BIGINT UNSIGNED NOT NULL,
    supplier_id BIGINT UNSIGNED NOT NULL,
    supplier_sku_code VARCHAR(50) COMMENT '供应商侧的SKU编码',
    lead_time INT COMMENT '采购提前期(天)',
    is_primary TINYINT(1) DEFAULT 0 COMMENT '是否主供应商(0-否 1-是)',
    UNIQUE KEY uk_sku_supplier (sku_id, supplier_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='SKU供应商关系表';
```

*(成本和价格已分离到各自的历史表中)*

这个方案将SPU和SKU的职责清晰地分开，并为价格、成本、税率等动态数据建立了可追溯的历史模型，能够很好地满足您提出的所有业务需求，确保了数据的**一致性、准确性和灵活性**。



好的，遵照您的要求，我们不修改 `product_category` 和 `brand` 表，仅采纳关于单位标准换算的建议来更新 `unit` 表的设计。

这个设计的核心思想是：在每一种单位类型（如“重量”、“长度”）中，指定**一个**基础单位，其他所有同类型的单位都记录其相对于这个基础单位的换算系数。这样，任意两个同类型单位的转换都可以通过这个基础单位作为“桥梁”来自动计算。

-----

### 更新后的 `unit` (单位表) 表结构

下面是更新后的 `CREATE TABLE` 语句，其中增加了 `is_base_unit` 和 `conversion_factor` 两个字段，并对注释进行了解释。

```sql
CREATE TABLE unit (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    unit_code VARCHAR(20) NOT NULL COMMENT '单位编码',
    unit_name VARCHAR(30) NOT NULL COMMENT '单位名称',
    unit_type VARCHAR(20) NOT NULL COMMENT '单位类型 (如: 重量, 体积, 长度, 数量)',
    is_base_unit TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否为基础单位(0-否 1-是), 同一类型中应仅有一个基础单位',
    conversion_factor DECIMAL(18, 8) NOT NULL DEFAULT 1.00000000 COMMENT '换算系数 (换算为同类型基础单位的乘数)',
    is_active TINYINT(1) DEFAULT 1 COMMENT '是否启用(0-否 1-是)',
    is_deleted TINYINT(1) DEFAULT 0 COMMENT '是否删除(0-否 1-是)',
    created_by VARCHAR(50) NOT NULL COMMENT '创建人',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    remark TEXT COMMENT '备注',
    UNIQUE KEY uk_unit_code (unit_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='单位表 (支持标准换算)';
```

### 关键字段说明

1.  **`unit_type` (单位类型)**: `VARCHAR(20) NOT NULL`

      * 此字段变为必填项，因为换算逻辑依赖于此分类。

2.  **`is_base_unit` (是否为基础单位)**: `TINYINT(1) NOT NULL DEFAULT 0`

      * 用于标记在一个 `unit_type` 中作为换算基准的单位。
      * **业务约束**: 对于每一个 `unit_type`，应该有且仅有一个单位的 `is_base_unit` 值为 `1`。

3.  **`conversion_factor` (换算系数)**: `DECIMAL(18, 8) NOT NULL DEFAULT 1.00000000`

      * 表示 **“1 个当前单位 = 多少个基础单位”**。
      * 对于基础单位本身，此值恒为 `1`。
      * 高精度 `DECIMAL` 类型可以满足绝大多数科学和工业级别的换算需求。

-----

### 如何使用：示例

我们以“重量”(`unit_type = 'Weight'`) 为例，看看如何填充数据：

| id  | unit\_name | unit\_type | is\_base\_unit | conversion\_factor | 备注                                   |
| --- | --------- | --------- | :----------: | ----------------- | -------------------------------------- |
| 1   | 克(g)     | Weight    |      `1`     | `1.00000000`      | **重量的基础单位** |
| 2   | 千克(kg)  | Weight    |      `0`     | `1000.00000000`   | 1 kg = 1000 g                          |
| 3   | 吨(t)     | Weight    |      `0`     | `1000000.00000000`| 1 t = 1,000,000 g                      |
| 4   | 毫克(mg)  | Weight    |      `0`     | `0.00100000`      | 1 mg = 0.001 g                         |
| 5   | 个        | Quantity  |      `1`     | `1.00000000`      | **数量的基础单位** |
| 6   | 箱        | Quantity  |      `0`     | `1.00000000`      | 箱与个的换算在SKU表定义，这里仅作为单位 |

**注意**：对于“箱”和“个”这类非标准换算的单位，它们的 `conversion_factor` 保持为 `1` 即可，因为它们的换算关系定义在SKU表的 `conversion_rate` 字段中。此处的 `conversion_factor` 主要用于“千克”到“克”这类**标准物理换算**。

### 自动换算逻辑

有了这个结构，任意两个同类型单位之间的换算就非常简单了。

**公式**: `目标单位数量 = (源单位数量 * 源单位换算系数) / 目标单位换算系数`

**示例**: 转换 `5` 千克(kg) 到 `吨(t)`

1.  源单位(kg)的 `conversion_factor` 是 `1000`。
2.  目标单位(t)的 `conversion_factor` 是 `1000000`。
3.  计算: `(5 * 1000) / 1000000 = 0.005` 吨。

这个设计让您的单位管理体系变得非常灵活且可扩展，能够以统一和标准化的方式处理所有物理量的换算。

