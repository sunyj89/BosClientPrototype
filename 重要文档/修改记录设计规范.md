# 修改记录设计规范


## 1. 设计理念

- **全面记录**: 记录所有关键操作（新建、修改、删除），确保操作可追溯。
- **清晰对比**: 直观展示变更前后的数据差异，便于审计和核对。
- **流程透明**: 包含审批流程信息，展示操作的完整生命周期。
- **高效查询**: 提供多维度筛选和搜索功能，快速定位目标记录。

## 2. 功能模块构成

修改记录页面由以下几个核心部分组成：

1.  **筛选区域**: 用于搜索和过滤修改记录。
2.  **记录列表**: 以表格形式展示修改记录的摘要信息。
3.  **详情弹窗**: 以弹窗形式展示单条记录的详细信息，包括变更对比和操作流程。

## 3. 实现规范

### 3.1 筛选区域

- **布局**: 使用 `Card` 组件包裹，`Form` 采用 `inline` 布局。
- **控件**:
  - `关键词`: `Input`，用于搜索商品名称、ID、操作人等。
  - `变更类型`: `Select`，选项包括“新建”、“修改”、“删除”。
  - `变更字段`: `Select`，动态加载模块特有的变更字段。
  - `状态`: `Select`，选项包括“已通过”、“待审批”、“已拒绝”。
  - `时间范围`: `DatePicker.RangePicker`，用于筛选变更时间。
- **操作**:
  - `搜索`: `Button type="primary"`，触发表单提交。
  - `重置`: `Button`，清空所有筛选条件。

#### 示例代码：
```jsx
<Card style={{ marginBottom: 16 }}>
  <Form form={searchForm} layout="inline" onFinish={handleSearch}>
    {/* Form.Item 列表 */}
    <Form.Item>
      <Space>
        <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>搜索</Button>
        <Button onClick={() => searchForm.resetFields()}>重置</Button>
      </Space>
    </Form.Item>
  </Form>
</Card>
```

### 3.2 记录列表

- **容器**: 使用 `Card` 组件包裹。
- **组件**: 使用 `Table` 组件展示数据。
- **列定义 (Columns)**:
  - `变更时间`: `changeTime`，加粗显示，支持排序。
  - `商品信息`: `productInfo`，组合显示名称和ID。
  - `变更类型`: `changeType`，使用 `Tag` 组件，不同类型使用不同颜色和图标。
    - 新建: `success` (绿色), `<PlusOutlined />`
    - 修改: `warning` (橙色), `<EditOutlined />`
    - 删除: `error` (红色), `<DeleteOutlined />`
  - `变更字段`: `changeField`，使用 `Tag` 组件（蓝色）。
  - `变更描述`: `changeDescription`，使用 `Tooltip` 处理长文本。
  - `操作人`: `operatorInfo`，组合显示姓名和ID。
  - `审批人`: `approver`。
  - `状态`: `status`，使用 `Badge` 组件。
    - 已通过: `success`
    - 待审批: `warning`
    - 已拒绝: `error`
  - `操作`: `action`，固定在右侧 `fixed: 'right'`，包含“查看详情”按钮。

#### 示例代码：
```jsx
<Table
  columns={columns}
  dataSource={dataSource}
  rowKey="id"
  scroll={{ x: 1200 }}
  pagination={{ /* ... */ }}
/>
```

### 3.3 详情弹窗

- **容器**: 使用 `Modal` 组件，宽度 `800px`。
- **标题**: 包含图标和文字，如 `<HistoryOutlined /> 变更详情`。
- **布局**: 弹窗内分为三个部分，均使用 `Card` 包裹。
  1.  **基本信息**: 使用 `Descriptions` 组件展示记录的元数据。
  2.  **变更详情**:
      - 使用 `Card` 和 `renderValueComparison` 函数。
      - `新建`: 绿色 `Tag` 显示新增的键值对。
      - `删除`: 红色 `Tag` 显示删除的键值对。
      - `修改`: 对比新旧值，差异部分用红色 `Tag`（原值）和绿色 `Tag`（新值）并列展示。
  3.  **操作流程**:
      - 使用 `Card` 和 `Timeline` 组件。
      - `提交`: 蓝色节点。
      - `审批通过`: 绿色节点。
      - `审批拒绝`: 红色节点。
      - `等待审批`: 灰色节点。

#### 示例代码：
```jsx
<Modal
  title="变更详情"
  open={detailModalVisible}
  width={800}
  footer={[ <Button onClick={...}>关闭</Button> ]}
>
  {/* 基本信息 Card */}
  <Descriptions>
    {/* ... */}
  </Descriptions>
  
  <Row gutter={16}>
    <Col span={12}>
      <Card title="变更详情">
        {/* 变更对比 */}
      </Card>
    </Col>
    <Col span={12}>
      <Card title="操作流程">
        <Timeline items={timelineItems} />
      </Card>
    </Col>
  </Row>
</Modal>
```

## 4. 数据结构规范

修改记录的模拟数据应包含以下字段：

```javascript
{
  "id": "LOG001",                 // 记录唯一ID
  "productId": "SPU001",            // 关联的实体ID (如商品ID)
  "productName": "农夫山泉",      // 关联的实体名称
  "changeType": "update",           // 变更类型 (create, update, delete)
  "changeField": "价格信息",      // 变更的主要字段或模块
  "changeDescription": "更新SKU价格",// 变更的简要描述
  "operator": "张三",              // 操作人姓名
  "operatorId": "USER001",          // 操作人ID
  "changeTime": "2025-01-18 14:30:25",// 操作时间
  "oldValue": { "price": 2.0 },    // 变更前的数据
  "newValue": { "price": 2.5 },    // 变更后的数据
  "reason": "供应商涨价调整",      // 变更原因
  "affectedSkus": ["SKU001001"],     // 受影响的子实体 (可选)
  "approver": "李经理",             // 审批人
  "status": "approved"              // 状态 (approved, pending, rejected)
}
```
---
本规范旨在确保所有模块的“修改记录”功能在视觉和交互上保持高度一致，提升用户体验和开发效率。 