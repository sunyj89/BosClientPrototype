# 【数据字典】红包营销系统数据字典v1.0

## 1. 核心数据表设计

### 1.1 红包活动表 (red_package_activities)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 活动主键ID |
| activity_name | varchar | 30 | 是 | - | 红包名称 |
| activity_type | tinyint | 1 | 是 | 1 | 红包类型：1-普通红包，2-裂变红包 |
| page_title | varchar | 30 | 是 | - | 页面标题 |
| station_logo | varchar | 200 | 否 | - | 油站标志图片路径 |
| station_name | varchar | 30 | 是 | - | 油站名称 |
| main_title | varchar | 30 | 是 | - | 主标语 |
| validity_type | tinyint | 1 | 是 | 1 | 有效期类型：1-固定时间，2-相对天数 |
| start_time | datetime | - | 否 | - | 开始时间(固定时间模式) |
| end_time | datetime | - | 否 | - | 结束时间(固定时间模式) |
| validity_days | int | 5 | 否 | - | 有效天数(相对天数模式) |
| cycle_type | tinyint | 1 | 是 | 0 | 周期规则：0-无，1-每天，2-每周，3-每月 |
| cycle_config | text | - | 否 | - | 周期配置详情(JSON格式) |
| identity_type | tinyint | 1 | 是 | 0 | 身份条件：0-不限，1-选中可参与，2-选中不可参与 |
| identity_config | varchar | 500 | 否 | - | 身份配置(逗号分隔的ID) |
| level_type | tinyint | 1 | 是 | 0 | 会员等级：0-不限制，2-限制会员等级 |
| level_config | varchar | 200 | 否 | - | 会员等级配置(逗号分隔的ID) |
| user_type | tinyint | 1 | 是 | 2 | 领取用户：1-未加油用户，2-所有用户 |
| repeat_type | tinyint | 1 | 是 | 0 | 重复领取：0-否，1-是 |
| share_type | tinyint | 1 | 是 | 1 | 能否分享：1-不可分享，2-可以分享 |
| if_free | tinyint | 1 | 是 | 1 | 是否免费：1-免费，2-花钱换购 |
| each_cost | decimal | 8,2 | 否 | 0.00 | 每个红包价格(花钱换购模式) |
| times_limit | int | 5 | 是 | 1 | 每位用户参与次数限制 |
| is_need_plate | tinyint | 1 | 是 | 0 | 是否需要车牌号：0-否，1-是 |
| page_template | varchar | 50 | 是 | - | 页面模板类型 |
| activity_rules | text | - | 是 | - | 活动规则文本 |
| package_count | int | 8 | 是 | 1000 | 红包发行数量 |
| total_budget | decimal | 12,2 | 是 | 0.00 | 总预算金额 |
| browser_enable | tinyint | 1 | 是 | 0 | 是否可在浏览器领取：0-否，1-是 |
| activity_url | varchar | 500 | 否 | - | 活动链接 |
| qr_code_path | varchar | 200 | 否 | - | 二维码图片路径 |
| status | tinyint | 1 | 是 | 1 | 活动状态：1-未开始，2-进行中，3-已结束，4-已暂停 |
| merchant_id | int | 11 | 是 | - | 商户ID |
| station_id | int | 11 | 是 | - | 油站ID |
| creator_id | int | 11 | 是 | - | 创建人ID |
| created_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 更新时间 |

### 1.2 营销券表 (marketing_coupons)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 券主键ID |
| coupon_name | varchar | 100 | 是 | - | 营销券名称 |
| coupon_code | varchar | 50 | 是 | - | 营销券编码 |
| coupon_type | tinyint | 1 | 是 | - | 券类型：1-代金券，2-折扣券，3-满减券等 |
| face_value | decimal | 8,2 | 是 | - | 券面额 |
| min_amount | decimal | 8,2 | 否 | 0.00 | 最低消费金额 |
| validity_type | tinyint | 1 | 是 | 1 | 有效期类型：1-固定期间，2-领取后N天 |
| start_date | date | - | 否 | - | 有效开始日期 |
| end_date | date | - | 否 | - | 有效结束日期 |
| validity_days | int | 5 | 否 | - | 领取后有效天数 |
| usage_rules | text | - | 否 | - | 使用规则说明 |
| status | tinyint | 1 | 是 | 1 | 券状态：1-有效，2-无效，3-已删除 |
| merchant_id | int | 11 | 是 | - | 商户ID |
| created_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 更新时间 |

### 1.3 红包营销券关联表 (red_package_coupons)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 关联主键ID |
| activity_id | int | 11 | 是 | - | 红包活动ID |
| coupon_id | int | 11 | 是 | - | 营销券ID |
| coupon_count | int | 5 | 是 | 1 | 每个红包包含的券数量 |
| total_count | int | 8 | 是 | - | 该券种的总发行数量 |
| issued_count | int | 8 | 是 | 0 | 已发放数量 |
| used_count | int | 8 | 是 | 0 | 已使用数量 |
| created_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 创建时间 |

### 1.4 红包统计表 (red_package_statistics)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 统计主键ID |
| activity_id | int | 11 | 是 | - | 红包活动ID |
| stat_date | date | - | 是 | - | 统计日期 |
| issued_count | int | 8 | 是 | 0 | 当日发放券数量 |
| received_count | int | 8 | 是 | 0 | 当日领取券数量 |
| used_count | int | 8 | 是 | 0 | 当日使用券数量 |
| received_users | int | 8 | 是 | 0 | 当日领取人数 |
| used_users | int | 8 | 是 | 0 | 当日使用人数 |
| planned_cost | decimal | 12,2 | 是 | 0.00 | 当日计划成本 |
| received_cost | decimal | 12,2 | 是 | 0.00 | 当日领取成本 |
| actual_cost | decimal | 12,2 | 是 | 0.00 | 当日实际成本 |
| created_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 创建时间 |

### 1.5 用户红包记录表 (user_red_packages)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 记录主键ID |
| activity_id | int | 11 | 是 | - | 红包活动ID |
| user_id | int | 11 | 是 | - | 用户ID |
| phone | varchar | 20 | 是 | - | 用户手机号 |
| plate_number | varchar | 20 | 否 | - | 车牌号码 |
| receive_time | timestamp | - | 是 | - | 领取时间 |
| share_count | int | 5 | 是 | 0 | 分享次数 |
| status | tinyint | 1 | 是 | 1 | 状态：1-已领取，2-已过期，3-已使用完 |
| created_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 创建时间 |

### 1.6 用户营销券记录表 (user_coupons)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 记录主键ID |
| red_package_id | int | 11 | 是 | - | 用户红包记录ID |
| coupon_id | int | 11 | 是 | - | 营销券ID |
| user_id | int | 11 | 是 | - | 用户ID |
| coupon_code | varchar | 50 | 是 | - | 券码 |
| receive_time | timestamp | - | 是 | - | 领取时间 |
| expire_time | timestamp | - | 是 | - | 过期时间 |
| use_time | timestamp | - | 否 | - | 使用时间 |
| order_id | int | 11 | 否 | - | 使用订单ID |
| status | tinyint | 1 | 是 | 1 | 状态：1-未使用，2-已使用，3-已过期 |
| created_at | timestamp | - | 是 | CURRENT_TIMESTAMP | 创建时间 |

## 2. 系统配置数据

### 2.1 身份类型配置表 (driver_types)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| sub_type_id | int | 11 | 是 | 自增 | 身份类型ID |
| sub_type_name | varchar | 50 | 是 | - | 身份类型名称 |
| description | varchar | 200 | 否 | - | 身份类型描述 |
| sort_order | int | 5 | 是 | 0 | 排序序号 |
| status | tinyint | 1 | 是 | 1 | 状态：1-有效，2-无效 |

### 2.2 会员等级配置表 (member_levels)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 等级ID |
| level_name | varchar | 50 | 是 | - | 等级名称 |
| level_code | varchar | 20 | 是 | - | 等级编码 |
| min_points | int | 8 | 是 | 0 | 最低积分要求 |
| max_points | int | 8 | 否 | - | 最高积分限制 |
| level_icon | varchar | 200 | 否 | - | 等级图标路径 |
| privileges | text | - | 否 | - | 等级特权说明 |
| sort_order | int | 5 | 是 | 0 | 排序序号 |
| status | tinyint | 1 | 是 | 1 | 状态：1-有效，2-无效 |

### 2.3 页面模板配置表 (page_templates)

| 字段名 | 字段类型 | 长度 | 是否必填 | 默认值 | 字段说明 |
|--------|----------|------|----------|--------|----------|
| id | int | 11 | 是 | 自增 | 模板ID |
| template_name | varchar | 50 | 是 | - | 模板名称 |
| template_code | varchar | 50 | 是 | - | 模板代码 |
| template_image | varchar | 200 | 是 | - | 模板预览图片 |
| template_config | text | - | 否 | - | 模板配置信息(JSON) |
| description | varchar | 200 | 否 | - | 模板描述 |
| sort_order | int | 5 | 是 | 0 | 排序序号 |
| status | tinyint | 1 | 是 | 1 | 状态：1-有效，2-无效 |

## 3. 枚举值定义

### 3.1 红包类型枚举

```json
{
  "1": {
    "code": "normal",
    "name": "普通红包",
    "description": "一个活动发行一波红包，满足条件的用户可主动领取一次"
  },
  "2": {
    "code": "fission",
    "name": "裂变红包", 
    "description": "可设置为满额送奖励，获得裂变红包并分享给好友时，好友通过分享可领取优惠券"
  }
}
```

### 3.2 有效期类型枚举

```json
{
  "1": {
    "code": "fixed_time",
    "name": "固定时间",
    "description": "设置具体的开始和结束时间"
  },
  "2": {
    "code": "relative_days",
    "name": "相对天数",
    "description": "设置领取后多少天有效"
  }
}
```

### 3.3 周期类型枚举

```json
{
  "0": {
    "code": "none",
    "name": "无",
    "description": "不重复"
  },
  "1": {
    "code": "daily",
    "name": "每天",
    "description": "每日重复"
  },
  "2": {
    "code": "weekly", 
    "name": "每周",
    "description": "每周重复"
  },
  "3": {
    "code": "monthly",
    "name": "每月", 
    "description": "每月重复"
  }
}
```

### 3.4 营销券类型枚举

```json
{
  "1": {
    "code": "cash_coupon",
    "name": "代金券",
    "description": "直接抵扣现金的券"
  },
  "2": {
    "code": "discount_coupon",
    "name": "折扣券",
    "description": "按折扣比例减免的券"
  },
  "3": {
    "code": "full_reduction",
    "name": "满减券",
    "description": "满足条件后减免的券"
  },
  "4": {
    "code": "free_gift",
    "name": "赠品券",
    "description": "免费赠送商品的券"
  }
}
```

### 3.5 活动状态枚举

```json
{
  "1": {
    "code": "not_started",
    "name": "未开始",
    "description": "活动尚未开始"
  },
  "2": {
    "code": "in_progress",
    "name": "进行中",
    "description": "活动正在进行"
  },
  "3": {
    "code": "ended",
    "name": "已结束",
    "description": "活动已结束"
  },
  "4": {
    "code": "paused",
    "name": "已暂停",
    "description": "活动已暂停"
  }
}
```

### 3.6 营销券状态枚举

```json
{
  "1": {
    "code": "unused",
    "name": "未使用",
    "description": "券已领取但未使用"
  },
  "2": {
    "code": "used",
    "name": "已使用",
    "description": "券已被使用"
  },
  "3": {
    "code": "expired",
    "name": "已过期",
    "description": "券已过期失效"
  }
}
```

## 4. 数据约束和验证规则

### 4.1 字段长度约束

- 红包名称：最大30字符，显示时限制15字符
- 页面标题：最大30字符，显示时限制12字符  
- 主标语：最大30字符，显示时限制8字符
- 油站名称：最大30字符，显示时限制16字符
- 活动规则：建议不超过200字符

### 4.2 图片上传约束

- 文件大小：最大1MB
- 支持格式：bmp、png、jpeg、jpg、gif
- 油站标志：最小200×200px正方形
- 模板图片：建议240×80px长方形

### 4.3 数值约束

- 红包发行数量：正整数，建议1000-10000
- 营销券数量：每个红包最大10张券
- 券面额：0.01-5000.00元，最多2位小数
- 有效天数：1-365天
- 次数限制：1-999次

### 4.4 业务规则约束

- 红包必须包含至少1张营销券
- 固定时间模式的结束时间必须大于开始时间
- 相对天数模式的天数必须大于0
- 周期时间段不能跨天(如不能设置23:00-01:00)
- 裂变红包必须启用分享功能
- 花钱换购模式的价格必须大于0

## 5. 索引设计

### 5.1 主要索引

```sql
-- 红包活动表索引
CREATE INDEX idx_merchant_station ON red_package_activities(merchant_id, station_id);
CREATE INDEX idx_status_time ON red_package_activities(status, created_at);
CREATE INDEX idx_activity_type ON red_package_activities(activity_type);

-- 营销券表索引  
CREATE INDEX idx_merchant_status ON marketing_coupons(merchant_id, status);
CREATE INDEX idx_coupon_type ON marketing_coupons(coupon_type);

-- 统计表索引
CREATE INDEX idx_activity_date ON red_package_statistics(activity_id, stat_date);

-- 用户红包记录索引
CREATE INDEX idx_user_activity ON user_red_packages(user_id, activity_id);
CREATE INDEX idx_phone_activity ON user_red_packages(phone, activity_id);

-- 用户营销券记录索引
CREATE INDEX idx_user_status ON user_coupons(user_id, status);
CREATE INDEX idx_coupon_status ON user_coupons(coupon_id, status);
```

### 5.2 唯一约束

```sql
-- 营销券编码唯一
ALTER TABLE marketing_coupons ADD UNIQUE KEY uk_coupon_code (coupon_code);

-- 用户券码唯一
ALTER TABLE user_coupons ADD UNIQUE KEY uk_user_coupon_code (coupon_code);

-- 统计数据唯一(按活动和日期)
ALTER TABLE red_package_statistics ADD UNIQUE KEY uk_activity_date (activity_id, stat_date);
```