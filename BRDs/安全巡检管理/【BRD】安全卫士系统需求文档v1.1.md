# 商业需求文档 (BRD) - 安全卫士系统

**版本号**: v1.1  
**日期**: 2025年8月21日

## 1. 模块概述 (Project Overview)

### 1.1 模块目标与价值 (Project Goals and Value Proposition)
**主要目标**: 为加油站等工业场所提供一套完整的安全巡检管理系统，通过移动端执行巡检任务，后台管理配置和监控，实现安全检查的标准化、数字化和可追溯性管理。

**核心价值**: 
- 提升安全巡检效率，减少人工记录错误
- 建立标准化的巡检流程和异常处理机制
- 实现巡检数据的实时监控和历史追溯
- 通过移动化作业提升现场巡检体验
- 自动化异常工单生成和处理流程

### 1.2 模块范围 (Project Scope)
**核心功能模块**: 
- 用户认证与权限管理模块
- 巡检管理模块（配置、执行、记录）
- 异常工单管理模块
- 模板与配置管理模块
- 档案文件管理模块
- 系统管理模块

**本次迭代**: 基于Laravel 5.5框架的完整功能实现，支持移动端APP和Web后台管理双端操作。

## 2. 用户分析 (User Analysis)

### 2.1 用户场景 (User Scenarios)

**场景一：现场巡检人员使用移动端执行巡检**
1. 巡检员通过APP登录系统，查看当日巡检任务列表
2. 到达指定点位，扫描二维码标签获取巡检项目信息
3. 根据模板要求完成各项检查，记录结果和拍照上传
4. 发现异常时，提交异常报告，系统自动生成工单
5. 完成所有点位巡检，提交整体巡检报告

**场景二：管理员配置巡检模板和计划**
1. 管理员登录后台系统，选择要管理的油站
2. 创建巡检模板，定义检查项目、反馈类型和标准
3. 配置点位标签，关联设备位置和巡检项目
4. 设置巡检计划，包括巡检类型、时间窗口和执行频率
5. 发布配置，系统生成巡检任务给现场人员

**场景三：工单处理流程**
1. 系统自动从巡检异常生成工单，分配给相关负责人
2. 工单接收人查看异常详情、照片和位置信息
3. 安排现场处理，更新工单状态和处理进度
4. 完成整改后提交验收，管理员审核确认
5. 工单闭环，形成完整的异常处理记录

## 3. 产品需求 (Product Requirements)

### 3.1 功能需求 (Functional Requirements)

**模块一：用户认证与权限管理模块**

FR1.1 **用户登录**
- 描述：支持用户名密码登录和验证码登录，区分移动端和Web端
- 输入：用户名、密码/验证码、登录类型
- 处理逻辑：验证用户凭证，建立会话，返回用户权限和可访问站点信息
- 输出：登录成功状态、用户信息、权限列表、可操作站点列表

FR1.2 **权限控制**
- 描述：基于用户权限级别控制功能访问，支持平台级、集团级、油站级权限
- 输入：用户权限级别、访问资源
- 处理逻辑：检查用户权限等级，验证对特定站点或功能的访问权限
- 输出：权限验证结果、可访问的功能菜单

FR1.3 **组织切换**
- 描述：支持多层级组织结构切换（平台→集团→油站）
- 输入：目标组织ID、用户权限
- 处理逻辑：验证用户对目标组织的访问权限，切换操作上下文
- 输出：切换成功状态、当前组织信息、可操作资源列表

**模块二：巡检管理模块**

FR2.1 **巡检配置管理**
- 描述：配置巡检计划，包括时间窗口、巡检类型、点位配置
- 输入：油站ID、巡检类型、开始时间、结束时间、偏移量、点位配置
- 处理逻辑：验证时间配置有效性，保存巡检计划，生成执行任务
- 输出：配置保存成功状态、巡检计划ID、生效时间

FR2.2 **移动端巡检执行**
- 描述：通过扫码获取巡检项目，执行检查并记录结果
- 输入：二维码数据、检查结果、照片文件、异常描述
- 处理逻辑：解析标签信息，验证巡检项目，保存检查结果，上传图片
- 输出：保存成功状态、巡检完成度、待检项目列表

FR2.3 **巡检记录查询**
- 描述：查询历史巡检记录，支持按时间、油站、状态等条件筛选
- 输入：查询条件（时间范围、油站ID、巡检状态）
- 处理逻辑：根据权限和条件查询巡检记录，分页返回结果
- 输出：巡检记录列表、统计信息、导出功能

FR2.4 **异常上报**
- 描述：发现异常时提交异常报告，自动生成处理工单
- 输入：异常类型、异常描述、现场照片、位置信息
- 处理逻辑：记录异常详情，自动创建工单，分配给相关负责人
- 输出：异常提交成功、工单生成状态、工单编号

**模块三：异常工单管理模块**

FR3.1 **工单自动生成**
- 描述：从巡检异常自动生成工单，分配处理责任人
- 输入：异常巡检数据、责任人信息、处理截止时间
- 处理逻辑：创建工单记录，设置优先级，发送通知给责任人
- 输出：工单创建成功、工单编号、通知发送状态

FR3.2 **工单分配与处理**
- 描述：工单分配给具体处理人员，跟踪处理进度
- 输入：工单ID、分配人员、处理说明、状态更新
- 处理逻辑：更新工单状态，记录处理过程，通知相关人员
- 输出：分配成功状态、处理进度、状态变更记录

FR3.3 **工单审核与关闭**
- 描述：管理员审核工单处理结果，确认问题解决并关闭工单
- 输入：工单ID、审核结果、审核意见
- 处理逻辑：验证处理完成情况，更新工单状态，记录审核结果
- 输出：审核完成状态、工单关闭确认、处理效果评估

**模块四：模板与配置管理模块**

FR4.1 **巡检模板管理**
- 描述：创建和维护巡检模板，定义检查项目和反馈标准
- 输入：模板名称、检查项目列表、反馈类型配置、适用范围
- 处理逻辑：验证模板完整性，保存模板配置，支持复制和共享
- 输出：模板保存成功、模板ID、适用站点列表

FR4.2 **标签管理**
- 描述：管理现场二维码标签，关联设备位置和巡检项目
- 输入：标签编码、位置信息、关联设备、巡检项目配置
- 处理逻辑：验证标签编码唯一性，关联巡检配置，支持批量导入
- 输出：标签创建成功、关联配置确认、导入结果统计

FR4.3 **点位配置管理**
- 描述：配置巡检点位，设置位置坐标和相关设备信息
- 输入：点位名称、位置坐标、设备信息、巡检要求
- 处理逻辑：验证位置信息，保存点位配置，生成巡检地图
- 输出：点位保存成功、配置验证结果、巡检路线规划

### 3.2 数据需求 (Data Requirements)

**数据实体一：用户管理 (Admin)**
- 属性：用户ID、用户名、加密密码、真实姓名、权限级别、所属组织、创建时间、最后登录时间
- 来源：管理员创建或用户注册
- 存储：MySQL数据库，密码加密存储

**数据实体二：巡检配置 (InspectConfig)**
- 属性：配置ID、油站ID、巡检类型、开始时间、结束时间、偏移量、点位配置JSON、创建时间
- 来源：管理员配置界面
- 存储：MySQL数据库，JSON字段存储复杂配置

**数据实体三：巡检记录 (InspectRecord)**
- 属性：记录ID、配置ID、执行人、创建日期、巡检状态、点位数据JSON、完成时间、异常数量
- 来源：移动端巡检执行
- 存储：MySQL数据库，大量历史数据

**数据实体四：异常工单 (InspectWorkOrder)**
- 属性：工单ID、巡检记录ID、异常类型、描述、责任人、创建时间、处理状态、完成时间、审核结果
- 来源：系统自动生成或手动创建
- 存储：MySQL数据库，关联巡检记录

**数据实体五：巡检模板 (InspectTemplate)**
- 属性：模板ID、模板名称、检查项目JSON、反馈配置JSON、适用类型、创建人、共享级别
- 来源：管理员配置
- 存储：MySQL数据库，JSON存储复杂模板结构

**数据实体六：标签配置 (LabelConf)**
- 属性：标签ID、标签编码、油站ID、点位ID、设备信息、巡检项目配置、二维码数据、状态
- 来源：管理员配置或批量导入
- 存储：MySQL数据库，索引标签编码

## 4. 核心业务流程 (Core Business Flows)

**流程一：巡检配置到执行流程**
1. 管理员登录后台系统，选择目标油站
2. 创建巡检模板，定义检查项目和标准
3. 配置巡检计划，设置时间窗口和执行频率
4. 系统根据配置生成巡检任务
5. 巡检员接收任务，使用移动端执行巡检
6. 扫描点位二维码，获取巡检项目清单
7. 逐项完成检查，记录结果和拍照
8. 提交巡检报告，系统更新完成状态

**流程二：异常处理工单流程**
1. 巡检过程中发现异常，提交异常报告
2. 系统自动生成异常工单，分配给责任人
3. 责任人接收工单通知，查看异常详情
4. 安排现场处理，更新工单处理进度
5. 完成整改后提交处理结果和照片证明
6. 管理员审核处理效果，确认问题解决
7. 工单关闭，形成完整处理记录

**流程三：数据分析与导出流程**
1. 管理员选择查询条件和时间范围
2. 系统检索相关巡检记录和统计数据
3. 生成分析报表，包括完成率、异常统计等
4. 支持导出Excel格式报告
5. 报告用于上级汇报和绩效考核

## 5. 假设与约束 (Assumptions and Constraints)

**功能约束**：

- 当前版本仅支持加油站行业的巡检场景
- 二维码标签必须为8位数字编码
- 单次文件上传大小限制和格式限制

**数据约束**：
- 用户密码最少10位，必须包含大小写字母和数字
- 巡检记录保存期限和数据归档策略
- 文件存储大小配额和清理策略
- 并发用户数和性能响应时间要求

---

*文档版本：v1.1*  
*创建日期：2025年8月21日*  
*文档状态：已完成*