# 【业务流程图】好友邀请营销系统模块v1.0

## 1. 好友邀请活动创建流程

### 1.1 完整创建流程图

```mermaid
graph TB
    A[开始创建活动] --> B[填写活动基础信息]
    B --> C[活动名称和时间设置]
    C --> D[选择活动类型]
    D --> E{活动类型选择}
    E -->|1级邀请| F[配置1级邀请规则]
    E -->|2级邀请| G[配置2级邀请规则]
    E -->|代理商模式| H[配置代理商邀请规则]
    F --> I[设置参与资格]
    G --> I
    H --> I
    I --> J[配置邀请人资格]
    J --> K[配置被邀人资格]
    K --> L[页面模板设置]
    L --> M[选择默认模板]
    M --> N[上传banner图和背景图]
    N --> O[设置页面标题和标语]
    O --> P[配置分享内容]
    P --> Q[设置分享标题和内容]
    Q --> R[上传分享logo]
    R --> S[配置奖励规则]
    S --> T[设置邀请人奖励]
    T --> U[设置被邀人奖励]
    U --> V[配置完成邀请条件]
    V --> W[预览活动页面]
    W --> X[提交创建请求]
    X --> Y{验证是否通过}
    Y -->|验证失败| Z[显示错误信息]
    Z --> B
    Y -->|验证成功| AA[保存活动配置]
    AA --> BB[生成活动链接]
    BB --> CC[生成二维码]
    CC --> DD[活动创建完成]
```

### 1.2 参与资格配置流程

```mermaid
graph TB
    A[开始配置参与资格] --> B[设置邀请人资格]
    B --> C{邀请人类型}
    C -->|所有用户| D[允许所有注册用户]
    C -->|加过油用户| E[验证用户加油记录]
    C -->|已注册会员| F[验证集团会员身份]
    C -->|认证代理商| G[验证代理商名单]
    D --> H[设置被邀人资格]
    E --> H
    F --> H
    G --> H
    H --> I{被邀人类型}
    I -->|未加油用户| J[验证新用户身份]
    I -->|未注册会员| K[验证非会员身份]
    J --> L[资格配置完成]
    K --> L
```

### 1.3 奖励规则配置流程

```mermaid
graph TB
    A[开始配置奖励规则] --> B[配置邀请人奖励]
    B --> C[设置接受邀请时奖励]
    C --> D{奖励类型}
    D -->|抵用券| E[选择营销券类型]
    D -->|积分| F[设置积分数量]
    D -->|积分+经验值| G[设置积分和经验值]
    D -->|微信红包| H[配置红包金额]
    E --> I[设置完成邀请时奖励]
    F --> I
    G --> I
    H --> I
    I --> J[配置被邀人奖励]
    J --> K[设置完成邀请条件]
    K --> L{完成方式}
    L -->|注册即完成| M[设置注册完成规则]
    L -->|加油满足条件| N[设置加油门槛]
    M --> O[配置通知设置]
    N --> P[设置有效时间]
    P --> Q[设置加油金额条件]
    Q --> O
    O --> R[奖励规则配置完成]
```

## 2. 用户邀请好友流程

### 2.1 邀请人发起邀请流程

```mermaid
graph TB
    A[用户访问邀请页面] --> B[验证用户邀请资格]
    B --> C{资格验证}
    C -->|验证失败| D[显示资格不符提示]
    C -->|验证成功| E[显示活动详情]
    E --> F[查看奖励规则]
    F --> G[选择邀请方式]
    G --> H{邀请方式}
    H -->|发送链接| I[生成个人邀请链接]
    H -->|面对面邀请| J[显示邀请二维码]
    I --> K[复制链接到剪贴板]
    J --> L[好友扫码或点击链接]
    K --> M[通过社交平台分享]
    M --> L
    L --> N[好友进入被邀请页面]
    N --> O[显示邀请人信息]
    O --> P[好友查看奖励内容]
```

### 2.2 好友接受邀请流程

```mermaid
graph TB
    A[好友点击邀请链接] --> B[进入被邀请页面]
    B --> C[显示邀请人信息]
    C --> D[展示活动详情和奖励]
    D --> E[好友输入手机号]
    E --> F{手机号验证}
    F -->|格式错误| G[提示重新输入]
    G --> E
    F -->|验证成功| H[检查被邀人资格]
    H --> I{资格检查}
    I -->|不符合条件| J[显示资格不符提示]
    I -->|符合条件| K[记录邀请关系]
    K --> L[发放接受邀请奖励]
    L --> M[发送通知给邀请人]
    M --> N[显示接受成功页面]
    N --> O[引导完成邀请条件]
```

### 2.3 完成邀请条件流程

```mermaid
graph TB
    A[被邀请人开始完成条件] --> B{完成方式}
    B -->|注册即完成| C[完成注册流程]
    B -->|加油满足条件| D[在有效期内加油]
    C --> E[系统检测注册完成]
    D --> F[系统检测加油记录]
    F --> G{是否满足条件}
    G -->|未满足| H[继续等待或提醒]
    G -->|满足条件| I[更新邀请状态为完成]
    E --> I
    I --> J[发放完成邀请奖励]
    J --> K[通知邀请人完成邀请]
    K --> L[更新统计数据]
    L --> M[完成邀请流程结束]
    H --> N[检查有效期]
    N --> O{是否超时}
    O -->|未超时| D
    O -->|已超时| P[邀请失效]
```

## 3. 活动管理流程

### 3.1 活动列表管理流程

```mermaid
graph TB
    A[管理员访问活动列表] --> B[加载活动数据]
    B --> C[显示活动状态筛选]
    C --> D{状态筛选}
    D -->|未开始| E[显示未开始活动]
    D -->|进行中| F[显示进行中活动]
    D -->|已结束| G[显示已结束活动]
    E --> H[显示活动列表]
    F --> H
    G --> H
    H --> I[显示分页控件]
    I --> J{用户操作}
    J -->|查看详情| K[进入活动详情页]
    J -->|复制链接| L[复制活动链接]
    J -->|查看统计| M[进入统计分析页]
    J -->|翻页| N[加载其他页数据]
    K --> O[显示完整活动配置]
    L --> P[链接复制到剪贴板]
    M --> Q[显示邀请数据统计]
    N --> H
```

### 3.2 邀请详情统计流程

```mermaid
graph TB
    A[进入邀请详情页面] --> B[加载活动基础信息]
    B --> C[查询邀请关系数据]
    C --> D[统计各邀请人数据]
    D --> E[计算接受邀请人数]
    E --> F[计算完成邀请人数]
    F --> G[计算奖励发放情况]
    G --> H[生成统计表格]
    H --> I[显示分页数据]
    I --> J{用户操作}
    J -->|导出数据| K[生成Excel文件]
    J -->|翻页查看| L[加载其他页数据]
    K --> M[下载统计报表]
    L --> I
```

## 4. 邀请人名单管理流程

### 4.1 名单导入流程

```mermaid
graph TB
    A[访问名单管理页面] --> B[点击导入数据按钮]
    B --> C[选择Excel文件]
    C --> D[文件上传到服务器]
    D --> E[验证文件格式]
    E --> F{格式验证}
    F -->|格式错误| G[提示文件格式错误]
    F -->|格式正确| H[解析Excel数据]
    G --> C
    H --> I[验证数据完整性]
    I --> J{数据验证}
    J -->|数据有误| K[显示错误明细]
    J -->|数据正确| L[检查重复数据]
    K --> M[用户修正数据]
    M --> C
    L --> N[批量插入数据库]
    N --> O[显示导入结果]
    O --> P[刷新名单列表]
```

### 4.2 名单维护流程

```mermaid
graph TB
    A[查看名单列表] --> B[显示分页数据]
    B --> C{用户操作}
    C -->|删除记录| D[确认删除操作]
    C -->|下载模板| E[提供Excel模板下载]
    C -->|翻页查看| F[加载其他页数据]
    D --> G[执行删除操作]
    G --> H[更新列表显示]
    E --> I[模板文件下载]
    F --> B
    H --> J[显示操作结果]
```

## 5. 系统交互流程

### 5.1 前后端数据交互流程

```mermaid
graph TB
    A[前端发起请求] --> B[后端接收请求]
    B --> C[验证请求参数]
    C --> D{参数验证}
    D -->|验证失败| E[返回错误信息]
    D -->|验证成功| F[执行业务逻辑]
    E --> G[前端显示错误提示]
    F --> H[数据库操作]
    H --> I{操作结果}
    I -->|操作失败| J[返回失败信息]
    I -->|操作成功| K[返回成功数据]
    J --> L[前端显示失败提示]
    K --> M[前端更新页面数据]
    G --> N[用户重新操作]
    L --> N
    M --> O[操作完成]
    N --> A
```

### 5.2 文件上传处理流程

```mermaid
graph TB
    A[用户选择文件] --> B[前端文件验证]
    B --> C{文件验证}
    C -->|格式不符| D[提示格式错误]
    C -->|大小超限| E[提示大小错误]
    C -->|验证通过| F[显示上传进度]
    D --> G[用户重新选择]
    E --> G
    F --> H[文件上传到服务器]
    H --> I[服务器文件验证]
    I --> J{服务器验证}
    J -->|验证失败| K[返回上传失败]
    J -->|验证成功| L[保存文件到指定位置]
    K --> M[显示上传失败提示]
    L --> N[返回文件访问路径]
    N --> O[更新页面预览]
    O --> P[保存文件路径信息]
    G --> A
    M --> G
```

### 5.3 奖励发放流程

```mermaid
graph TB
    A[触发奖励发放事件] --> B[查询奖励配置]
    B --> C[验证发放条件]
    C --> D{条件验证}
    D -->|条件不满足| E[记录发放失败日志]
    D -->|条件满足| F[确定奖励类型]
    F --> G{奖励类型}
    G -->|抵用券| H[调用营销券发放接口]
    G -->|积分| I[调用积分发放接口]
    G -->|微信红包| J[调用红包发放接口]
    H --> K[记录发放结果]
    I --> K
    J --> K
    K --> L{发放结果}
    L -->|发放成功| M[更新用户奖励记录]
    L -->|发放失败| N[记录失败原因]
    M --> O[发送通知消息]
    N --> P[触发重试机制]
    O --> Q[奖励发放完成]
    P --> R{重试次数检查}
    R -->|未超限| S[延时重新发放]
    R -->|已超限| T[标记为最终失败]
    S --> F
    T --> U[人工处理]
```

### 5.4 邀请关系追踪流程

```mermaid
graph TB
    A[用户点击邀请链接] --> B[解析邀请参数]
    B --> C[验证邀请人身份]
    C --> D{邀请人验证}
    D -->|验证失败| E[记录异常访问]
    D -->|验证成功| F[检查被邀人资格]
    F --> G{被邀人资格}
    G -->|资格不符| H[显示资格提示]
    G -->|资格符合| I[记录邀请关系]
    I --> J[生成唯一邀请记录]
    J --> K[关联活动和用户]
    K --> L[设置邀请状态]
    L --> M[触发接受邀请奖励]
    M --> N[更新邀请统计数据]
    N --> O[邀请关系建立完成]
    H --> P[引导用户了解活动]
    E --> Q[安全日志记录]
```