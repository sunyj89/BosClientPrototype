# 设备管理系统 - 业务流程图文档

**文档版本：** v1.0  
**创建日期：** 2025年7月21日  
**创建人：** 孙杨竣

## 1. 文档概述

本文档描述设备管理系统的核心业务流程，包括设备档案管理、液位仪监控、校验记录、发电机运行记录和水电表记录等主要业务流程。

## 2. 设备档案管理流程

### 2.1 设备档案新增流程

```mermaid
flowchart TD
    A[用户访问设备档案页面] --> B[点击新增按钮]
    B --> C[打开设备档案表单]
    C --> D[填写设备基本信息]
    D --> E{表单验证}
    E -->|验证失败| F[显示错误信息]
    F --> D
    E -->|验证通过| G[保存设备档案]
    G --> H[生成修改记录]
    H --> I[刷新设备列表]
    I --> J[显示成功提示]
```

### 2.2 设备档案查询流程

```mermaid
flowchart TD
    A[用户访问设备档案页面] --> B[系统加载设备列表]
    B --> C[用户输入筛选条件]
    C --> D[选择设备状态]
    D --> E[选择所属油站]
    E --> F[输入搜索关键词]
    F --> G[点击查询按钮]
    G --> H[系统过滤数据]
    H --> I[显示筛选结果]
    I --> J{是否需要导出}
    J -->|是| K[生成Excel报表]
    J -->|否| L[结束查询]
```

## 3. 液位仪管理流程

### 3.1 设备状态监控流程

```mermaid
flowchart TD
    A[用户访问液位仪管理页面] --> B[系统加载设备数据]
    B --> C[计算统计信息]
    C --> D{是否有告警设备}
    D -->|有| E[显示告警提示]
    D -->|无| F[显示正常状态]
    E --> G[用户筛选设备]
    F --> G
    G --> H[显示设备列表]
    H --> I[用户点击设备名称]
    I --> J[进入设备详情页面]
```

### 3.2 设备详情监控流程

```mermaid
flowchart TD
    A[进入设备详情页面] --> B[系统生成设备数据]
    B --> C[显示设备基本信息]
    C --> D[显示油罐状态]
    D --> E[生成历史图表]
    E --> F[显示告警历史]
    F --> G{是否有活跃告警}
    G -->|有| H[用户处理告警]
    G -->|无| I[用户查看维护记录]
    H --> J[填写处理结果]
    J --> K[更新告警状态]
    I --> L[登记维护信息]
    L --> M[保存维护记录]
```

## 4. 加油机校验记录流程

### 4.1 校验记录创建流程

```mermaid
flowchart TD
    A[用户访问校验记录页面] --> B[点击创建校验记录]
    B --> C[选择加油枪信息]
    C --> D[选择油品类型]
    D --> E[输入校验原因]
    E --> F[填写标准容积]
    F --> G[录入校验升数]
    G --> H[输入量器读数]
    H --> I[系统自动计算]
    I --> J[计算标准体积]
    J --> K[计算示值误差]
    K --> L[判定校验结果]
    L --> M{校验是否合格}
    M -->|合格| N[保存校验记录]
    M -->|不合格| O[标记需要处理]
    N --> P[提交审批]
    O --> P
    P --> Q[审批人员审核]
    Q --> R[完成审批流程]
```

### 4.2 校验记录审批流程

```mermaid
flowchart TD
    A[审批人员登录系统] --> B[查看待审批记录]
    B --> C[选择校验记录]
    C --> D[查看校验详情]
    D --> E{审批决定}
    E -->|同意| F[更新状态为已审批]
    E -->|驳回| G[填写驳回原因]
    F --> H[通知创建人]
    G --> I[更新状态为已驳回]
    I --> J[通知创建人修改]
    H --> K[审批流程结束]
    J --> K
```

## 5. 发电机运行记录流程

### 5.1 运行记录创建流程

```mermaid
flowchart TD
    A[操作人员访问发电机记录页面] --> B[点击创建运行记录]
    B --> C[选择所属油站]
    C --> D[选择运行原因]
    D --> E[填写运行时间]
    E --> F[描述运行情况]
    F --> G[记录本次加油量]
    G --> H[填写累计运行时间]
    H --> I[添加备注信息]
    I --> J[提交运行记录]
    J --> K[系统保存记录]
    K --> L[设置状态为待审批]
    L --> M[通知站长审批]
```

### 5.2 运行记录审批流程

```mermaid
flowchart TD
    A[站长接收审批通知] --> B[查看运行记录详情]
    B --> C{记录是否规范}
    C -->|规范| D[填写审批意见]
    C -->|不规范| E[要求修改记录]
    D --> F[更新状态为已审批]
    E --> G[退回给操作人员]
    F --> H[记录审批完成]
    G --> I[操作人员修改后重新提交]
    I --> A
```

## 6. 水电表记录管理流程

### 6.1 交接明细记录流程

```mermaid
flowchart TD
    A[交班人员访问水电表页面] --> B[选择所属油站]
    B --> C[选择当前班次]
    C --> D[录入水表1读数]
    D --> E[录入水表2读数]
    E --> F[录入电表1读数]
    F --> G[录入电表2读数]
    G --> H[系统自动计算走字数]
    H --> I[计算总度数]
    I --> J[接班人员确认]
    J --> K[双方签字确认]
    K --> L[保存交接记录]
    L --> M[生成交接明细]
```

### 6.2 月报表生成流程

```mermaid
flowchart TD
    A[系统定时任务启动] --> B[获取当月交接记录]
    B --> C[按油站分组汇总]
    C --> D[计算水表期初期末数]
    D --> E[计算电表期初期末数]
    E --> F[统计总水表度数]
    F --> G[统计总电表度数]
    G --> H[获取本月付油量]
    H --> I[计算吨油用水量]
    I --> J[计算吨油用电量]
    J --> K[生成月度报表]
    K --> L[保存报表数据]
    L --> M[通知相关人员]
```

## 7. 系统集成流程

### 7.1 数据同步流程

```mermaid
flowchart TD
    A[外部系统数据变更] --> B[触发数据同步]
    B --> C{数据类型判断}
    C -->|油站信息| D[更新油站数据]
    C -->|设备信息| E[更新设备档案]
    C -->|人员信息| F[更新责任人信息]
    D --> G[验证数据完整性]
    E --> G
    F --> G
    G --> H{验证结果}
    H -->|通过| I[更新本地数据]
    H -->|失败| J[记录错误日志]
    I --> K[刷新相关页面]
    J --> L[通知管理员处理]
```

### 7.2 权限控制流程

```mermaid
flowchart TD
    A[用户访问功能页面] --> B[系统验证用户身份]
    B --> C{身份验证}
    C -->|失败| D[跳转登录页面]
    C -->|成功| E[获取用户角色]
    E --> F[检查功能权限]
    F --> G{权限检查}
    G -->|无权限| H[显示权限不足提示]
    G -->|有权限| I[加载页面内容]
    I --> J[根据权限控制操作按钮]
    J --> K[记录操作日志]
```

## 8. 异常处理流程

### 8.1 设备离线处理流程

```mermaid
flowchart TD
    A[系统检测到设备离线] --> B[记录离线时间]
    B --> C[生成告警信息]
    C --> D[通知运维人员]
    D --> E[运维人员现场检查]
    E --> F{设备故障原因}
    F -->|网络问题| G[修复网络连接]
    F -->|设备故障| H[联系设备厂商]
    F -->|电源问题| I[检查电源供应]
    G --> J[设备重新上线]
    H --> K[设备维修更换]
    I --> J
    K --> J
    J --> L[更新设备状态]
    L --> M[关闭告警记录]
```

### 8.2 数据异常处理流程

```mermaid
flowchart TD
    A[系统检测到数据异常] --> B[标记异常数据]
    B --> C[生成异常报告]
    C --> D[通知数据管理员]
    D --> E[管理员分析异常原因]
    E --> F{异常类型}
    F -->|数据格式错误| G[修正数据格式]
    F -->|数据缺失| H[补充缺失数据]
    F -->|数据重复| I[去重处理]
    G --> J[重新验证数据]
    H --> J
    I --> J
    J --> K{验证结果}
    K -->|通过| L[恢复正常处理]
    K -->|失败| M[人工介入处理]
    L --> N[更新数据状态]
    M --> O[记录处理结果]
```

## 9. 总结

设备管理系统的业务流程覆盖了设备全生命周期管理，从设备档案建立、运行监控、维护校验到数据统计分析，形成了完整的管理闭环。各个流程之间相互关联，共同支撑加油站设备的高效、安全运行。 
