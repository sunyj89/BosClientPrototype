# 商业需求文档 (BRD) - 油品供货商和询价管理系统

## 1. 模块概述 (Project Overview)

### 1.1 模块目标与价值 (Project Goals and Value Proposition)
* **主要目标：** 构建一个完整的油品采购询价和供应商管理平台，实现采购方与供应商之间的高效协作，提升油品采购的透明度和效率，降低采购成本。
* **核心价值：** 通过标准化的询价流程和供应商管理体系，为采购方提供最优的油品采购方案，同时为供应商提供公平的竞争平台，实现采购成本优化和供应链管理效率提升。

### 1.2 模块范围 (Project Scope)
* **核心功能模块：** 
  - 油品询价管理模块（采购方）
  - 供应商管理模块
  - 供应商门户模块
  - 中标报价单管理模块
* **本次迭代：** 基于当前代码逻辑的完整功能范围

## 2. 用户分析 (User Analysis)

### 2.1 用户场景 (User Scenarios)
* **采购方用户场景：**
  - 用户A希望发布油品询价单，他会通过以下步骤：1. 访问询价管理页面 2. 点击"新建询价单"按钮 3. 填写询价单信息（油品类型、数量、交货地点等）4. 选择目标供应商 5. 设置报价时间范围 6. 保存草稿或直接发布询价
  - 用户B需要查看和管理已发布的询价单，他会：1. 在询价单列表中查看所有询价单状态 2. 对草稿状态的询价单进行编辑或删除 3. 对待发布状态的询价单进行发布操作 4. 对询价中状态的询价单进行中止或完成操作
  - 用户C需要评估供应商报价，他会：1. 查看询价单收到的所有报价 2. 比较不同供应商的价格和服务条件 3. 选择最优报价并确认中标供应商 4. 生成采购订单

* **供应商用户场景：**
  - 供应商A希望参与油品询价，他会：1. 登录供应商门户 2. 查看可参与的询价单列表 3. 选择感兴趣的询价单查看详情 4. 提交报价单（包含价格、交货时间、服务条件等）5. 上传相关资质文件
  - 供应商B需要管理自己的报价历史，他会：1. 在供应商门户查看已提交的报价单状态 2. 对草稿状态的报价单进行编辑或删除 3. 查看中标通知和采购订单信息

## 3. 产品需求 (Product Requirements)

### 3.1 功能需求 (Functional Requirements)

* **模块一：油品询价管理模块**
  * **FR1.1 询价单创建：**
    * **描述：** 采购方可以创建新的油品询价单，设置询价的基本信息和要求。
    * **输入：** 询价单名称、油品类型、预计采购数量、交货地点、联系人信息、报价时间范围、预期交货时间、询价描述。
    * **处理逻辑：** 系统自动生成询价单ID，验证必填字段，根据选择的油品类型筛选可用的供应商，保存询价单信息到数据库。
    * **输出/预期结果：** 询价单创建成功，状态为"草稿"，可以进一步编辑或发布。

  * **FR1.2 询价单编辑：**
    * **描述：** 对草稿状态的询价单进行修改和调整。
    * **输入：** 修改后的询价单信息。
    * **处理逻辑：** 验证修改后的数据有效性，更新询价单信息，保持询价单ID不变。
    * **输出/预期结果：** 询价单信息更新成功。

  * **FR1.3 询价单发布：**
    * **描述：** 将待发布状态的询价单正式发布，通知相关供应商参与报价。
    * **输入：** 询价单ID。
    * **处理逻辑：** 验证询价单信息完整性，更新状态为"询价中"，向选定的供应商发送询价通知，记录发布时间。
    * **输出/预期结果：** 询价单发布成功，供应商收到通知，可以开始报价。

  * **FR1.4 询价单状态管理：**
    * **描述：** 管理询价单的生命周期状态，包括中止询价、完成询价等操作。
    * **输入：** 操作类型（中止/完成）、操作原因。
    * **处理逻辑：** 根据操作类型更新询价单状态，记录操作时间和原因，通知相关供应商。
    * **输出/预期结果：** 询价单状态更新成功，相关方收到通知。

  * **FR1.5 报价单查看和评估：**
    * **描述：** 查看供应商提交的报价单，进行价格和服务条件比较。
    * **输入：** 询价单ID。
    * **处理逻辑：** 获取该询价单的所有报价单，按价格、交货时间等条件进行排序和筛选。
    * **输出/预期结果：** 显示所有报价单的详细信息，支持排序和筛选功能。

  * **FR1.6 中标确认：**
    * **描述：** 选择最优报价并确认中标供应商。
    * **输入：** 报价单ID、中标原因。
    * **处理逻辑：** 更新报价单状态为"已中标"，更新询价单状态为"询价完成"，记录中标信息。
    * **输出/预期结果：** 中标确认成功，生成中标通知，可以创建采购订单。

* **模块二：供应商管理模块**
  * **FR2.1 供应商信息管理：**
    * **描述：** 维护供应商的基本信息、资质信息和联系方式。
    * **输入：** 供应商名称、代码、联系人、电话、邮箱、地址、油品类型、资质证书等。
    * **处理逻辑：** 验证供应商信息完整性，支持文件上传（资质证书、合同等），分配供应商等级。
    * **输出/预期结果：** 供应商信息保存成功，可以参与询价活动。

  * **FR2.2 供应商状态管理：**
    * **描述：** 管理供应商的合作状态，包括正常、暂停、待审批、已驳回等。
    * **输入：** 状态变更操作、变更原因。
    * **处理逻辑：** 更新供应商状态，记录变更历史，影响供应商参与询价的权限。
    * **输出/预期结果：** 供应商状态更新成功，相关权限自动调整。

  * **FR2.3 供应商变更记录：**
    * **描述：** 记录供应商信息的变更历史，便于审计和追溯。
    * **输入：** 变更操作、变更前数据、变更后数据、操作人。
    * **处理逻辑：** 自动记录每次变更的详细信息，包括时间戳和操作人。
    * **输出/预期结果：** 变更记录保存成功，支持历史查询。

* **模块三：供应商门户模块**
  * **FR3.1 询价单查看：**
    * **描述：** 供应商可以查看可参与的询价单列表和详情。
    * **输入：** 供应商ID、筛选条件（油品类型、状态、时间范围等）。
    * **处理逻辑：** 根据供应商资质和状态筛选可参与的询价单，显示询价单的详细信息。
    * **输出/预期结果：** 显示符合条件的询价单列表，支持详情查看。

  * **FR3.2 报价单提交：**
    * **描述：** 供应商针对询价单提交报价单。
    * **输入：** 询价单ID、油品单价、运费、交货时间、服务条件、附件文件等。
    * **处理逻辑：** 验证报价信息的完整性和合理性，计算总金额，保存报价单信息。
    * **输出/预期结果：** 报价单提交成功，状态为"已提交"。

  * **FR3.3 报价单管理：**
    * **描述：** 供应商管理已提交的报价单，包括查看、编辑、删除等操作。
    * **输入：** 报价单ID、操作类型。
    * **处理逻辑：** 根据报价单状态控制可执行的操作，更新报价单信息。
    * **输出/预期结果：** 报价单操作成功，状态相应更新。

  * **FR3.4 消息通知：**
    * **描述：** 供应商接收系统通知，包括询价通知、中标通知、状态变更等。
    * **输入：** 消息类型、消息内容、接收方。
    * **处理逻辑：** 根据业务事件自动生成通知消息，支持消息状态管理。
    * **输出/预期结果：** 消息发送成功，供应商可以查看和处理。

* **模块四：中标报价单管理模块**
  * **FR4.1 中标报价单查看：**
    * **描述：** 查看中标报价单的详细信息和相关文件。
    * **输入：** 报价单ID。
    * **处理逻辑：** 获取中标报价单的完整信息，包括供应商信息、价格信息、交货条件等。
    * **输出/预期结果：** 显示中标报价单的详细信息。

  * **FR4.2 采购订单创建：**
    * **描述：** 基于中标报价单创建采购订单。
    * **输入：** 中标报价单ID、采购订单信息。
    * **处理逻辑：** 自动填充采购订单信息，生成采购订单号，保存订单信息。
    * **输出/预期结果：** 采购订单创建成功，可以进入后续的采购流程。

  * **FR4.3 供应商通知：**
    * **描述：** 向中标供应商发送中标通知和采购订单信息。
    * **输入：** 通知内容、接收方信息。
    * **处理逻辑：** 生成中标通知邮件，包含采购订单详情和后续合作要求。
    * **输出/预期结果：** 通知发送成功，供应商收到中标确认。

### 3.2 数据需求 (Data Requirements)

* **数据实体一：询价单 (Inquiry)**
  * **属性：** 询价单ID、询价单名称、油品类型、预计采购数量、状态、报价开始时间、报价结束时间、交货地点、联系人、联系电话、预期交货时间、创建时间、创建人、描述、取消原因、中标供应商、最终价格、完成时间。
  * **来源：** 采购方创建的询价单表单。
  * **存储：** 数据库中的inquiry表。

* **数据实体二：报价单 (Quotation)**
  * **属性：** 报价单ID、询价单ID、询价单名称、状态、供应商ID、供应商名称、油品类型、油品单价、运费单价、到站单价、数量、总金额、交货时间、交货地点、是否包含运费、提交时间、联系人、联系电话、联系邮箱、附件、备注、拒绝原因。
  * **来源：** 供应商提交的报价单表单。
  * **存储：** 数据库中的quotation表。

* **数据实体三：供应商 (Supplier)**
  * **属性：** 供应商ID、供应商名称、供应商代码、联系人、联系电话、邮箱、地址、油品类型列表、资质证书号、状态、等级、备注、创建时间、更新时间。
  * **来源：** 供应商注册和信息维护表单。
  * **存储：** 数据库中的supplier表。

* **数据实体四：供应商变更记录 (SupplierChangeRecord)**
  * **属性：** 记录ID、供应商ID、变更类型、变更前数据、变更后数据、操作人、操作时间、变更原因。
  * **来源：** 系统自动记录的供应商信息变更。
  * **存储：** 数据库中的supplier_change_record表。

* **数据实体五：消息通知 (Message)**
  * **属性：** 消息ID、接收方ID、消息类型、标题、内容、状态、创建时间、阅读时间。
  * **来源：** 系统根据业务事件自动生成。
  * **存储：** 数据库中的message表。

* **数据实体六：附件文件 (Attachment)**
  * **属性：** 文件ID、关联对象ID、关联对象类型、文件名、文件路径、文件大小、上传时间、上传人。
  * **来源：** 用户上传的文件。
  * **存储：** 文件系统和数据库中的attachment表。

## 4. 核心业务流程 (Core Business Flows)

* **流程一：油品询价发布流程**
  1. 采购方登录系统，访问询价管理页面。
  2. 点击"新建询价单"按钮，填写询价单信息（油品类型、数量、交货地点等）。
  3. 选择目标供应商，设置报价时间范围。
  4. 保存为草稿或直接发布询价单。
  5. 系统自动生成询价单ID，更新状态为"待发布"或"询价中"。
  6. 如果直接发布，系统向选定供应商发送询价通知。
  7. 供应商在门户中查看询价单详情，决定是否参与报价。

* **流程二：供应商报价流程**
  1. 供应商登录供应商门户，查看可参与的询价单列表。
  2. 选择感兴趣的询价单，查看详细要求。
  3. 点击"提交报价"按钮，填写报价信息（价格、交货时间、服务条件等）。
  4. 上传相关资质文件和报价单附件。
  5. 提交报价单，系统验证信息完整性。
  6. 报价单状态更新为"已提交"，采购方可以查看和评估。

* **流程三：询价评估和中标确认流程**
  1. 采购方在询价管理页面查看收到的所有报价单。
  2. 比较不同供应商的价格、交货时间、服务条件等。
  3. 选择最优报价，点击"确认中标"按钮。
  4. 系统更新报价单状态为"已中标"，询价单状态为"询价完成"。
  5. 生成中标通知，发送给中标供应商。
  6. 采购方可以基于中标报价单创建采购订单。

* **流程四：供应商管理流程**
  1. 系统管理员在供应商管理页面添加新供应商信息。
  2. 上传供应商资质证书和相关文件。
  3. 设置供应商等级和合作状态。
  4. 供应商信息变更时，系统自动记录变更历史。
  5. 根据供应商状态控制其参与询价的权限。

## 5. 假设与约束 (Assumptions and Constraints)

* **技术假设：** 
  - 系统基于React + Ant Design前端框架开发
  - 使用RESTful API进行前后端数据交互
  - 支持文件上传和下载功能
  - 具备用户认证和权限管理功能

* **功能约束：** 
  - 询价单一旦发布，核心信息（油品类型、数量等）不可修改
  - 报价单提交后，价格信息不可修改，只能重新提交
  - 供应商必须通过资质审核才能参与询价
  - 询价单有明确的时间限制，超时自动结束

* **数据约束：** 
  - 询价单ID格式：INQ + YYYYMMDD + 序号
  - 报价单ID格式：QUO + YYYYMMDD + 序号
  - 供应商ID格式：OS + 3位序号
  - 价格字段必须为数字类型，支持小数点后2位
  - 数量字段必须为正数，支持小数点后2位 