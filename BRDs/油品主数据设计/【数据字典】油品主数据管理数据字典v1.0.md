 # 数据字典文档 - 油品主数据管理系统

## 文档概述

本文档定义了油品主数据管理系统中涉及的所有数据实体、字段属性、数据类型、约束条件和业务规则。

---

## 1. 数据实体总览

| 实体名称 | 英文名称 | 说明 | 主要用途 |
|---------|---------|------|---------|
| 油品信息 | OilProduct | 油品基础信息表 | 存储油品的完整信息 |
| 油品分类 | OilCategory | 油品分类信息表 | 维护分类体系结构 |
| 修改记录 | ModifyRecord | 操作记录表 | 追踪所有变更操作 |
| 变更字段 | ChangeField | 字段变更详情 | 记录具体字段变更 |

---

## 2. 油品信息表 (OilProduct)

### 2.1 表结构定义

| 字段名称 | 英文字段名 | 数据类型 | 长度 | 必填 | 唯一 | 默认值 | 说明 |
|---------|-----------|---------|------|------|------|-------|------|
| 油品ID | id | BIGINT | - | ✓ | ✓ | 自增 | 主键，系统自动生成 |
| 油品编号 | code | VARCHAR | 6 | ✓ | ✓ | - | 以"10"开头的6位数字 |
| 线上油品编号 | onlineCode | VARCHAR | 20 | ✓ | ✓ | - | 线上系统对应编号 |
| 油品名称 | name | VARCHAR | 100 | ✓ | ✗ | - | 油品的完整名称 |
| 油品简称 | shortName | VARCHAR | 50 | ✓ | ✗ | - | 油品的简化名称 |
| 分类ID | categoryId | VARCHAR | 20 | ✓ | ✗ | - | 关联分类表ID |
| 分类名称 | categoryName | VARCHAR | 50 | ✓ | ✗ | - | 分类显示名称 |
| 分类路径 | categoryPath | VARCHAR | 200 | ✓ | ✗ | - | 完整分类路径 |
| 油品类型 | oilType | VARCHAR | 20 | ✓ | ✗ | - | 汽油/柴油/天然气/尿素/其他 |
| 排放等级 | emissionLevel | VARCHAR | 20 | ✗ | ✗ | - | 国V/国VIA/国VIB/乙醇E10 |
| 默认密度 | density | DECIMAL | 5,3 | ✓ | ✗ | - | 范围0.5-1.0 |
| 状态 | status | VARCHAR | 10 | ✓ | ✗ | 审批中 | 生效中/审批中/未生效 |
| 创建时间 | createTime | DATETIME | - | ✓ | ✗ | NOW() | 记录创建时间 |
| 更新时间 | updateTime | DATETIME | - | ✓ | ✗ | NOW() | 最后更新时间 |
| 审批人 | approver | VARCHAR | 50 | ✗ | ✗ | - | 审批人姓名 |
| 创建人 | creator | VARCHAR | 50 | ✓ | ✗ | - | 记录创建人 |
| 更新人 | updater | VARCHAR | 50 | ✓ | ✗ | - | 最后更新人 |

### 2.2 字段约束规则

| 字段名称 | 约束规则 | 说明 |
|---------|---------|------|
| code | 正则：^10\d{4}$ | 必须是以10开头的6位数字 |
| onlineCode | 长度1-20字符 | 不能为空 |
| name | 长度1-100字符 | 不能为空 |
| shortName | 长度1-50字符 | 不能为空 |
| oilType | 枚举值 | 汽油/柴油/天然气/尿素/其他 |
| emissionLevel | 条件必填 | 汽油和柴油类型必填 |
| density | 数值范围 | 0.5 ≤ density ≤ 1.0 |
| status | 枚举值 | 生效中/审批中/未生效 |

### 2.3 业务规则

1. **编号唯一性**：油品编号和线上油品编号在全系统内唯一
2. **排放等级规则**：
   - 汽油类型：支持国V、国VIA、国VIB、乙醇E10
   - 柴油类型：支持国V、国VIA、国VIB
   - 天然气和尿素类型：不需要排放等级
3. **状态转换规则**：
   - 新建记录默认为"审批中"
   - 只有"未生效"状态的记录可以编辑
   - "生效中"和"审批中"的记录只能查看

---

## 3. 油品分类表 (OilCategory)

### 3.1 表结构定义

| 字段名称 | 英文字段名 | 数据类型 | 长度 | 必填 | 唯一 | 默认值 | 说明 |
|---------|-----------|---------|------|------|------|-------|------|
| 分类ID | id | BIGINT | - | ✓ | ✓ | 自增 | 主键，系统自动生成 |
| 分类编码 | categoryId | VARCHAR | 20 | ✓ | ✓ | - | 分类唯一标识 |
| 分类名称 | title | VARCHAR | 50 | ✓ | ✗ | - | 分类显示名称 |
| 父分类ID | parentId | BIGINT | - | ✗ | ✗ | NULL | 上级分类ID |
| 父分类编码 | parentCategoryId | VARCHAR | 20 | ✗ | ✗ | NULL | 上级分类编码 |
| 父分类名称 | parentCategoryName | VARCHAR | 50 | ✗ | ✗ | NULL | 上级分类名称 |
| 层级 | level | INT | - | ✓ | ✗ | 1 | 分类层级，1-4级 |
| 排序号 | sort | INT | - | ✓ | ✗ | 1 | 同级别排序 |
| 状态 | status | VARCHAR | 10 | ✓ | ✗ | active | active/inactive |
| 描述 | description | TEXT | - | ✗ | ✗ | - | 分类说明 |
| 关联油品数 | oilCount | INT | - | ✓ | ✗ | 0 | 关联的油品数量 |
| 创建时间 | createTime | DATETIME | - | ✓ | ✗ | NOW() | 记录创建时间 |
| 更新时间 | updateTime | DATETIME | - | ✓ | ✗ | NOW() | 最后更新时间 |

### 3.2 层级结构定义

| 层级 | 说明 | 示例 |
|------|------|------|
| 1级 | 顶级分类 | 油品、天然气、尾气处理液 |
| 2级 | 大类分类 | 汽油、柴油、车用天然气、柴油机尾气处理液 |
| 3级 | 细分类型 | 92号、95号、98号、LNG液化天然气、桶装车用尿素 |
| 4级 | 特殊分类 | （暂未使用，预留扩展） |

### 3.3 分类约束规则

1. **层级限制**：最多支持4级分类
2. **同级唯一**：同一父分类下的子分类名称不能重复
3. **删除限制**：有子分类或关联油品的分类不能删除
4. **编码规则**：分类编码采用分层编码，如1-1-1表示第1级第1个分类的第1个子分类

---

## 4. 修改记录表 (ModifyRecord)

### 4.1 表结构定义

| 字段名称 | 英文字段名 | 数据类型 | 长度 | 必填 | 唯一 | 默认值 | 说明 |
|---------|-----------|---------|------|------|------|-------|------|
| 记录ID | id | BIGINT | - | ✓ | ✓ | 自增 | 主键，系统自动生成 |
| 油品编号 | oilCode | VARCHAR | 6 | ✓ | ✗ | - | 关联油品编号 |
| 油品名称 | oilName | VARCHAR | 100 | ✓ | ✗ | - | 油品名称快照 |
| 操作类型 | operationType | VARCHAR | 10 | ✓ | ✗ | - | 新建/编辑/删除 |
| 操作人 | operatorName | VARCHAR | 50 | ✓ | ✗ | - | 操作人姓名 |
| 操作时间 | operateTime | DATETIME | - | ✓ | ✗ | NOW() | 操作发生时间 |
| 审批状态 | approvalStatus | VARCHAR | 10 | ✓ | ✗ | 审批中 | 审批中/已审批/已拒绝 |
| 审批人 | approver | VARCHAR | 50 | ✗ | ✗ | - | 审批人姓名 |
| 审批时间 | approvalTime | DATETIME | - | ✗ | ✗ | - | 审批处理时间 |
| 变更原因 | reason | TEXT | - | ✗ | ✗ | - | 操作说明 |
| 变更字段 | changeFields | JSON | - | ✗ | ✗ | - | 字段变更详情JSON |
| IP地址 | ipAddress | VARCHAR | 45 | ✗ | ✗ | - | 操作来源IP |
| 用户代理 | userAgent | TEXT | - | ✗ | ✗ | - | 浏览器信息 |

### 4.2 操作类型定义

| 操作类型 | 说明 | 触发场景 |
|---------|------|---------|
| 新建 | 创建新油品记录 | 用户提交新建表单 |
| 编辑 | 修改现有记录 | 用户修改未生效记录 |
| 删除 | 删除记录申请 | 用户删除未生效记录 |
| 审批 | 审批处理 | 管理员审批操作 |

---

## 5. 变更字段详情 (ChangeField)

### 5.1 JSON结构定义

变更字段存储在ModifyRecord表的changeFields字段中，采用JSON格式：

```json
[
  {
    "field": "字段名称",
    "fieldLabel": "字段中文名",
    "oldValue": "原始值",
    "newValue": "新值",
    "dataType": "数据类型"
  }
]
```

### 5.2 字段映射表

| 英文字段名 | 中文字段名 | 数据类型 | 说明 |
|-----------|-----------|---------|------|
| code | 油品编号 | STRING | 6位数字编号 |
| onlineCode | 线上油品编号 | STRING | 线上系统编号 |
| name | 油品名称 | STRING | 完整名称 |
| shortName | 油品简称 | STRING | 简化名称 |
| categoryId | 分类ID | STRING | 分类标识 |
| categoryName | 分类名称 | STRING | 分类显示名 |
| oilType | 油品类型 | STRING | 类型枚举值 |
| emissionLevel | 排放等级 | STRING | 等级枚举值 |
| density | 默认密度 | NUMBER | 数值类型 |
| status | 状态 | STRING | 状态枚举值 |

---

## 6. 枚举值定义

### 6.1 油品类型 (OilType)

| 值 | 说明 | 对应分类 |
|----|------|---------|
| 汽油 | 汽车用汽油 | 汽油类 |
| 柴油 | 柴油机用柴油 | 柴油类 |
| 天然气 | 车用天然气 | 天然气类 |
| 尿素 | 车用尿素 | 尾气处理液类 |
| 其他 | 其他类型 | 扩展类型 |

### 6.2 排放等级 (EmissionLevel)

| 值 | 说明 | 适用类型 |
|----|------|---------|
| 国V | 国家第五阶段标准 | 汽油、柴油 |
| 国VIA | 国家第六阶段A标准 | 汽油、柴油 |
| 国VIB | 国家第六阶段B标准 | 汽油、柴油 |
| 乙醇E10 | 乙醇汽油E10 | 汽油 |

### 6.3 状态值 (Status)

| 值 | 说明 | 可操作 |
|----|------|---------|
| 生效中 | 审批通过，正式生效 | 仅查看 |
| 审批中 | 等待审批处理 | 仅查看 |
| 未生效 | 审批拒绝或草稿 | 编辑、删除 |

### 6.4 审批状态 (ApprovalStatus)

| 值 | 说明 | 后续处理 |
|----|------|---------|
| 审批中 | 等待审批 | 待处理 |
| 已审批 | 审批通过 | 生效 |
| 已拒绝 | 审批拒绝 | 可重新提交 |

---

## 7. 索引设计

### 7.1 主键索引

| 表名 | 索引名 | 字段 | 类型 |
|------|-------|------|------|
| OilProduct | PK_OilProduct | id | PRIMARY KEY |
| OilCategory | PK_OilCategory | id | PRIMARY KEY |
| ModifyRecord | PK_ModifyRecord | id | PRIMARY KEY |

### 7.2 唯一索引

| 表名 | 索引名 | 字段 | 说明 |
|------|-------|------|------|
| OilProduct | UK_OilProduct_Code | code | 油品编号唯一 |
| OilProduct | UK_OilProduct_OnlineCode | onlineCode | 线上编号唯一 |
| OilCategory | UK_OilCategory_CategoryId | categoryId | 分类编码唯一 |

### 7.3 普通索引

| 表名 | 索引名 | 字段 | 说明 |
|------|-------|------|------|
| OilProduct | IDX_OilProduct_Status | status | 状态查询优化 |
| OilProduct | IDX_OilProduct_CategoryId | categoryId | 分类关联查询 |
| OilProduct | IDX_OilProduct_CreateTime | createTime | 时间范围查询 |
| OilCategory | IDX_OilCategory_ParentId | parentId | 层级查询优化 |
| ModifyRecord | IDX_ModifyRecord_OilCode | oilCode | 按油品查询记录 |
| ModifyRecord | IDX_ModifyRecord_OperateTime | operateTime | 时间范围查询 |

---

## 8. 数据完整性约束

### 8.1 外键约束

| 子表 | 子表字段 | 父表 | 父表字段 | 约束名称 |
|------|---------|------|---------|---------|
| OilProduct | categoryId | OilCategory | categoryId | FK_OilProduct_Category |
| ModifyRecord | oilCode | OilProduct | code | FK_ModifyRecord_Oil |

### 8.2 检查约束

| 表名 | 字段 | 约束条件 | 约束名称 |
|------|------|---------|---------|
| OilProduct | code | code REGEXP '^10[0-9]{4}$' | CK_OilProduct_Code |
| OilProduct | density | density BETWEEN 0.5 AND 1.0 | CK_OilProduct_Density |
| OilCategory | level | level BETWEEN 1 AND 4 | CK_OilCategory_Level |

---

**文档版本：** v1.0  
**创建日期：** 2025年7月  
**最后更新：** 2025年7月