# 业务流程图文档 - 油品主数据管理系统

## 文档概述

本文档描述了油品主数据管理系统的核心业务流程，通过流程图清晰展示各功能模块的操作步骤和数据流转。

---

## 1. 油品信息新建流程

### 1.1 流程描述
用户通过系统界面新建油品信息的完整流程，包括表单填写、数据验证、审批提交等环节。

### 1.2 流程图

```mermaid
flowchart TD
    A[用户点击新建油品按钮] --> B[弹出油品表单弹窗]
    B --> C[用户填写表单信息]
    C --> D{前端表单验证}
    D -->|验证失败| E[显示错误提示]
    E --> C
    D -->|验证通过| F[提交表单数据]
    F --> G[后端数据校验]
    G --> H{校验是否通过}
    H -->|校验失败| I[返回错误信息]
    I --> E
    H -->|校验通过| J[创建油品记录]
    J --> K[设置状态为审批中]
    K --> L[生成操作记录]
    L --> M[返回成功提示]
    M --> N[关闭弹窗]
    N --> O[刷新油品列表]
```

### 1.3 关键节点说明
- **表单验证**：包括必填项检查、格式验证、业务规则校验
- **后端校验**：数据唯一性校验、业务逻辑验证
- **状态管理**：新建记录默认为"审批中"状态

---

## 2. 油品信息编辑流程

### 2.1 流程描述
对现有油品信息进行修改的业务流程，包括状态检查、数据变更、审批处理等步骤。

### 2.2 流程图

```mermaid
flowchart TD
    A[用户选择编辑油品] --> B{检查油品状态}
    B -->|审批中| C[显示仅查看模式]
    B -->|生效中/未生效| D[弹出编辑表单]
    D --> E[预填充现有数据]
    E --> F[用户修改信息]
    F --> G{前端验证}
    G -->|验证失败| H[显示错误提示]
    H --> F
    G -->|验证通过| I[提交修改数据]
    I --> J[后端数据对比]
    J --> K{是否有变更}
    K -->|无变更| L[提示无修改内容]
    K -->|有变更| M[更新油品记录]
    M --> N[设置状态为审批中]
    N --> O[记录变更详情]
    O --> P[生成修改记录]
    P --> Q[返回成功提示]
    Q --> R[刷新列表数据]
```

### 2.3 关键节点说明
- **状态检查**：只有"生效中"和"未生效"状态的记录才能编辑
- **数据对比**：系统自动对比修改前后的数据差异
- **变更记录**：详细记录每个字段的变更内容

---

## 3. 油品分类管理流程

### 3.1 流程描述
管理油品分类体系的业务流程，支持分类的新增、编辑、删除和层级调整。

### 3.2 流程图

```mermaid
flowchart TD
    A[进入分类管理页面] --> B[加载分类树数据]
    B --> C[展示树形结构]
    C --> D[用户选择操作]
    D --> E{操作类型}
    E -->|新增分类| F[检查父分类层级]
    F --> G{层级是否超限}
    G -->|超过4级| H[提示层级限制]
    G -->|未超限| I[弹出新增表单]
    I --> J[填写分类信息]
    J --> K[提交保存]
    K --> L[更新分类树]
    
    E -->|编辑分类| M[弹出编辑表单]
    M --> N[修改分类信息]
    N --> O[提交更新]
    O --> L
    
    E -->|删除分类| P{检查是否有子分类}
    P -->|有子分类| Q[提示不能删除]
    P -->|无子分类| R{检查关联油品}
    R -->|有关联油品| S[提示先移除关联]
    R -->|无关联| T[确认删除]
    T --> U[执行删除]
    U --> L
    
    L --> V[刷新界面显示]
```

### 3.3 关键节点说明
- **层级控制**：最多支持4级分类层次
- **关联检查**：删除前检查是否有关联的油品或子分类
- **数据完整性**：确保分类树的层次结构完整

---

## 4. 修改记录查询流程

### 4.1 流程描述
查询和查看油品相关操作记录的业务流程，支持多条件筛选和详情查看。

### 4.2 流程图

```mermaid
flowchart TD
    A[进入修改记录页面] --> B[加载记录列表]
    B --> C[显示默认记录]
    C --> D[用户操作选择]
    D --> E{操作类型}
    
    E -->|筛选记录| F[设置筛选条件]
    F --> G[应用筛选条件]
    G --> H[查询符合条件记录]
    H --> I[更新列表显示]
    
    E -->|查看详情| J[选择记录]
    J --> K[弹出详情弹窗]
    K --> L[显示基本信息]
    L --> M{是否有变更字段}
    M -->|有变更| N[显示变更对比表]
    M -->|无变更| O[显示操作说明]
    N --> P[用户查看完毕]
    O --> P
    P --> Q[关闭详情弹窗]
    
    E -->|重置筛选| R[清空筛选条件]
    R --> S[重新加载全部记录]
    S --> I
```

### 4.3 关键节点说明
- **筛选功能**：支持按油品名称、操作类型、状态、操作人、时间范围筛选
- **详情展示**：完整显示操作记录和字段变更对比
- **数据追溯**：提供完整的操作历史追踪能力

---

## 5. 状态流转流程

### 5.1 流程描述
油品记录在系统中的状态变化流程，体现审批机制和生命周期管理。

### 5.2 流程图

```mermaid
stateDiagram-v2
    [*] --> 审批中 : 新建油品
    审批中 --> 生效中 : 审批通过
    审批中 --> 未生效 : 审批拒绝
    未生效 --> 审批中 : 重新提交
    生效中 --> 审批中 : 申请修改
    审批中 --> [*] : 删除申请通过
    
    note right of 审批中 : 等待审批处理
    note right of 生效中 : 正常使用状态
    note right of 未生效 : 可编辑修改
```

### 5.3 状态说明
- **审批中**：新建或修改后等待审批的状态
- **生效中**：审批通过，正式生效的状态
- **未生效**：审批拒绝或草稿状态，可继续编辑

---

## 6. 数据同步流程

### 6.1 流程描述
系统各模块间数据同步和一致性保证的流程。

### 6.2 流程图

```mermaid
sequenceDiagram
    participant U as 用户界面
    participant F as 前端组件
    participant A as API接口
    participant D as 数据库
    participant L as 日志系统
    
    U->>F: 用户操作
    F->>F: 前端验证
    F->>A: 发送请求
    A->>A: 业务逻辑处理
    A->>D: 数据库操作
    D-->>A: 返回结果
    A->>L: 记录操作日志
    A-->>F: 返回响应
    F->>F: 更新界面状态
    F-->>U: 显示结果
    
    Note over A,D: 事务处理
    Note over L: 审计追踪
```

### 6.3 关键说明
- **事务处理**：确保数据操作的原子性
- **日志记录**：所有操作都会记录到修改记录表
- **状态同步**：前端界面与后端数据保持一致

---

**文档版本：** v1.1 
**创建日期：** 2025年7月  
**最后更新：** 2025年7月 