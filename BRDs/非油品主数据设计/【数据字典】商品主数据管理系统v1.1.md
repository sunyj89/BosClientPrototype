# 数据字典 - 商品主数据管理系统

## 1. 概述

本数据字典描述了商品主数据管理系统中所有数据表的结构定义，包括字段名称、数据类型、约束条件、默认值、备注说明等详细信息。系统重点关注商品主数据管理、分类体系维护、组合商品配置和审批流程控制。

**数据库类型：** 关系型数据库  
**字符编码：** UTF-8  
**时间存储格式：** YYYY-MM-DD HH:MM:SS  

## 2. 数据表清单

| 序号 | 表名 | 中文名称 | 描述 |
|------|------|----------|------|
| 1 | products | 商品基础信息表 | 存储商品的基本信息和状态 |
| 2 | categories | 商品分类表 | 存储商品分类层次结构 |
| 3 | combo_products | 组合商品表 | 存储组合商品基本信息 |
| 4 | combo_items | 组合商品明细表 | 存储组合商品包含的单品信息 |
| 5 | approval_records | 审批记录表 | 存储商品管理相关的审批记录 |
| 6 | change_records | 变更记录表 | 存储系统操作日志 |
|  |                  |                |                            |

## 3. 数据表结构定义

### 3.1 商品基础信息表 (products)

**表描述：** 存储商品的基本信息，包括SKU编码、名称、规格等核心属性，支持完整的商品生命周期管理

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 描述 | 备注 |
|--------|----------|------|----------|----------|--------|------|------|
| id | INT | 11 | 是 | 是 | AUTO_INCREMENT | 商品主键ID | 自增长 |
| sku_code | VARCHAR | 50 | 否 | 是 | | SKU编码 | 唯一索引，系统自动生成 |
| sku_name | VARCHAR | 200 | 否 | 是 | | SKU名称 | 商品完整名称 |
| specifications | VARCHAR | 500 | 否 | 否 | | 商品规格 | 规格描述信息 |
| barcode | VARCHAR | 50 | 否 | 否 | | 条形码 | 唯一索引 |
| category_id | INT | 11 | 否 | 是 | | 分类ID | 外键关联categories.id |
| category_name | VARCHAR | 200 | 否 | 是 | | 分类名称 | 冗余字段，便于查询 |
| unit | VARCHAR | 20 | 否 | 是 | | 销售单位 | 如：件、瓶、盒、包等 |
| weight | DECIMAL | 10,3 | 否 | 否 | 0.000 | 重量 | 单位：千克 |
| weight_unit | VARCHAR | 10 | 否 | 否 | 'kg' | 重量单位 | kg、g等 |
| volume | DECIMAL | 10,3 | 否 | 否 | 0.000 | 体积 | 单位：升 |
| volume_unit | VARCHAR | 10 | 否 | 否 | 'L' | 体积单位 | L、ml等 |
| default_sale_price | DECIMAL | 10,2 | 否 | 否 | 0.00 | 默认销售价格 | 单位：元 |
| cost_price | DECIMAL | 10,2 | 否 | 否 | 0.00 | 成本价格 | 单位：元 |
| member_price | DECIMAL | 10,2 | 否 | 否 | 0.00 | 会员价格 | 单位：元 |
| status | VARCHAR | 20 | 否 | 是 | 'draft' | 商品状态 | draft,pending,approved,active,inactive |
| stock_quantity | INT | 11 | 否 | 是 | 0 | 当前库存数量 | |
| min_stock | INT | 11 | 否 | 是 | 0 | 最小库存预警阈值 | |
| max_stock | INT | 11 | 否 | 是 | 0 | 最大库存上限 | |
| sales_count | INT | 11 | 否 | 是 | 0 | 销售数量统计 | |
| is_combo | TINYINT | 1 | 否 | 是 | 0 | 是否组合商品 | 0-否，1-是 |
| is_active | TINYINT | 1 | 否 | 是 | 1 | 是否启用 | 0-禁用，1-启用 |
| created_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 | |
| updated_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |
| created_by | VARCHAR | 50 | 否 | 是 | | 创建人 | |
| updated_by | VARCHAR | 50 | 否 | 是 | | 更新人 | |

**索引设计：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_sku_code (sku_code)  
- UNIQUE KEY uk_barcode (barcode)
- KEY idx_category_id (category_id)
- KEY idx_status (status)
- KEY idx_created_time (created_time)
- KEY idx_is_active (is_active)

### 3.2 商品分类表 (categories)

**表描述：** 存储商品分类的层次结构，支持三级分类，包含搜索优化字段

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 描述 | 备注 |
|--------|----------|------|----------|----------|--------|------|------|
| id | INT | 11 | 是 | 是 | AUTO_INCREMENT | 分类主键ID | 自增长 |
| category_id | VARCHAR | 50 | 否 | 是 | | 分类编码 | 唯一索引，系统自动生成 |
| title | VARCHAR | 100 | 否 | 是 | | 分类名称 | |
| parent_id | INT | 11 | 否 | 否 | NULL | 上级分类ID | 外键关联categories.id |
| level | TINYINT | 1 | 否 | 是 | 1 | 分类级别 | 1-一级，2-二级，3-三级 |
| sort | INT | 11 | 否 | 是 | 0 | 排序序号 | 数字越小越靠前 |
| path | VARCHAR | 500 | 否 | 否 | | 分类路径 | 用于快速查找，格式：/1/2/3 |
| full_name | VARCHAR | 300 | 否 | 否 | | 完整分类名称 | 包含父级名称，用于搜索 |
| description | VARCHAR | 500 | 否 | 否 | | 分类描述 | |
| icon | VARCHAR | 100 | 否 | 否 | | 分类图标 | 图标URL或类名 |
| status | VARCHAR | 20 | 否 | 是 | 'active' | 状态 | active-启用，inactive-禁用 |
| created_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 | |
| updated_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |
| created_by | VARCHAR | 50 | 否 | 是 | | 创建人 | |
| updated_by | VARCHAR | 50 | 否 | 是 | | 更新人 | |

**索引设计：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_category_id (category_id)
- KEY idx_parent_id (parent_id)
- KEY idx_level (level)
- KEY idx_status (status)
- KEY idx_sort (sort)
- KEY idx_path (path)

### 3.3 组合商品表 (combo_products)

**表描述：** 存储组合商品的基本信息，支持营销套餐配置和审批流程

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 描述 | 备注 |
|--------|----------|------|----------|----------|--------|------|------|
| id | INT | 11 | 是 | 是 | AUTO_INCREMENT | 组合商品主键ID | 自增长 |
| combo_id | VARCHAR | 50 | 否 | 是 | | 组合商品编码 | 唯一索引 |
| spu_id | VARCHAR | 50 | 否 | 否 | | 关联SPUID | 可选关联字段 |
| sku_code | VARCHAR | 50 | 否 | 是 | | SKU编码 | 必填，唯一索引 |
| name | VARCHAR | 200 | 否 | 是 | | 组合商品名称 | 必填 |
| category_id | INT | 11 | 否 | 是 | | 分类ID | 外键关联categories.id |
| category_name | VARCHAR | 200 | 否 | 是 | | 分类名称 | 冗余字段 |
| specifications | VARCHAR | 500 | 否 | 是 | | 规格描述 | 必填 |
| unit | VARCHAR | 20 | 否 | 是 | '组' | 销售单位 | 默认为"组" |
| price | DECIMAL | 10,2 | 否 | 是 | 0.00 | 组合价格 | 销售价格 |
| original_price | DECIMAL | 10,2 | 否 | 是 | 0.00 | 原价总计 | 各单品价格之和 |
| discount_amount | DECIMAL | 10,2 | 否 | 是 | 0.00 | 优惠金额 | 原价-组合价 |
| discount_rate | DECIMAL | 5,2 | 否 | 是 | 0.00 | 优惠比例 | 百分比 |
| status | VARCHAR | 20 | 否 | 是 | 'draft' | 状态 | draft,pending,active,inactive |
| stock | INT | 11 | 否 | 是 | 0 | 库存数量 | |
| sales_count | INT | 11 | 否 | 是 | 0 | 销售数量 | |
| sort_order | INT | 11 | 否 | 是 | 0 | 排序序号 | |
| is_featured | TINYINT | 1 | 否 | 是 | 0 | 是否推荐 | 0-否，1-是 |
| valid_from | DATETIME | | 否 | 否 | NULL | 有效期开始 | |
| valid_to | DATETIME | | 否 | 否 | NULL | 有效期结束 | |
| created_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 | |
| updated_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |
| created_by | VARCHAR | 50 | 否 | 是 | | 创建人 | |
| updated_by | VARCHAR | 50 | 否 | 是 | | 更新人 | |

**索引设计：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_combo_id (combo_id)
- UNIQUE KEY uk_sku_code (sku_code)
- KEY idx_category_id (category_id)
- KEY idx_status (status)
- KEY idx_spu_id (spu_id)
- KEY idx_created_time (created_time)

### 3.4 组合商品明细表 (combo_items)

**表描述：** 存储组合商品包含的单品信息和数量配置

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 描述 | 备注 |
|--------|----------|------|----------|----------|--------|------|------|
| id | INT | 11 | 是 | 是 | AUTO_INCREMENT | 明细主键ID | 自增长 |
| combo_id | VARCHAR | 50 | 否 | 是 | | 组合商品编码 | 外键关联combo_products.combo_id |
| sku_id | VARCHAR | 50 | 否 | 是 | | 单品SKU编码 | 外键关联products.sku_code |
| sku_name | VARCHAR | 200 | 否 | 是 | | 单品名称 | 冗余字段 |
| unit_price | DECIMAL | 10,2 | 否 | 是 | 0.00 | 单品价格 | 单价 |
| quantity | INT | 11 | 否 | 是 | 1 | 数量 | 组合中包含的数量 |
| subtotal | DECIMAL | 10,2 | 否 | 是 | 0.00 | 小计 | 单价*数量 |
| sort_order | INT | 11 | 否 | 是 | 0 | 排序序号 | |
| created_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 | |
| updated_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |

**索引设计：**
- PRIMARY KEY (id)
- KEY idx_combo_id (combo_id)
- KEY idx_sku_id (sku_id)
- KEY idx_sort_order (sort_order)

### 3.5 审批记录表 (approval_records)

**表描述：** 存储商品管理相关的审批记录，包括商品新增、修改、上下架、组合商品配置等操作的审批流程

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 描述 | 备注 |
|--------|----------|------|----------|----------|--------|------|------|
| id | INT | 11 | 是 | 是 | AUTO_INCREMENT | 审批记录主键ID | 自增长 |
| approval_id | VARCHAR | 50 | 否 | 是 | | 审批单号 | 唯一索引，系统自动生成 |
| target_type | VARCHAR | 50 | 否 | 是 | | 审批对象类型 | product,category,combo |
| target_id | VARCHAR | 50 | 否 | 是 | | 审批对象ID | |
| target_name | VARCHAR | 200 | 否 | 是 | | 审批对象名称 | |
| approval_type | VARCHAR | 50 | 否 | 是 | | 审批类型 | create,update,delete,activate,deactivate |
| current_status | VARCHAR | 20 | 否 | 是 | 'pending' | 当前状态 | pending,approved,rejected,cancelled |
| priority | VARCHAR | 20 | 否 | 是 | 'normal' | 优先级 | low,normal,high,urgent |
| applicant | VARCHAR | 50 | 否 | 是 | | 申请人姓名 | |
| applicant_id | VARCHAR | 50 | 否 | 是 | | 申请人ID | |
| applicant_dept | VARCHAR | 100 | 否 | 否 | | 申请人部门 | |
| apply_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 申请时间 | |
| approver | VARCHAR | 50 | 否 | 否 | | 审批人姓名 | |
| approver_id | VARCHAR | 50 | 否 | 否 | | 审批人ID | |
| approver_dept | VARCHAR | 100 | 否 | 否 | | 审批人部门 | |
| approve_time | DATETIME | | 否 | 否 | NULL | 审批时间 | |
| approval_comments | VARCHAR | 1000 | 否 | 否 | | 审批意见 | |
| apply_reason | VARCHAR | 1000 | 否 | 否 | | 申请原因 | |
| approval_data | TEXT | | 否 | 否 | | 审批数据内容 | JSON格式存储申请的具体数据变更 |
| attachment_urls | TEXT | | 否 | 否 | | 附件URL列表 | JSON数组格式 |
| notification_sent | TINYINT | 1 | 否 | 是 | 0 | 是否已发送通知 | 0-否，1-是 |
| deadline | DATETIME | | 否 | 否 | NULL | 审批截止时间 | |
| created_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 创建时间 | |
| updated_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |

**索引设计：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_approval_id (approval_id)
- KEY idx_target_type (target_type)
- KEY idx_target_id (target_id)
- KEY idx_approval_type (approval_type)
- KEY idx_current_status (current_status)
- KEY idx_applicant_id (applicant_id)
- KEY idx_approver_id (approver_id)
- KEY idx_apply_time (apply_time)
- KEY idx_priority (priority)

### 3.6 变更记录表 (change_records)

**表描述：** 存储系统所有重要操作的变更记录，支持审计追溯和问题排查

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 描述 | 备注 |
|--------|----------|------|----------|----------|--------|------|------|
| id | INT | 11 | 是 | 是 | AUTO_INCREMENT | 记录主键ID | 自增长 |
| record_id | VARCHAR | 50 | 否 | 是 | | 变更记录编号 | 唯一索引 |
| target_type | VARCHAR | 50 | 否 | 是 | | 目标对象类型 | product,category,combo |
| target_id | VARCHAR | 50 | 否 | 是 | | 目标对象ID | |
| target_name | VARCHAR | 200 | 否 | 是 | | 目标对象名称 | |
| change_type | VARCHAR | 20 | 否 | 是 | | 变更类型 | create,update,delete |
| change_field | VARCHAR | 100 | 否 | 否 | | 变更字段 | 具体变更的字段名 |
| change_description | VARCHAR | 500 | 否 | 是 | | 变更描述 | 变更内容的描述 |
| operator | VARCHAR | 50 | 否 | 是 | | 操作人姓名 | |
| operator_id | VARCHAR | 50 | 否 | 是 | | 操作人ID | |
| operator_dept | VARCHAR | 100 | 否 | 否 | | 操作人部门 | |
| change_time | DATETIME | | 否 | 是 | CURRENT_TIMESTAMP | 变更时间 | |
| old_value | TEXT | | 否 | 否 | | 变更前值 | JSON格式存储 |
| new_value | TEXT | | 否 | 否 | | 变更后值 | JSON格式存储 |
| reason | VARCHAR | 500 | 否 | 否 | | 变更原因 | |
| affected_skus | TEXT | | 否 | 否 | | 影响的SKU | JSON数组格式 |
| approval_id | VARCHAR | 50 | 否 | 否 | | 关联审批单号 | 如果通过审批产生的变更 |
| approver | VARCHAR | 50 | 否 | 否 | | 审核人 | |
| ip_address | VARCHAR | 50 | 否 | 否 | | 操作IP地址 | |
| user_agent | VARCHAR | 500 | 否 | 否 | | 用户代理信息 | |
| session_id | VARCHAR | 100 | 否 | 否 | | 会话ID | |
| status | VARCHAR | 20 | 否 | 是 | 'completed' | 记录状态 | pending,completed,failed |

**索引设计：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_record_id (record_id)
- KEY idx_target_type (target_type)
- KEY idx_target_id (target_id)
- KEY idx_change_type (change_type)
- KEY idx_change_time (change_time)
- KEY idx_operator_id (operator_id)
- KEY idx_approval_id (approval_id)
- KEY idx_status (status)

## 4. 数据约束规则

### 4.1 业务约束
1. **商品编码唯一性：** SKU编码在系统中必须唯一，包括单品和组合商品
2. **条形码唯一性：** 商品条形码全局唯一，不允许重复
3. **分类层级限制：** 商品分类最多支持3级层次结构
4. **组合商品限制：** 单个组合商品最多包含20个子商品
5. **审批单号唯一性：** 审批单号在系统中必须唯一
6. **审批状态流转：** 审批状态必须按规定流程变更（待审批→已通过/已拒绝/已撤销）
7. **审批数据完整性：** 审批通过后的数据必须与申请数据一致
8. **分类删除约束：** 有关联商品的分类不能删除
9. **组合商品状态约束：** 组合商品包含的单品必须处于有效状态

### 4.2 数据完整性约束
1. **外键约束：** 确保关联表间的数据一致性
2. **非空约束：** 关键字段不允许为空
3. **唯一约束：** 编码类字段保证唯一性
4. **检查约束：** 状态字段只能取预定义值
5. **级联约束：** 分类删除时检查关联商品
6. **价格约束：** 价格字段必须为非负数

### 4.3 操作约束
1. **状态流转：** 商品状态必须按规定流程变更
2. **审批机制：** 重要操作需要通过审批流程确认
3. **日志记录：** 所有CRUD操作必须记录日志
4. **级联删除：** 删除主记录时处理关联数据
5. **审批权限：** 申请人和审批人不能为同一人
6. **审批时效：** 审批记录超过有效期自动失效
7. **数据回滚：** 审批拒绝时相关数据自动回滚到申请前状态
8. **搜索优化：** 支持分类名称和编码的模糊搜索

## 5. 索引策略

### 5.1 主键索引
所有表都设置自增长主键，确保记录唯一性和查询性能。

### 5.2 唯一索引
对业务唯一字段创建唯一索引，如SKU编码、条形码、审批单号等。

### 5.3 普通索引
对经常用于查询条件的字段创建索引，如状态、时间、操作人等。

### 5.4 外键索引
对所有外键字段创建索引，提升关联查询性能。

### 5.5 复合索引
对多字段组合查询创建复合索引，如统计表的唯一复合索引。

## 6. 数据安全

### 6.1 备份策略
- 每日自动全量备份
- 重要操作前手动备份
- 备份文件加密存储
- 审批记录永久保存
- 变更记录不可删除

### 6.2 访问控制
- 数据库用户权限分级
- 商品数据访问权限控制
- 审批流程权限验证
- 操作日志审计跟踪
- 敏感数据脱敏处理

### 6.3 数据保护
- 测试环境数据脱敏
- 审批数据加密存储
- 数据导出权限控制
- 变更记录不可篡改
- 用户操作行为记录

## 7. 性能优化

### 7.1 查询优化
- 分类树结构优化（路径字段）
- 商品搜索索引优化
- 统计数据缓存机制
- 分页查询优化
- 大数据量导入优化

### 7.2 存储优化
- JSON数据压缩存储
- 历史数据归档策略
- 索引定期维护
- 数据分区策略
- 冗余字段减少关联查询

---

**文档版本：** V1.1  
**创建时间：** 2025年7月03日  
**创建人：** 孙杨竣
**最后更新：** 2025年7月03日 