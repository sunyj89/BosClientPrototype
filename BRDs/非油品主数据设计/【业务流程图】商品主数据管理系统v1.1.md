# 业务流程图 - 商品主数据管理系统

## 1. 流程图说明

本文档展示了商品主数据管理系统的核心业务流程，通过可视化流程图帮助理解系统的业务逻辑和操作流程。基于最新的代码逻辑，系统主要包含商品维护、分类管理、组合商品、审批流程和变更记录等核心功能模块。

## 2. 商品新增上架流程

### 2.1 流程描述
商品新增上架是系统最核心的业务流程，涉及商品信息录入、分类设置、价格配置、审核确认和上架销售等关键环节，支持完整的状态流转管理。

### 2.2 流程图

```mermaid
graph TD
    A[商品管理员登录] --> B[访问商品主数据页面]
    B --> C[切换到商品维护标签页]
    C --> D[点击新增商品按钮]
    D --> E[填写商品基础信息]
    E --> F[输入SKU编码和名称]
    F --> G[设置商品规格和单位]
    G --> H[选择商品分类]
    H --> I[配置价格信息]
    I --> J[设置库存预警参数]
    J --> K[保存为草稿状态]
    K --> L{信息完整性检查}
    L -->|不完整| M[提示补充信息]
    M --> E
    L -->|完整| N[提交审核申请]
    N --> O[系统生成审批单号]
    O --> P[商品状态变更为待审核]
    P --> Q[通知审批人员]
    Q --> R{审批决策}
    R -->|拒绝| S[审批拒绝]
    S --> T[商品状态回退到草稿]
    T --> U[通知申请人修改]
    U --> E
    R -->|通过| V[审批通过]
    V --> W[商品状态变更为已审核]
    W --> X[支持手动上架操作]
    X --> Y[商品状态变更为上架中]
    Y --> Z[商品可正常销售]
    
    style A fill:#e1f5fe
    style Z fill:#c8e6c9
    style S fill:#ffcdd2
    style M fill:#fff3e0
```

### 2.3 流程步骤说明

| 步骤 | 操作 | 描述 | 参与角色 |
|------|------|------|----------|
| 1 | 登录系统 | 商品管理员使用账号密码登录系统 | 商品管理员 |
| 2 | 访问功能页面 | 导航到商品主数据管理页面 | 商品管理员 |
| 3 | 切换功能标签 | 在标签页中切换到商品维护功能 | 商品管理员 |
| 4 | 新增商品 | 点击"新增商品"按钮打开表单 | 商品管理员 |
| 5 | 填写基础信息 | 录入SKU编码、名称、规格、条形码等 | 商品管理员 |
| 6 | 选择商品分类 | 从三级分类树中选择合适分类 | 商品管理员 |
| 7 | 配置价格信息 | 设置销售价、成本价、会员价等 | 商品管理员 |
| 8 | 设置库存参数 | 配置最小库存、最大库存预警 | 商品管理员 |
| 9 | 保存草稿 | 暂存商品信息，状态为草稿 | 系统自动 |
| 10 | 信息完整性检查 | 验证必填字段和数据格式 | 系统自动 |
| 11 | 提交审核 | 信息完整后提交给审核人员 | 商品管理员 |
| 12 | 审核决策 | 审核商品信息是否符合要求 | 审核人员 |
| 13 | 审批通过 | 审核通过后可以手动上架 | 审核人员 |
| 14 | 手动上架 | 商品管理员手动上架销售 | 商品管理员 |
| 15 | 正常销售 | 商品在门店可正常销售 | 系统状态 |

## 3. 商品分类管理流程

### 3.1 流程图

```mermaid
graph TD
    A[商品管理员] --> B[访问分类管理页面]
    B --> C[查看分类树形结构]
    C --> D{需要搜索分类?}
    D -->|是| E[输入搜索关键词]
    E --> F[系统模糊匹配分类]
    F --> G[高亮显示搜索结果]
    G --> H[自动展开父级节点]
    H --> I[显示搜索结果统计]
    I --> J[选择目标分类]
    D -->|否| J[选择目标分类]
    J --> K{操作类型}
    K -->|新增| L[添加子分类]
    K -->|编辑| M[修改分类信息]
    K -->|删除| N[删除分类检查]
    L --> O[填写分类信息]
    M --> O
    N --> P{是否有关联商品?}
    P -->|是| Q[提示无法删除]
    P -->|否| R[确认删除分类]
    O --> S[验证分类层级]
    S --> T{层级是否合法?}
    T -->|否| U[提示层级超限]
    T -->|是| V[保存分类信息]
    R --> W[删除分类成功]
    V --> X[刷新分类树]
    W --> X
    X --> Y[分类管理完成]
    
    style A fill:#e1f5fe
    style Y fill:#c8e6c9
    style Q fill:#ffcdd2
    style U fill:#fff3e0
```

## 4. 组合商品创建流程

### 4.1 流程图

```mermaid
graph TD
    A[商品管理员] --> B[访问组合商品页面]
    B --> C[点击新建组合商品]
    C --> D[填写基础信息]
    D --> E[输入组合商品名称]
    E --> F[关联SPUID（可选）]
    F --> G[输入SKU编码]
    G --> H[选择商品分类]
    H --> I[描述商品规格]
    I --> J[设置销售单位为-组]
    J --> K[添加包含的单品]
    K --> L[选择单品SKU]
    L --> M[设置单品数量]
    M --> N[系统自动计算原价]
    N --> O[设置组合优惠价格]
    O --> P[计算优惠金额和比例]
    P --> Q[保存组合配置]
    Q --> R[设置组合状态为草稿]
    R --> S{是否提交审核?}
    S -->|否| T[保存为草稿]
    S -->|是| U[提交审核申请]
    U --> V[系统生成审批单号]
    V --> W[组合商品状态变更为待审核]
    W --> X[通知审批人员]
    X --> Y{审批决策}
    Y -->|拒绝| Z[审批拒绝，状态回退]
    Y -->|通过| AA[审批通过]
    AA --> BB[组合商品状态变更为生效]
    BB --> CC[支持激活销售]
    CC --> DD[组合商品可正常销售]
    T --> EE[后续可继续编辑]
    Z --> EE
    
    style A fill:#e1f5fe
    style DD fill:#c8e6c9
    style Z fill:#ffcdd2
    style T fill:#fff3e0
```

## 5. 审批流程管理

### 5.1 审批流程图

```mermaid
graph TD
    A[用户发起审批申请] --> B[系统验证申请数据]
    B --> C{数据验证通过?}
    C -->|否| D[返回错误提示]
    C -->|是| E[生成审批单号]
    E --> F[记录申请信息]
    F --> G[设置审批状态为待审批]
    G --> H[分配审批人员]
    H --> I[发送审批通知]
    I --> J[审批人员接收通知]
    J --> K[审批人员查看申请详情]
    K --> L[审批人员填写审批意见]
    L --> M{审批决策}
    M -->|通过| N[审批通过]
    M -->|拒绝| O[审批拒绝]
    M -->|撤销| P[审批撤销]
    N --> Q[执行审批通过逻辑]
    O --> R[执行审批拒绝逻辑]
    P --> S[执行审批撤销逻辑]
    Q --> T[更新目标对象状态]
    R --> U[数据回滚到申请前]
    S --> V[取消审批流程]
    T --> W[发送通过通知]
    U --> X[发送拒绝通知]
    V --> Y[发送撤销通知]
    W --> Z[审批流程完成]
    X --> Z
    Y --> Z
    D --> AA[用户修改后重新提交]
    AA --> A
    
    style A fill:#e1f5fe
    style Z fill:#c8e6c9
    style O fill:#ffcdd2
    style D fill:#fff3e0
```

## 6. 变更记录管理流程

### 6.1 变更记录生成流程

```mermaid
graph TD
    A[用户执行系统操作] --> B[系统捕获操作事件]
    B --> C[识别操作类型]
    C --> D{是否需要记录?}
    D -->|否| E[跳过记录]
    D -->|是| F[生成变更记录ID]
    F --> G[记录操作前数据状态]
    G --> H[执行实际业务操作]
    H --> I{操作是否成功?}
    I -->|否| J[记录操作失败]
    I -->|是| K[记录操作后数据状态]
    K --> L[构建变更记录对象]
    L --> M[记录变更详情]
    M --> N[包含操作人员信息]
    N --> O[记录变更时间]
    O --> P[记录变更原因]
    P --> Q[记录影响的SKU]
    Q --> R[关联审批单号（如有）]
    R --> S[保存变更记录到数据库]
    S --> T[变更记录完成]
    J --> U[记录错误信息]
    U --> T
    
    style A fill:#e1f5fe
    style T fill:#c8e6c9
    style J fill:#ffcdd2
```

### 6.2 变更记录查询流程

```mermaid
graph TD
    A[用户访问变更记录页面] --> B[加载初始记录列表]
    B --> C[显示筛选条件表单]
    C --> D{用户是否设置筛选条件?}
    D -->|否| E[显示全部记录]
    D -->|是| F[处理筛选条件]
    F --> G[按时间范围筛选]
    G --> H[按操作人员筛选]
    H --> I[按变更类型筛选]
    I --> J[按商品信息筛选]
    J --> K[执行数据库查询]
    K --> L[返回筛选结果]
    L --> M[分页显示记录]
    M --> N{用户是否查看详情?}
    N -->|否| O[列表浏览完成]
    N -->|是| P[点击查看详情]
    P --> Q[显示变更详情对话框]
    Q --> R[展示变更前后数据对比]
    R --> S[显示变更时间线]
    S --> T[显示审批流程信息]
    T --> U[用户查看完成]
    U --> V[关闭详情对话框]
    V --> M
    
    style A fill:#e1f5fe
    style O fill:#c8e6c9
    style U fill:#c8e6c9
```



**文档说明：**
- 本文档使用Mermaid语法绘制流程图，支持在线渲染
- 不同颜色代表不同的流程状态：
  - 蓝色：起始节点
  - 绿色：成功结束节点  
  - 红色：异常或失败节点
  - 橙色：警告或待处理节点
- 流程图涵盖了系统的核心业务流程和技术流程
- 每个流程都基于实际的代码逻辑和业务需求设计

**文档版本：** V1.1  
**创建时间：** 2025年7月03日  
**创建人：** 孙杨竣  
**最后更新：** 2025年7月03日 