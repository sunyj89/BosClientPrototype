# 商业需求文档 (BRD) - 组织结构和角色设计模块

**文档版本：** v1.0  
**创建日期：** 2025年7月8日  
**最后更新：** 2025年7月8日

## 1. 模块概述 (Project Overview)

### 1.1 模块目标与价值 (Project Goals and Value Proposition)
* **主要目标：** 提供一个完整的组织架构管理和角色权限配置系统，支持企业级的组织结构层级管理、人员配置和角色权限精细化控制。
* **核心价值：** 
  - 为企业提供清晰的组织架构可视化管理
  - 实现基于角色的权限控制（RBAC）
  - 提升人员管理效率和权限分配准确性
  - 支持多级法人主体的复杂组织结构

### 1.2 模块范围 (Project Scope)
* **核心功能模块：** 
  - 组织架构树管理模块
  - 用户人员管理模块  
  - 角色权限配置模块
  - 组织单元管理模块
* **本次迭代：** 基于当前代码逻辑的完整功能范围，包含组织架构的增删改查、用户管理、角色配置等核心功能

## 2. 用户分析 (User Analysis)

### 2.1 用户场景 (User Scenarios)
* **场景1：组织架构管理员创建新组织单元**
  - 管理员访问组织架构管理页面，查看当前组织树结构
  - 选择合适的上级组织节点（如分公司节点）
  - 点击"新增子组织"按钮，打开新增组织弹窗
  - 填写组织名称（如"某某服务区"）、选择组织类型（服务区）、选择法人主体
  - 提交保存，系统自动更新组织树结构

* **场景2：HR管理员为组织配置人员**
  - HR在组织树中选择具体的组织节点（如某个加油站）
  - 查看当前组织下的员工列表，点击"添加用户"按钮
  - 在用户表单中填写员工姓名、选择岗位角色（从角色列表中选择）
  - 系统自动关联该员工到选中的组织单元，完成人员配置

* **场景3：系统管理员配置角色权限**
  - 管理员进入角色配置页面，查看当前所有角色配置
  - 创建新角色（如"服务区经理"），设置角色描述和适用组织类型
  - 配置该角色的页面操作权限和数据访问范围
  - 保存角色配置，该角色可用于用户分配

## 3. 产品需求 (Product Requirements)

### 3.1 功能需求 (Functional Requirements)

* **模块一：组织架构树管理模块**
  * **FR1.1 功能点名称：** 组织架构树展示
    * **描述：** 以树形结构展示完整的组织架构，支持展开/收起操作，不同组织类型显示不同图标和颜色
    * **输入：** 无（页面加载时自动获取）
    * **处理逻辑：** 调用getOrgTree API获取组织树数据，通过OrgTree组件渲染，根据orgType显示对应图标
    * **输出/预期结果：** 显示层级化的组织架构树，支持节点选择操作

  * **FR1.2 功能点名称：** 组织节点选择
    * **描述：** 用户可以点击选择组织树中的任意节点，查看对应的组织详情和人员列表
    * **输入：** 用户点击的树节点
    * **处理逻辑：** 触发handleNodeSelect函数，设置selectedNode状态，同时调用getUsersByOrgId获取用户列表
    * **输出/预期结果：** 更新组织详情显示，加载对应的员工列表

* **模块二：组织单元管理模块**
  * **FR2.1 功能点名称：** 新增组织单元
    * **描述：** 在选中的组织节点下创建子组织单元，支持不同组织类型的层级约束
    * **输入：** 组织名称、组织类型、法人主体、上级组织ID
    * **处理逻辑：** 验证组织类型层级关系（如总部下可建部门/分公司，分公司下可建服务区等），调用addOrgUnit API保存
    * **输出/预期结果：** 成功创建组织单元，自动刷新组织树显示新节点

  * **FR2.2 功能点名称：** 组织详情展示
    * **描述：** 显示选中组织节点的详细信息，包括名称、类型、上级组织、法人主体等
    * **输入：** 选中的组织节点数据
    * **处理逻辑：** 通过OrgDetails组件展示节点信息，根据组织类型显示不同颜色标签
    * **输出/预期结果：** 以描述列表形式展示组织详细信息

* **模块三：用户人员管理模块**
  * **FR3.1 功能点名称：** 用户列表展示
    * **描述：** 显示选中组织节点下的所有员工信息，包括用户ID、姓名、角色等
    * **输入：** 组织节点ID
    * **处理逻辑：** 调用getUsersByOrgId API获取用户数据，通过UserList组件以表格形式展示
    * **输出/预期结果：** 分页显示员工列表，支持查看用户详情

  * **FR3.2 功能点名称：** 添加用户
    * **描述：** 在选中组织下新增员工，配置用户基本信息和角色
    * **输入：** 用户姓名、角色ID、所属组织ID
    * **处理逻辑：** 打开用户编辑弹窗，验证表单数据，调用addUser API保存用户信息
    * **输出/预期结果：** 成功添加用户，刷新用户列表显示新用户

  * **FR3.3 功能点名称：** 编辑用户
    * **描述：** 修改现有用户的基本信息和角色配置
    * **输入：** 用户ID、更新的用户信息
    * **处理逻辑：** 预填用户当前信息到表单，验证修改数据，调用updateUser API更新
    * **输出/预期结果：** 成功更新用户信息，刷新列表显示最新数据

  * **FR3.4 功能点名称：** 删除用户
    * **描述：** 从组织中移除指定用户
    * **输入：** 用户ID
    * **处理逻辑：** 显示确认弹窗，用户确认后调用deleteUser API删除
    * **输出/预期结果：** 成功删除用户，从列表中移除该用户记录

* **模块四：角色权限配置模块**
  * **FR4.1 功能点名称：** 角色配置列表
    * **描述：** 显示系统中所有角色配置，包括角色名称、描述、适用组织类型、权限数量等
    * **输入：** 无（页面加载时获取）
    * **处理逻辑：** 调用getRoleConfigurations API获取角色列表，以表格形式展示
    * **输出/预期结果：** 分页显示所有角色配置，区分系统角色和自定义角色

  * **FR4.2 功能点名称：** 添加角色配置
    * **描述：** 创建新的角色配置，设置角色名称、描述、适用组织类型和权限范围
    * **输入：** 角色名称、描述、组织类型、页面权限、数据权限
    * **处理逻辑：** 打开角色配置弹窗，配置权限选项，验证数据后调用addRoleConfiguration API保存
    * **输出/预期结果：** 成功创建角色配置，可用于用户分配

  * **FR4.3 功能点名称：** 编辑角色配置
    * **描述：** 修改现有角色的配置信息和权限设置
    * **输入：** 角色ID、更新的角色配置数据
    * **处理逻辑：** 预加载角色当前配置，修改后调用updateRoleConfiguration API更新
    * **输出/预期结果：** 成功更新角色配置，影响使用该角色的所有用户

  * **FR4.4 功能点名称：** 复制角色配置
    * **描述：** 基于现有角色创建副本，快速配置相似角色
    * **输入：** 源角色ID、新角色名称、新角色描述
    * **处理逻辑：** 复制源角色的所有配置信息，修改名称和描述后保存为新角色
    * **输出/预期结果：** 生成新的角色配置，继承源角色的权限设置

  * **FR4.5 功能点名称：** 删除角色配置
    * **描述：** 删除自定义角色配置（系统角色不允许删除）
    * **输入：** 角色ID
    * **处理逻辑：** 检查是否为系统角色，确认删除后调用deleteRoleConfiguration API
    * **输出/预期结果：** 成功删除角色配置，该角色不再可用于用户分配

### 3.2 数据需求 (Data Requirements)

* **数据实体一：组织单元 (OrgUnit)**
  * **属性：** id（组织ID）, name（组织名称）, orgType（组织类型：HEADQUARTER/DEPARTMENT/CITY_BRANCH/SERVICE_AREA/GAS_STATION）, parentId（上级组织ID）, parentName（上级组织名称）, legalEntity（法人主体对象）, children（子组织数组）
  * **来源：** 组织架构配置表单、组织管理操作
  * **存储：** 后端数据库，前端通过organizationData.json模拟存储

* **数据实体二：用户 (User)**
  * **属性：** id（用户ID）, name（用户姓名）, orgUnitId（所属组织ID）, role（角色对象，包含角色ID和名称）, createTime（创建时间）, updateTime（更新时间）
  * **来源：** 用户管理表单、HR人员配置操作
  * **存储：** 后端数据库，与组织单元关联存储

* **数据实体三：角色配置 (RoleConfiguration)**
  * **属性：** id（角色ID）, roleName（角色名称）, description（角色描述）, orgTypes（适用组织类型数组）, permissions（权限配置对象）, isSystemRole（是否系统角色）, createTime（创建时间）, updateTime（更新时间）
  * **来源：** 角色配置表单、权限管理操作
  * **存储：** 后端数据库，支持权限的细粒度配置

* **数据实体四：权限定义 (Permission)**
  * **属性：** pageOperations（页面操作权限数组）, dataScope（数据范围权限配置）
  * **来源：** 系统权限定义、角色配置操作
  * **存储：** 权限配置表，支持页面级和数据级权限控制

* **数据实体五：法人主体 (LegalEntity)**
  * **属性：** id（法人主体ID）, name（法人主体名称）
  * **来源：** 企业法人主体配置
  * **存储：** 基础数据表，用于组织单元的法人关联

## 4. 核心业务流程 (Core Business Flows)

* **流程一：组织架构管理流程**
  1. 用户访问组织架构管理页面（触发loadTreeData函数）
  2. 系统加载组织树数据（调用getOrgTree API）
  3. 页面渲染组织架构树（通过OrgTree组件展示）
  4. 管理员选择组织节点创建子组织（点击"新增子组织"）
  5. 打开新增组织弹窗（AddOrgModal组件）
  6. 填写组织信息并提交（调用addOrgUnit API）
  7. 验证组织层级关系和数据完整性
  8. 保存新组织单元到数据库
  9. 刷新组织树显示更新结果

* **流程二：用户人员管理流程**
  1. 用户在组织树中选择目标组织节点
  2. 系统加载该组织下的员工列表（调用getUsersByOrgId）
  3. HR点击"添加用户"按钮
  4. 打开用户编辑弹窗，预设组织信息
  5. 填写用户姓名、选择角色（从roles数组中选择）
  6. 提交用户信息（调用addUser API）
  7. 验证用户数据和角色权限
  8. 保存用户信息到数据库
  9. 刷新用户列表显示新增用户

* **流程三：角色权限配置流程**
  1. 管理员访问角色配置页面
  2. 系统加载角色配置列表（调用getRoleConfigurations）
  3. 管理员点击"新增角色配置"
  4. 打开角色配置弹窗（RoleConfigModal组件）
  5. 配置角色基本信息（名称、描述、适用组织类型）
  6. 设置页面操作权限和数据范围权限
  7. 提交角色配置（调用addRoleConfiguration API）
  8. 验证权限配置的合法性
  9. 保存角色配置到数据库
  10. 角色可用于用户分配和权限控制

## 5. 假设与约束 (Assumptions and Constraints)

* **技术假设：** 
  - 基于React + Ant Design技术栈开发
  - 使用模拟API进行数据交互（organizationData.json）
  - 支持现代浏览器环境运行

* **功能约束：** 
  - 组织类型具有严格的层级约束（总部→部门/分公司→服务区→加油站）
  - 系统角色不允许删除或修改核心配置
  - 当前为前端模拟实现，实际生产需要后端API支持

* **数据约束：** 
  - 组织名称长度限制为2-50个字符
  - 用户姓名为必填项
  - 角色配置必须指定适用的组织类型
  - 法人主体为组织单元的必选关联

---

**文档说明：** 本文档基于 `src\pages\organization` 目录下的代码逻辑分析生成，涵盖了组织架构管理、用户管理、角色配置等核心功能模块的详细需求定义。 