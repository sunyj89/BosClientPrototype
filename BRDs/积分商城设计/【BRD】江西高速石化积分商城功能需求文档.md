# 商业需求文档 (BRD) - 江西高速积分商城功能系统

## 1. 项目概述 (Project Overview)

### 1.1 项目背景与痛点 (Background and Pain Points)
积分商城功能是基于江西高速石化零售业务场景设计的积分兑换平台，旨在解决以下用户痛点和市场需求：
* **积分价值变现困难**：用户在加油站消费获得的积分缺乏有效的兑换渠道和价值体现
* **客户黏性不足**：传统的积分奖励机制缺乏吸引力，难以提升客户忠诚度和复购率
* **商品供应链复杂**：需要整合多种商品来源（自营商品、京东商品等），满足用户多样化需求
* **运营管理效率低**：缺乏统一的积分商城管理平台，无法高效管理商品、订单、活动等

### 1.2 项目目标与价值 (Project Goals and Value Proposition)
* **主要目标：** 构建一个综合性的积分商城管理系统，为用户提供丰富的积分兑换选择，提升积分价值感知和使用频率，同时为运营人员提供完善的商城管理工具
* **核心价值：** 
  - 提升用户积分使用率和账户活跃度
  - 增强客户黏性和品牌忠诚度
  - 提供多元化的商品供应和配送方式
  - 简化运营管理流程，提高运营效率

### 1.3 项目范围 (Project Scope)
* **核心功能模块：** Banner管理、商品管理、分类管理、活动配置、订单管理、积分商城规则配置
* **本次迭代：** 基于当前代码逻辑的完整积分商城管理后台功能范围，支持多种支付方式、京东商品接入、库存管理等

## 2. 用户分析 (User Analysis)

### 2.1 目标用户群体 (Target Audience)
* **主要用户**：加油站会员用户，包括个人车主、企业用户等
* **管理用户**：积分商城运营人员、客服人员、财务人员
* **用户特征：** 
  - 具有一定的积分余额
  - 对实用性商品和优惠券有需求
  - 习惯移动端购物和支付

### 2.2 用户场景 (User Scenarios)
* **场景一：积分兑换商品**
  用户A有1000积分，希望兑换洗车服务。流程：浏览商城 → 选择洗车服务(200积分) → 确认兑换 → 选择自提站点 → 支付积分 → 获取兑换凭证 → 到站提货
  
* **场景二：积分+现金组合购买**
  用户B看中机油保养套餐(400积分+60元)。流程：选择商品 → 确认组合价格 → 积分支付400分 → 微信支付60元 → 预约服务时间 → 到店享受服务
  
* **场景三：京东商品配送**
  用户C兑换京东商品。流程：选择京东商品 → 积分支付 → 填写配送地址 → 系统对接京东 → 京东发货配送 → 用户收货

## 3. 产品需求 (Product Requirements)

### 3.1 功能需求 (Functional Requirements)

#### **模块一：Banner管理模块**
* **FR1.1 Banner展示管理**
  * **描述：** 管理积分商城首页的轮播Banner，支持多种跳转类型和状态控制
  * **输入：** Banner标题、图片、跳转类型(页面链接/商品链接/外部链接/不跳转)、跳转URL、开始时间、结束时间、排序号、状态
  * **处理逻辑：** 支持Banner的创建、编辑、删除操作，自动根据时间判断Banner状态(active/scheduled/inactive)，按排序号控制显示顺序
  * **输出/预期结果：** Banner列表展示，支持筛选查询，状态标签显示，操作日志记录

#### **模块二：商品管理模块**
* **FR2.1 商品信息管理**
  * **描述：** 管理积分商城的所有商品，包括自营商品和京东商品，支持多种支付方式
  * **输入：** 商品编号(PSG开头)、商品名称、类别(汽车服务/生活服务/日用百货/京东商品/代金券/数码电器)、支付方式(积分支付/积分+微信组合/微信支付)、价格设置、库存信息
  * **处理逻辑：** 根据商品类别自动设置支付方式限制(京东商品仅支持积分支付)，计算总库存和各站点库存，支持多图片上传，自动生成商品编号
  * **输出/预期结果：** 商品列表展示，支持按类别、状态、支付方式筛选，库存预警显示

* **FR2.2 京东商品特殊处理**
  * **描述：** 对接京东商品，支持京东商品ID和链接管理，配送方式自动设为京东物流
  * **输入：** 京东商品ID、京东商品链接、商品基本信息
  * **处理逻辑：** 验证京东商品ID和链接格式，自动设置配送方式为"京东物流"，限制支付方式为积分支付
  * **输出/预期结果：** 京东商品标识显示，链接可跳转查看，订单中显示京东配送信息

* **FR2.3 库存管理**
  * **描述：** 分站点管理商品库存，支持安全库存预警和自动上下架
  * **输入：** 各站点实时库存、安全库存阈值、自动上架时间、自动下架时间
  * **处理逻辑：** 计算可售库存(实时库存-安全库存)，库存不足时自动下架，支持库存状态标签显示
  * **输出/预期结果：** 库存详情表格，库存状态颜色标识，库存预警提示

#### **模块三：分类管理模块**
* **FR3.1 商品分类体系**
  * **描述：** 管理三级分类体系，对接主数据分类标准
  * **输入：** 一级分类(食品饮料/汽车服务/日用品/优惠券类/数码电器/第三方商品)、二级分类、三级分类、分类编码、显示顺序
  * **处理逻辑：** 支持三级联动选择，自动填充分类编码和名称，验证分类层级关系
  * **输出/预期结果：** 分类树形结构展示，支持启用/禁用状态切换，商品数量统计

#### **模块四：活动配置模块**
* **FR4.1 促销活动管理**
  * **描述：** 配置积分商城的促销活动，支持多站点应用和活动规则设置
  * **输入：** 活动ID、活动名称、开始结束时间、适用油站清单、活动描述、活动规则、海报图片、商品跳转链接
  * **处理逻辑：** 根据当前时间自动判断活动状态(未开始/进行中/已结束)，生成H5活动页面链接，支持多站点选择
  * **输出/预期结果：** 活动列表展示，状态自动更新，支持活动的启动/停止操作

#### **模块五：订单管理模块**
* **FR5.1 订单处理流程**
  * **描述：** 管理积分商城的所有订单，支持多种支付方式和配送方式
  * **输入：** 订单基本信息、用户信息、商品明细、支付信息、配送信息
  * **处理逻辑：** 区分配送方式(油站自提/京东配送)，处理不同支付方式的费用分拆，记录订单状态变化
  * **输出/预期结果：** 订单列表展示，支持订单状态筛选，订单详情查看

* **FR5.2 退款审批流程**
  * **描述：** 处理用户退款申请，支持退款审批和退款处理
  * **输入：** 退款原因、退款金额、退款积分、申请时间
  * **处理逻辑：** 退款申请提交后状态为"待退款"，支持管理员审批通过/拒绝，审批通过后自动处理退款
  * **输出/预期结果：** 退款信息展示，审批状态跟踪，退款处理结果通知

#### **模块六：积分商城规则配置模块**
* **FR6.1 积分使用限制**
  * **描述：** 配置积分在商城中的使用规则和限制条件
  * **输入：** 每日积分使用上限、每单最大积分使用量、规则描述、启用状态
  * **处理逻辑：** 支持启用/禁用积分限制功能，设置具体的积分使用阈值，实时预览规则效果
  * **输出/预期结果：** 规则配置保存，当前生效规则展示，规则说明文档

* **FR6.2 规则文档管理**
  * **描述：** 管理积分商城相关的规则文档和用户须知
  * **输入：** 积分规则文档、用户须知文档(支持上传/下载/删除)
  * **处理逻辑：** 支持文档上传、在线预览、下载和删除操作，记录文档版本和更新时间
  * **输出/预期结果：** 文档列表展示，文件大小和时间信息，文档访问链接

### 3.2 数据需求 (Data Requirements)

#### **数据实体一：Banner数据 (Banner)**
* **属性：** Banner ID、标题、图片URL、状态(active/scheduled/inactive)、跳转类型、跳转链接、开始时间、结束时间、排序号、创建时间、更新时间
* **来源：** 运营人员通过管理后台创建和编辑
* **存储：** 数据库表存储，图片文件存储到文件服务器

#### **数据实体二：商品信息 (Product)**
* **属性：** 商品ID、商品编号、商品名称、类别ID、类别名称、商品图片(支持多张)、商品描述、原价、商城价格、支付方式、促销标签、库存信息、状态、排序号、自动上下架时间、京东商品ID(可选)、京东商品链接(可选)
* **来源：** 运营人员录入，部分信息对接京东API
* **存储：** 商品主表+商品图片表+库存表

#### **数据实体三：订单信息 (Order)**
* **属性：** 订单号、用户ID、用户信息、下单时间、支付方式、订单状态、配送方式、配送地址、自提站点、订单总金额、积分使用量、现金支付额、微信支付额、商品明细、退款信息(可选)
* **来源：** 用户下单操作，系统自动生成
* **存储：** 订单主表+订单商品明细表+退款记录表

#### **数据实体四：分类信息 (Category)**
* **属性：** 分类ID、分类名称、分类编码、一级分类编码、二级分类编码、三级分类编码、层级名称、显示顺序、状态、商品数量、创建时间、更新时间
* **来源：** 对接主数据分类体系，运营人员维护
* **存储：** 分类主表，支持树形结构查询

#### **数据实体五：活动配置 (Activity)**
* **属性：** 活动ID、活动名称、开始时间、结束时间、状态、适用油站清单、活动描述、活动规则、海报图片、商品跳转链接、H5链接、创建时间、更新时间
* **来源：** 运营人员配置
* **存储：** 活动配置表+活动适用站点关联表

#### **数据实体六：积分规则 (PointsRule)**
* **属性：** 规则ID、每日积分使用上限、每单最大积分使用量、启用状态、规则描述、规则文档信息、用户须知文档信息、创建时间、更新时间
* **来源：** 运营人员配置
* **存储：** 积分规则配置表+文档信息表

### 3.3 非功能需求 (Non-functional Requirements)

* **性能：** 
  - 商品列表加载支持分页，单页最多10条记录，确保快速响应
  - 图片上传限制大小(Banner 2MB，商品图片 5MB，海报 5MB)，优化加载速度
  - 支持异步操作，避免长时间等待

* **可用性：** 
  - 提供清晰的表单验证和错误提示
  - 支持筛选、搜索、排序等便民功能
  - 提供操作确认弹窗，防止误操作
  - 状态标签颜色区分，增强视觉识别

* **安全性：** 
  - 文件上传格式限制(仅支持JPG/PNG图片)
  - 表单输入验证，防止恶意数据
  - 操作权限控制，记录操作日志
  - 京东商品链接格式验证

* **兼容性：** 
  - 支持主流浏览器访问
  - 响应式设计，适配不同屏幕尺寸
  - 京东API对接兼容性处理

## 4. 核心业务流程 (Core Business Flows)

### **流程一：商品上架流程**
1. 运营人员进入商品管理页面 (触发商品列表加载)
2. 点击"新增商品"按钮 (打开商品编辑弹窗)
3. 填写商品基本信息：商品编号、名称、类别等 (表单自动验证和联动)
4. 根据商品类别设置支付方式 (京东商品自动设为积分支付)
5. 上传商品图片，设置价格和库存信息 (调用图片上传接口)
6. 设置自动上下架时间和适用站点 (非京东商品需选择自提站点)
7. 提交商品信息 (数据验证和保存)
8. 系统验证通过后保存商品，更新商品列表 (刷新列表)

### **流程二：用户下单兑换流程**
1. 用户浏览积分商城，选择商品 (前端展示，基于Banner和商品数据)
2. 确认商品信息和价格，选择数量 (验证库存和限购规则)
3. 选择配送方式：油站自提或京东配送 (根据商品类别自动判断)
4. 确认支付方式和金额 (积分/积分+微信/微信，根据商品支持的方式)
5. 提交订单，生成订单号 (系统创建订单记录，扣减库存)
6. 支付完成，订单状态更新为"支付成功" (更新订单状态，记录支付信息)
7. 等待配送或自提 (京东商品自动对接配送，自提商品等待用户到站)

### **流程三：退款审批流程**
1. 用户申请退款 (订单状态变为"待退款"，记录退款原因)
2. 运营人员查看待审批订单 (通过订单筛选查看 状态订单)
3. 点击"退款审批"按钮 (打开审批弹窗)
4. 查看订单详情和退款申请信息 (展示完整的订单和退款信息)
5. 做出审批决定：批准或拒绝 
6. 批准退款后系统自动处理 (更新订单状态，退还积分和现金)
7. 退款完成，通知用户 (订单状态更新为"退款完成")

## 5. 假设与约束 (Assumptions and Constraints)

### **技术假设：**
* 基于React + Ant Design的前端技术栈
* 使用dayjs进行时间处理
* 支持图片上传到云存储服务
* 后端提供RESTful API接口
* 京东商品通过API对接或手动录入

### **功能约束：**
* 京东商品仅支持积分支付，不支持组合支付
* 京东商品配送信息无法实时获取，系统无法显示物流状态
* 商品图片最多支持5张，文件大小有限制
* 积分使用限制规则全局生效，不支持分商品或分用户设置

### **数据约束：**
* 商品编号必须以"PSG"开头，最大10位字符
* Banner图片不超过2MB，商品图片不超过5MB
* 京东商品链接必须是有效的URL格式
* 积分使用上限和每单限制必须为正整数

### **业务约束：**
* 库存不足时商品自动下架，需要补充库存后手动上架
* 退款审批需要人工处理，暂不支持自动退款
* 活动配置不支持复杂的优惠规则，仅支持文字描述
* 分类体系依赖主数据，需要保持数据一致性 