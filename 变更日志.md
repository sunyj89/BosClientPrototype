# 智慧能源系统BOS后台变更日志

## 2025-03-14

### 新增
- 创建销售管理模块，包括油品销售管理和商品销售管理两大子模块
  - 油品销售管理：
    - 销售数据查询（订单流水、订单明细、管控流水、管控弃单记录）
    - 价格管理（占位）
    - 任务目标（占位）
    - 数据冲正管理（占位）
    - 油品直销（占位）
  - 商品销售管理：
    - 商品销售明细（占位）
    - 商品售价调整申请（占位）
    - 商品售价调价记录（占位）
    - 商品销售日报表（占位）
    - 商品销售排行（占位）
    - 商品销售绩效（占位）
    - 机构销售任务完成情况（占位）
- 更新路由配置，添加销售管理相关路由
- 更新侧边栏菜单，添加销售管理模块入口

### 修改
- 更新 `设计规范.md` 文件，在"适用范围"部分增加"变更管理要求"，明确规定了增加新功能时需要同时更新变更日志和设计规范中的功能结构

## 2023-11-21
### 修改
- 更新 `设计规范.md` 文件，在"适用范围"部分增加"变更管理要求"，明确规定了增加新功能时需要同时更新变更日志和设计规范中的功能结构
- 修复 `/station/device/detail/` 页面，按照设计规范实现按钮交互，将"处理"和"详情"按钮改为弹窗方式，添加设备维护按钮的抽屉实现
- 修复 `/sales/oil/price/` 页面的按钮交互，将查看详情和编辑功能改为使用Modal弹窗，将审批功能改为使用Drawer抽屉，符合设计规范要求
- 修复 `/station/device/detail/LYY-11-1` 页面的设备ID解析问题，增强了设备ID格式的兼容性，添加了错误处理和加载状态优化
- 修复设备详情页面的路由配置，添加 `/station/device/detail/:id` 路由，解决404无法访问的问题

## 2023-11-22
### 新增
- 开发油品销售价格管理模块，包含以下页面：
  - `src/pages/sales/oil/price/index.js`：价格管理主页面，包含查询条件、统计卡片、数据表格和操作功能
  - `src/pages/sales/oil/price/add.js`：新增价格调整页面，包含表单和提交功能
  - `src/pages/sales/oil/price/edit.js`：编辑价格调整页面，包含表单和提交功能
  - `src/pages/sales/oil/price/detail.js`：价格调整详情页面，包含详细信息展示和返回功能
  - `src/pages/sales/oil/price/approval.js`：价格调整审批页面，包含审批表单和提交功能

### 功能说明
- 价格管理主页面实现了以下功能：
  - 统计卡片展示价格调整总数、待生效调整、已生效调整和平均变动率
  - 查询条件包括调整单号、油站、油品类型、状态、生效日期和变动率范围
  - 数据表格展示价格调整记录，包含调整单号、油站、油品类型、当前价格、新价格、变动率、生效日期、状态、创建人和创建时间
  - 操作功能包括查看详情、编辑、审批和取消
  - 支持导出数据功能

- 新增价格调整页面实现了以下功能：
  - 表单包含油站、油品类型、生效日期、当前价格、新价格、变动率和备注
  - 选择油站和油品类型后自动获取当前价格
  - 输入新价格后自动计算变动率
  - 支持表单验证和提交功能

- 编辑价格调整页面实现了以下功能：
  - 加载并展示价格调整详情
  - 支持修改新价格、生效日期和备注信息
  - 油站和油品类型不可修改
  - 支持表单验证和提交功能

- 价格调整详情页面实现了以下功能：
  - 展示价格调整的基本信息，包括调整单号、油站、油品类型、当前价格、新价格、变动率、生效日期、状态、创建人、创建时间和备注
  - 展示审批信息，包括审批状态、审批人、审批时间和审批意见
  - 展示操作历史，包括操作时间、操作人、操作类型和操作内容

- 价格调整审批页面实现了以下功能：
  - 展示价格调整的基本信息
  - 提供审批表单，包括审批结果和审批意见
  - 支持快速通过和快速拒绝功能
  - 支持表单验证和提交功能

### 技术实现
- 使用React Hooks实现状态管理和生命周期功能
- 使用Ant Design组件库实现UI界面
- 使用模拟数据进行功能演示
- 实现了响应式布局，适配不同屏幕尺寸
- 添加了表单验证和用户交互反馈
- 使用路由实现页面跳转和参数传递

### 修改
- 优化 `src/pages/station/DeviceDetail.js` 文件，完善设备详情页功能：
  1. 添加设备维护记录功能，生成模拟维护数据并以表格形式展示
  2. 优化告警记录和操作记录标签页，添加排序和筛选功能
  3. 添加历史趋势标签页，为未来数据图表展示做准备
  4. 统一所有标签页的命名风格和UI风格
  5. 设置默认激活的标签页为维护记录

## 2023-11-23
### 修复
- 修复项目编译错误问题：
  - 删除 `src/App.js` 中不存在的油品管理相关导入（`OilManagement`、`OilTankManagement`等）
  - 删除 `src/router.js` 中不存在的油品管理相关导入和路由配置
  - 优化路由配置结构，修复注释格式问题
  - 更新商品销售管理路由名称，使其更符合业务含义

### 技术说明
- 项目目录结构中不存在 `src/pages/oil` 目录，但代码中引用了该目录下的组件
- 通过删除不存在的导入和路由配置，解决了编译错误问题
- 保留了销售管理模块中的油品销售相关功能，因为这些文件位于 `src/pages/sales/oil` 目录下
- 优化了路由配置的结构和注释，提高了代码可读性

## 2023-11-24
### 修改
- 更新项目主题色为 `#32AF50`：
  - 修改 `src/App.js` 文件，添加 Ant Design 主题配置，设置 `colorPrimary` 为 `#32AF50`
  - 修改 `src/components/layout/AppSider.js` 文件，更新侧边栏样式，使用新的主题色作为 Logo 背景
  - 修改 `src/components/layout/AppHeader.js` 文件，更新顶部导航栏样式，添加主题色标题和用户头像
  - 修改 `src/index.css` 文件，添加 CSS 变量定义主题色系统，包括主色调、亮色、暗色等
  - 添加主题色相关的全局样式类，如 `.text-primary`、`.bg-primary`、`.border-primary` 等

### 技术说明
- 使用 Ant Design 的 `ConfigProvider` 组件和 `theme` 对象进行主题配置
- 在 CSS 中使用变量定义主题色系统，方便统一管理和修改
- 为常用组件添加主题色相关的样式类，便于在项目中快速应用主题色
- 优化了侧边栏和顶部导航栏的样式，使整体界面更加美观和协调
- 主题色 `#32AF50` 为绿色系，符合油站管理系统的行业特点，给人以环保、自然的感觉

## 2023-11-25
### 修复
- 修复 `/station/device/detail/LYY-12-2` 页面的历史趋势功能：
  - 将原来的占位图表区域替换为实际的图表组件
  - 为每个油罐添加独立的历史趋势卡片，包含油位和水位、温度、压力三个标签页
  - 使用 ECharts 图表库实现数据可视化，展示24小时历史数据
  - 添加时间范围选择功能，支持按日、周、月、季、年查看数据
  - 优化UI设计，使用主题色 `#32AF50` 标识油罐编号
  - 添加油罐状态标签，直观显示油罐当前状态

### 技术说明
- 利用已有的图表配置函数 `getFuelLevelChartOption`、`getTemperatureChartOption` 和 `getPressureChartOption` 实现数据可视化
- 使用 Ant Design 的 Card、Tabs、Space 等组件优化界面布局
- 使用 ReactECharts 组件渲染图表，确保图表响应式适应容器大小
- 通过嵌套 Tabs 组件实现多层次的数据展示，提高用户体验

## 2023-11-26
### 修复
- 修复 `/sales/oil/price` 页面的操作按钮：
  - 将操作列中的按钮样式从文本按钮改为更明显的样式，提高用户体验
  - 查看详情按钮改为主要按钮（蓝色），添加"详情"文字说明
  - 编辑按钮改为默认按钮（灰色），添加"编辑"文字说明
  - 审批按钮改为主要幽灵按钮（绿色边框），使用主题色 `#32AF50`，添加"审批"文字说明
  - 取消按钮改为危险主要按钮（红色），添加"取消"文字说明
  - 扩大操作列宽度，确保按钮显示完整
  - 移除多余的 Tooltip 提示，改为直接在按钮上显示文字说明

### 技术说明
- 符合设计规范中的按钮交互要求，使用合适的按钮类型和颜色
- 提高了用户界面的可用性，使操作按钮更加直观明显
- 使用主题色 `#32AF50` 作为审批按钮的颜色，保持系统风格一致性
- 优化了操作列的宽度，确保在不同屏幕尺寸下按钮显示正常

## 2023-11-27
### 新增
- 开发油品调价申请单页面 `src/pages/sales/oil/price/application.js`：
  - 实现单站调价和多站联调两种调价方式
  - 支持动态添加多个油品调价项
  - 提供调价类型、生效日期时间、调价原因等基本信息填写
  - 支持附件上传功能
  - 实现表单验证和提交功能
  - 根据调价类型动态显示不同的表单项
  - 支持紧急程度设置

### 技术说明
- 使用 Ant Design 组件库实现表单和布局
- 使用 Form.List 实现动态表单项添加和删除
- 使用 Radio.Group 实现调价类型切换
- 使用 Upload 组件实现附件上传
- 使用 Spin 组件实现加载状态展示
- 使用 Typography 组件优化文本展示
- 使用 Divider 组件分隔不同表单区域
- 实现响应式布局，适配不同屏幕尺寸
- 添加表单验证规则，确保数据完整性

## 2023-11-28
### 修改
- 删除重复的油品调价申请单菜单项和路由：
  - 移除 `/sales/oil/price/adjustment` 路径的菜单项和路由
  - 保留 `/sales/oil/price/application` 路径的油品调价申请单功能
  - 优化菜单结构，避免功能重复

### 技术说明
- 在 `src/pages/sales/oil/Layout.js` 文件中删除重复的菜单项
- 在 `src/router.js` 文件中删除重复的路由配置
- 保持系统功能完整性，确保用户体验一致性

## 2023-11-29
### 修改
- 优化油品调价申请单页面 `src/pages/sales/oil/price/application.js`：
  - 移除面包屑导航（Breadcrumb）组件，简化页面结构
  - 保留提示信息和主要内容区域，提高页面简洁度

### 技术说明
- 根据设计规范优化页面结构，减少不必要的导航元素
- 保持页面功能完整性，确保用户体验一致性
- 简化页面布局，使用户更专注于表单内容

### 优化
- 优化了油品调价申请单页面，移除了面包屑导航组件，简化页面结构，提升用户对表单内容的关注度。
- 优化了油品价格管理页面，移除了变动率相关字段，简化了页面内容和操作流程。
  - 技术说明：从表格列、查询条件、统计卡片和详情展示中移除了变动率字段。
  - 业务影响：简化了用户界面，使页面更加清晰，减少了不必要的数据计算和展示。

### 删除
- 删除了油枪价格调整和油枪调价明细功能，包括相关菜单项和路由配置。
  - 技术说明：从`src/pages/sales/oil/Layout.js`中移除了油枪价格调整和油枪调价明细的菜单项。
  - 技术说明：从`src/router.js`中移除了油枪价格调整和油枪调价明细的路由配置。
  - 业务影响：简化了油品价格管理模块，移除了未使用的功能，提高了系统的整洁度和可维护性。

## 2025-03-14

### 新增
- 创建项目设计规范文档 `设计规范.md`
- 创建变更日志文档 `变更日志.md`

### 设计规范初始版本包含以下内容
- 功能结构：完整的系统功能模块划分，包括一级、二级和三级目录
- 设计风格：整体风格和组件库使用规范
- 页面布局：通用布局和响应式设计规范
- 颜色系统：主色调和状态颜色规范
- 组件使用规范：表单组件、表格组件、抽屉与模态框使用规范
- 交互设计：按钮交互、权限控制、加载状态和消息反馈规范
- 数据展示：表格数据和图表展示规范
- 模拟数据规范：数据结构、生成方式和类型规范
- 表单验证规则：必填字段和数值验证规范
- 功能模块设计：查询模块、审批流程、详情查看和编辑功能规范
- 特殊功能设计：标签页切换、数据导出和提示信息规范
- 审批流程设计：审批界面、表单布局、节点显示等规范
- 油站与组织结构筛选：通用筛选要求、油站筛选、组织结构筛选等规范
- 业务图表设计规范：图表选型原则、配置要求、业务场景应用等规范

### 特别要求
- 所有页面必须有不少于20条的模拟数据
- 所有按钮必须实现交互功能
- 所有图表必须根据业务场景选择合适的图表类型
- 所有报表、明细和统计页面必须支持按油站和组织结构进行筛选 