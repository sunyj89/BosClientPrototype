# 角色配置权限搜索功能

## 新增功能概述

在角色配置页面中新增了两个权限搜索功能：

### ✅ 1. 页面与操作权限搜索
- **功能位置**：权限配置 → 页面与操作权限面板
- **搜索范围**：页面名称和操作权限名称
- **搜索类型**：实时模糊搜索
- **搜索特性**：
  - 支持中文和英文搜索
  - 实时过滤显示结果
  - 自动展开匹配的权限节点
  - 显示搜索结果数量统计
  - 支持一键清空搜索条件

### ✅ 2. POS设备权限搜索  
- **功能位置**：权限配置 → POS设备权限面板
- **搜索范围**：POS设备权限名称
- **搜索类型**：实时模糊搜索
- **搜索特性**：
  - 支持设备名称模糊搜索
  - 实时过滤显示设备列表
  - 智能全选（仅选中当前搜索结果）
  - 显示搜索结果数量统计
  - 空结果友好提示

## 功能详细说明

### 页面与操作权限搜索

#### 可搜索的内容示例：
```
- "工作台" → 找到工作台相关权限
- "组织" → 找到组织架构管理相关权限
- "查看" → 找到所有包含"查看"的操作权限
- "编辑" → 找到所有包含"编辑"的操作权限
- "供应商" → 找到供应商管理相关权限
- "油站" → 找到油站管理相关权限
- "设备" → 找到设备管理相关权限
```

#### 搜索行为：
1. **实时搜索**：输入时立即过滤结果
2. **层级展开**：自动展开包含匹配项的父节点
3. **高亮显示**：通过Tag显示找到的模块数量
4. **空结果处理**：显示友好的"未找到"提示
5. **状态保持**：搜索时保持已选中的权限状态

#### 全选行为：
- 搜索状态下：全选按钮仍然控制所有权限（不受搜索过滤影响）
- 保持原有的权限选择逻辑不变

### POS设备权限搜索

#### 可搜索的设备权限：
```
- "加油枪" → 找到加油枪配置权限
- "油罐" → 找到油罐配置权限  
- "价格" → 找到价格配置权限
- "设备" → 找到设备控制权限
- "报表" → 找到报表打印权限
- "配置" → 找到所有配置类权限
- "控制" → 找到设备控制权限
```

#### 搜索行为：
1. **实时过滤**：输入时立即过滤设备列表
2. **智能全选**：
   - 无搜索：显示"全选POS设备权限"
   - 有搜索：显示"全选当前搜索结果"
   - 全选操作只影响当前过滤结果
3. **结果统计**：显示找到的设备权限数量
4. **空结果处理**：显示"未找到匹配的POS设备权限"提示

#### 全选逻辑：
- **选中搜索结果**：将当前搜索到的设备权限添加到已选列表
- **取消搜索结果**：从已选列表中移除当前搜索到的设备权限
- **保持其他选择**：不影响搜索范围外的已选权限

## 使用场景示例

### 场景1：快速找到特定页面权限
```
需求：为"站长"角色配置库存管理权限
操作：
1. 在页面权限搜索框输入"库存"
2. 系统自动过滤显示库存管理相关权限
3. 勾选需要的权限即可
```

### 场景2：批量配置设备权限
```
需求：为"服务区经理"配置所有配置类权限
操作：
1. 在POS设备权限搜索框输入"配置"
2. 系统显示所有包含"配置"的设备权限
3. 点击"全选当前搜索结果"即可批量选择
```

### 场景3：精确查找操作权限
```
需求：只授予查看权限，不给编辑权限
操作：
1. 在页面权限搜索框输入"查看"
2. 系统显示所有查看类权限
3. 选择需要的查看权限
4. 清空搜索，再搜索"编辑"确认未选中编辑权限
```

## 技术实现要点

### 1. 状态管理
```javascript
const [pagePermissionSearchValue, setPagePermissionSearchValue] = useState('');
const [posDeviceSearchValue, setPosDeviceSearchValue] = useState('');
```

### 2. 搜索过滤算法
- **树形数据过滤**：递归过滤保持父子关系
- **模糊匹配**：使用`toLowerCase().includes()`实现
- **结果统计**：实时计算匹配数量

### 3. 用户体验优化
- **实时响应**：onChange事件触发搜索
- **自动展开**：搜索时自动展开匹配节点
- **状态重置**：弹窗关闭时清空搜索状态
- **视觉反馈**：Tag显示结果数量，空状态友好提示

## 数据兼容性

- **向后兼容**：不影响现有数据结构
- **搜索不影响保存**：搜索仅用于UI过滤，不影响权限数据保存
- **状态独立**：两个搜索框状态独立管理

## 测试建议

### 功能测试：
1. ✅ 测试页面权限搜索的各种关键词
2. ✅ 测试POS设备权限搜索的各种关键词  
3. ✅ 测试搜索结果的选择和取消选择
4. ✅ 测试全选功能在搜索状态下的行为
5. ✅ 测试清空搜索后的状态恢复
6. ✅ 测试弹窗关闭重新打开的状态重置

### 边界测试：
1. ✅ 空搜索关键词
2. ✅ 搜索无结果的关键词
3. ✅ 搜索特殊字符
4. ✅ 搜索超长字符串

### 性能测试：
1. ✅ 大量权限数据下的搜索性能
2. ✅ 快速连续输入的响应性能

所有搜索功能已完成开发并可以投入使用！ 